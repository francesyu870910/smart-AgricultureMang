<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»´æŠ¤è®¡åˆ’ç®¡ç†æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .maintenance-center { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin: 5px; }
        .btn-primary { background: #27AE60; color: white; }
        .btn-secondary { background: #3498DB; color: white; }
        .maintenance-list { margin-top: 20px; background: #f8f9fa; border-radius: 8px; overflow: hidden; }
        .list-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1.5fr; background: #34495E; color: white; font-weight: 600; font-size: 13px; }
        .list-item { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1.5fr; border-bottom: 1px solid rgba(0,0,0,0.1); background: white; }
        .cell { padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; }
        .cell:first-child { text-align: left; }
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .btn-small { padding: 4px 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ç»´æŠ¤è®¡åˆ’ç®¡ç†æµ‹è¯•é¡µé¢</h1>
            <p>æµ‹è¯•ç»´æŠ¤è®¡åˆ’çš„åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘åŠŸèƒ½</p>
        </div>

        <div class="maintenance-center">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">ğŸ”§</span>ç»´æŠ¤ç®¡ç†ä¸­å¿ƒ
                </h3>
                <div>
                    <button class="btn btn-primary" onclick="createMaintenancePlan()">+ åˆ›å»ºç»´æŠ¤è®¡åˆ’</button>
                    <button class="btn btn-secondary" onclick="refreshMaintenanceData()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ•°æ® -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #E74C3C;">
                    <div style="font-size: 24px; font-weight: bold; color: #E74C3C; margin-bottom: 5px;" id="overdueCount">2</div>
                    <div style="font-size: 14px; color: #666;">å·²è¿‡æœŸ</div>
                </div>
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #F39C12;">
                    <div style="font-size: 24px; font-weight: bold; color: #F39C12; margin-bottom: 5px;" id="upcomingCount">4</div>
                    <div style="font-size: 14px; color: #666;">å³å°†åˆ°æœŸ</div>
                </div>
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #27AE60;">
                    <div style="font-size: 24px; font-weight: bold; color: #27AE60; margin-bottom: 5px;" id="completedCount">0</div>
                    <div style="font-size: 14px; color: #666;">å·²å®Œæˆ</div>
                </div>
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #3498DB;">
                    <div style="font-size: 24px; font-weight: bold; color: #3498DB; margin-bottom: 5px;" id="totalPlansCount">6</div>
                    <div style="font-size: 14px; color: #666;">æ€»è®¡åˆ’æ•°</div>
                </div>
            </div>

            <!-- ç»´æŠ¤è®¡åˆ’åˆ—è¡¨ -->
            <div>
                <h4 style="margin-bottom: 15px; color: #333;">ğŸ“‹ ç»´æŠ¤è®¡åˆ’åˆ—è¡¨</h4>
                <div class="maintenance-list">
                    <div class="list-header">
                        <div class="cell">è®¾å¤‡åç§°</div>
                        <div class="cell">ç»´æŠ¤ç±»å‹</div>
                        <div class="cell">è®¡åˆ’æ—¥æœŸ</div>
                        <div class="cell">çŠ¶æ€</div>
                        <div class="cell">è´Ÿè´£äºº</div>
                        <div class="cell">æ“ä½œ</div>
                    </div>
                    <div id="maintenancePlansContainer">
                        <!-- ç»´æŠ¤è®¡åˆ’æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç»´æŠ¤è®¡åˆ’æ•°æ®å­˜å‚¨
        let maintenancePlans = [
            { id: 1, deviceName: 'æ¸©åº¦æ§åˆ¶å™¨', deviceIcon: 'ğŸŒ¡ï¸', type: 'å®šæœŸæ£€æŸ¥', plannedDate: '2024-01-16', status: 'å¾…æ‰§è¡Œ', assignee: 'å¼ å·¥ç¨‹å¸ˆ', priority: 'normal', description: 'æ£€æŸ¥æ¸©åº¦ä¼ æ„Ÿå™¨ç²¾åº¦ï¼Œæ¸…æ´è®¾å¤‡å¤–å£³' },
            { id: 2, deviceName: 'çŒæº‰ç³»ç»Ÿ', deviceIcon: 'ğŸ’§', type: 'æ·±åº¦æ¸…æ´', plannedDate: '2024-01-15', status: 'å·²è¿‡æœŸ', assignee: 'ææŠ€å¸ˆ', priority: 'high', description: 'æ¸…ç†ç®¡é“å µå¡ï¼Œæ›´æ¢è€åŒ–å¯†å°åœˆ' },
            { id: 3, deviceName: 'è¡¥å…‰ç¯', deviceIcon: 'ğŸ’¡', type: 'ç¯æ³¡æ›´æ¢', plannedDate: '2024-01-18', status: 'å¾…æ‰§è¡Œ', assignee: 'ç‹å¸ˆå‚…', priority: 'normal', description: 'æ›´æ¢è€åŒ–LEDç¯æ³¡ï¼Œæ£€æŸ¥ç”µè·¯è¿æ¥' },
            { id: 4, deviceName: 'é€šé£ç³»ç»Ÿ', deviceIcon: 'ğŸŒªï¸', type: 'æ»¤ç½‘æ¸…æ´—', plannedDate: '2024-01-17', status: 'å¾…æ‰§è¡Œ', assignee: 'é™ˆæŠ€å¸ˆ', priority: 'normal', description: 'æ¸…æ´—è¿›é£å£æ»¤ç½‘ï¼Œæ£€æŸ¥é£æ‰‡è¿è½¬' },
            { id: 5, deviceName: 'åŠ çƒ­å™¨', deviceIcon: 'ğŸ”¥', type: 'å®‰å…¨æ£€æŸ¥', plannedDate: '2024-01-14', status: 'å·²è¿‡æœŸ', assignee: 'åˆ˜å·¥ç¨‹å¸ˆ', priority: 'high', description: 'æ£€æŸ¥åŠ çƒ­å…ƒä»¶å’Œæ¸©æ§ç³»ç»Ÿå®‰å…¨æ€§' },
            { id: 6, deviceName: 'æ¹¿åº¦ä¼ æ„Ÿå™¨', deviceIcon: 'ğŸ’¨', type: 'æ ¡å‡†æ£€æµ‹', plannedDate: '2024-01-19', status: 'å¾…æ‰§è¡Œ', assignee: 'èµµæŠ€å¸ˆ', priority: 'low', description: 'é‡æ–°æ ¡å‡†ä¼ æ„Ÿå™¨ï¼Œæå‡æ£€æµ‹ç²¾åº¦' }
        ];

        // åˆ›å»ºç»´æŠ¤è®¡åˆ’
        function createMaintenancePlan() {
            console.log('createMaintenancePlan called');
            showMaintenancePlanModal();
        }

        // æ˜¾ç¤ºç»´æŠ¤è®¡åˆ’åˆ›å»ºå¼¹çª—
        function showMaintenancePlanModal(planData = null) {
            const isEdit = planData !== null;
            const modalTitle = isEdit ? 'ç¼–è¾‘ç»´æŠ¤è®¡åˆ’' : 'åˆ›å»ºç»´æŠ¤è®¡åˆ’';
            
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = \`
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            \`;

            // åˆ›å»ºå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = \`
                background: white;
                border-radius: 15px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            \`;

            modal.innerHTML = \`
                <div style="padding: 25px; border-bottom: 1px solid #eee;">
                    <h3 style="margin: 0; color: #333; font-size: 20px; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ“‹</span>\${modalTitle}
                    </h3>
                </div>
                
                <form id="maintenancePlanForm" style="padding: 25px;">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">è®¾å¤‡åç§° *</label>
                        <select name="deviceName" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="">è¯·é€‰æ‹©è®¾å¤‡</option>
                            <option value="æ¸©åº¦æ§åˆ¶å™¨">ğŸŒ¡ï¸ æ¸©åº¦æ§åˆ¶å™¨</option>
                            <option value="æ¹¿åº¦æ§åˆ¶å™¨">ğŸ’¨ æ¹¿åº¦æ§åˆ¶å™¨</option>
                            <option value="è¡¥å…‰ç¯ç³»ç»Ÿ">ğŸ’¡ è¡¥å…‰ç¯ç³»ç»Ÿ</option>
                            <option value="é€šé£ç³»ç»Ÿ">ğŸŒªï¸ é€šé£ç³»ç»Ÿ</option>
                            <option value="çŒæº‰ç³»ç»Ÿ">ğŸ’§ çŒæº‰ç³»ç»Ÿ</option>
                            <option value="åŠ çƒ­å™¨">ğŸ”¥ åŠ çƒ­å™¨</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">ç»´æŠ¤ç±»å‹ *</label>
                        <select name="type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                            <option value="å®šæœŸä¿å…»">å®šæœŸä¿å…»</option>
                            <option value="æ•…éšœç»´ä¿®">æ•…éšœç»´ä¿®</option>
                            <option value="é¢„é˜²æ€§ç»´æŠ¤">é¢„é˜²æ€§ç»´æŠ¤</option>
                            <option value="ç´§æ€¥ç»´ä¿®">ç´§æ€¥ç»´ä¿®</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">è®¡åˆ’æ—¥æœŸ *</label>
                        <input type="date" name="plannedDate" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">è´Ÿè´£äºº *</label>
                        <select name="assignee" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="">è¯·é€‰æ‹©è´Ÿè´£äºº</option>
                            <option value="å¼ å·¥ç¨‹å¸ˆ">å¼ å·¥ç¨‹å¸ˆ</option>
                            <option value="ææŠ€å¸ˆ">ææŠ€å¸ˆ</option>
                            <option value="ç‹å¸ˆå‚…">ç‹å¸ˆå‚…</option>
                            <option value="é™ˆæŠ€å¸ˆ">é™ˆæŠ€å¸ˆ</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">ç»´æŠ¤æè¿°</label>
                        <textarea name="description" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                    </div>
                </form>
                
                <div style="padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="closeMaintenancePlanModal()" style="padding: 10px 20px; background: #95A5A6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                    <button type="button" onclick="saveMaintenancePlan(\${isEdit ? planData?.id : 'null'})" style="padding: 10px 20px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">\${isEdit ? 'æ›´æ–°è®¡åˆ’' : 'åˆ›å»ºè®¡åˆ’'}</button>
                </div>
            \`;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºæ˜å¤©
            if (!isEdit) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dateInput = modal.querySelector('input[name="plannedDate"]');
                dateInput.value = tomorrow.toISOString().split('T')[0];
            }

            // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeMaintenancePlanModal();
                }
            });

            // ä¿å­˜å¼¹çª—å¼•ç”¨
            window.currentMaintenancePlanModal = overlay;
        }

        // å…³é—­ç»´æŠ¤è®¡åˆ’å¼¹çª—
        function closeMaintenancePlanModal() {
            if (window.currentMaintenancePlanModal) {
                document.body.removeChild(window.currentMaintenancePlanModal);
                window.currentMaintenancePlanModal = null;
            }
        }

        // ä¿å­˜ç»´æŠ¤è®¡åˆ’
        function saveMaintenancePlan(editId = null) {
            const form = document.getElementById('maintenancePlanForm');
            const formData = new FormData(form);
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            const requiredFields = ['deviceName', 'type', 'plannedDate', 'assignee'];
            for (let field of requiredFields) {
                if (!formData.get(field)) {
                    alert(\`è¯·å¡«å†™\${getFieldLabel(field)}\`);
                    return;
                }
            }
            
            // è·å–è®¾å¤‡å›¾æ ‡
            const deviceIcons = {
                'æ¸©åº¦æ§åˆ¶å™¨': 'ğŸŒ¡ï¸',
                'æ¹¿åº¦æ§åˆ¶å™¨': 'ğŸ’¨',
                'è¡¥å…‰ç¯ç³»ç»Ÿ': 'ğŸ’¡',
                'é€šé£ç³»ç»Ÿ': 'ğŸŒªï¸',
                'çŒæº‰ç³»ç»Ÿ': 'ğŸ’§',
                'åŠ çƒ­å™¨': 'ğŸ”¥'
            };
            
            const planData = {
                deviceName: formData.get('deviceName'),
                deviceIcon: deviceIcons[formData.get('deviceName')] || 'âš™ï¸',
                type: formData.get('type'),
                plannedDate: formData.get('plannedDate'),
                priority: 'normal',
                assignee: formData.get('assignee'),
                description: formData.get('description') || '',
                status: 'å¾…æ‰§è¡Œ',
                createdAt: new Date().toISOString()
            };
            
            if (editId && editId !== 'null') {
                // ç¼–è¾‘ç°æœ‰è®¡åˆ’
                const index = maintenancePlans.findIndex(p => p.id == editId);
                if (index !== -1) {
                    maintenancePlans[index] = { ...maintenancePlans[index], ...planData };
                    alert('ç»´æŠ¤è®¡åˆ’æ›´æ–°æˆåŠŸ');
                }
            } else {
                // åˆ›å»ºæ–°è®¡åˆ’
                planData.id = Date.now();
                maintenancePlans.unshift(planData);
                alert('ç»´æŠ¤è®¡åˆ’åˆ›å»ºæˆåŠŸ');
            }
            
            // å…³é—­å¼¹çª—
            closeMaintenancePlanModal();
            
            // åˆ·æ–°åˆ—è¡¨
            refreshMaintenanceData();
        }

        // è·å–å­—æ®µæ ‡ç­¾
        function getFieldLabel(field) {
            const labels = {
                'deviceName': 'è®¾å¤‡åç§°',
                'type': 'ç»´æŠ¤ç±»å‹',
                'plannedDate': 'è®¡åˆ’æ—¥æœŸ',
                'assignee': 'è´Ÿè´£äºº'
            };
            return labels[field] || field;
        }

        // æŸ¥çœ‹ç»´æŠ¤è®¡åˆ’è¯¦æƒ…
        function viewMaintenancePlan(planId) {
            const plan = maintenancePlans.find(p => p.id == planId);
            if (!plan) {
                alert('æœªæ‰¾åˆ°ç»´æŠ¤è®¡åˆ’');
                return;
            }
            
            alert(\`è®¾å¤‡ï¼š\${plan.deviceName}\\nç±»å‹ï¼š\${plan.type}\\næ—¥æœŸï¼š\${plan.plannedDate}\\nè´Ÿè´£äººï¼š\${plan.assignee}\\næè¿°ï¼š\${plan.description || 'æ— '}\`);
        }

        // åˆ·æ–°ç»´æŠ¤æ•°æ®
        function refreshMaintenanceData() {
            generateMaintenancePlansHTML();
            updateMaintenanceStats();
            alert('ç»´æŠ¤æ•°æ®å·²åˆ·æ–°');
        }

        // ç”Ÿæˆç»´æŠ¤è®¡åˆ’HTML
        function generateMaintenancePlansHTML() {
            const container = document.getElementById('maintenancePlansContainer');
            if (!container) return;

            container.innerHTML = maintenancePlans.map(plan => {
                const statusColor = plan.status === 'å·²è¿‡æœŸ' ? '#E74C3C' : plan.status === 'æ‰§è¡Œä¸­' ? '#F39C12' : plan.status === 'å·²å®Œæˆ' ? '#27AE60' : '#3498DB';
                
                return \`
                <div class="list-item">
                    <div class="cell" style="text-align: left;">
                        <span style="margin-right: 8px; font-size: 16px;">\${plan.deviceIcon}</span>
                        <span style="font-weight: 600;">\${plan.deviceName}</span>
                    </div>
                    <div class="cell">\${plan.type}</div>
                    <div class="cell">\${plan.plannedDate}</div>
                    <div class="cell">
                        <span class="status-badge" style="background: \${statusColor}; color: white;">\${plan.status}</span>
                    </div>
                    <div class="cell">\${plan.assignee}</div>
                    <div class="cell">
                        <button class="btn-small" style="background: #3498DB; color: white;" onclick="viewMaintenancePlan(\${plan.id})">æŸ¥çœ‹</button>
                        <button class="btn-small" style="background: #27AE60; color: white;" onclick="alert('æ‰§è¡Œç»´æŠ¤åŠŸèƒ½')">æ‰§è¡Œ</button>
                    </div>
                </div>
                \`;
            }).join('');
        }

        // æ›´æ–°ç»´æŠ¤ç»Ÿè®¡æ•°æ®
        function updateMaintenanceStats() {
            const overdueCount = maintenancePlans.filter(p => {
                const planDate = new Date(p.plannedDate);
                const today = new Date();
                return planDate < today && p.status === 'å¾…æ‰§è¡Œ';
            }).length;
            
            const upcomingCount = maintenancePlans.filter(p => {
                const planDate = new Date(p.plannedDate);
                const today = new Date();
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                return planDate >= today && planDate <= nextWeek && p.status === 'å¾…æ‰§è¡Œ';
            }).length;
            
            const completedCount = maintenancePlans.filter(p => p.status === 'å·²å®Œæˆ').length;
            const totalCount = maintenancePlans.length;
            
            document.getElementById('overdueCount').textContent = overdueCount;
            document.getElementById('upcomingCount').textContent = upcomingCount;
            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('totalPlansCount').textContent = totalCount;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateMaintenancePlansHTML();
            updateMaintenanceStats();
        });
    </script>
</body>
</html>