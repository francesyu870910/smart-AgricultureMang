<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©åº¦ç›‘æ§ç»„ä»¶æµ‹è¯•</title>
    <style>
        :root {
            --primary-color: #2E7D32;
            --secondary-color: #4CAF50;
            --accent-color: #66BB6A;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --success-color: #4CAF50;
            --info-color: #2196F3;
            
            --bg-color: #F5F5F5;
            --card-bg: #FFFFFF;
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-light: #FFFFFF;
            --border-color: #E0E0E0;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-primary);
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-light);
        }
        
        .btn-secondary {
            background-color: var(--text-secondary);
            color: var(--text-light);
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .status-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .status-error {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
    </style>
    <link rel="stylesheet" href="src/main/resources/static/frontend/css/main.css">
    <link rel="stylesheet" href="src/main/resources/static/frontend/css/components.css">
    <link rel="stylesheet" href="src/main/resources/static/frontend/css/charts.css">
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>æ¸©åº¦ç›‘æ§ç»„ä»¶æµ‹è¯•</h1>
            <p>æµ‹è¯•æ¸©åº¦ç›‘æ§æ¨¡å—çš„å„é¡¹åŠŸèƒ½</p>
            
            <div class="test-controls">
                <button class="btn btn-primary" onclick="loadComponent()">åŠ è½½ç»„ä»¶</button>
                <button class="btn btn-secondary" onclick="simulateData()">æ¨¡æ‹Ÿæ•°æ®</button>
                <button class="btn btn-secondary" onclick="testThresholds()">æµ‹è¯•é˜ˆå€¼</button>
                <button class="btn btn-secondary" onclick="testChart()">æµ‹è¯•å›¾è¡¨</button>
            </div>
            
            <div id="test-status"></div>
        </div>
        
        <div id="temperature-content">
            <div class="status">ç‚¹å‡»"åŠ è½½ç»„ä»¶"å¼€å§‹æµ‹è¯•</div>
        </div>
    </div>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="src/main/resources/static/frontend/js/utils/format.js"></script>
    <script src="src/main/resources/static/frontend/js/utils/validation.js"></script>
    <script src="src/main/resources/static/frontend/js/utils/chart.js"></script>
    <script src="src/main/resources/static/frontend/js/utils/error.js"></script>
    <script src="src/main/resources/static/frontend/js/utils/notification.js"></script>
    <script src="src/main/resources/static/frontend/js/utils/data.js"></script>
    <script src="src/main/resources/static/frontend/js/utils/ui.js"></script>
    <script src="src/main/resources/static/frontend/js/services/storage.js"></script>
    <script src="src/main/resources/static/frontend/js/services/api.js"></script>
    <script src="src/main/resources/static/frontend/js/components/temperature.js"></script>

    <script>
        // åˆ›å»ºå…¨å±€APIæœåŠ¡å®ä¾‹
        const apiService = new ApiService();
        let temperatureComponentInstance = null;
        
        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `<div class="status status-${type}">${message}</div>`;
        }
        
        async function loadComponent() {
            try {
                showStatus('æ­£åœ¨åŠ è½½æ¸©åº¦ç›‘æ§ç»„ä»¶...', 'success');
                
                temperatureComponentInstance = new TemperatureComponent();
                const html = await temperatureComponentInstance.render();
                document.getElementById('temperature-content').innerHTML = html;
                await temperatureComponentInstance.init();
                
                showStatus('âœ… æ¸©åº¦ç›‘æ§ç»„ä»¶åŠ è½½æˆåŠŸï¼', 'success');
                console.log('æ¸©åº¦ç»„ä»¶æµ‹è¯•æˆåŠŸ');
                
            } catch (error) {
                console.error('æ¸©åº¦ç»„ä»¶æµ‹è¯•å¤±è´¥:', error);
                showStatus('âŒ ç»„ä»¶åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function simulateData() {
            if (!temperatureComponentInstance) {
                showStatus('âŒ è¯·å…ˆåŠ è½½ç»„ä»¶', 'error');
                return;
            }
            
            try {
                // æ¨¡æ‹Ÿå®æ—¶æ¸©åº¦æ•°æ®
                const temperatures = [22.5, 25.3, 28.1, 31.2, 19.8, 24.7, 26.9];
                let index = 0;
                
                const interval = setInterval(() => {
                    if (index >= temperatures.length) {
                        clearInterval(interval);
                        showStatus('âœ… æ•°æ®æ¨¡æ‹Ÿå®Œæˆ', 'success');
                        return;
                    }
                    
                    const mockData = {
                        temperature: temperatures[index],
                        recordedAt: new Date().toISOString()
                    };
                    
                    temperatureComponentInstance.updateEnvironmentData(mockData);
                    showStatus(`ğŸ“Š æ¨¡æ‹Ÿæ¸©åº¦æ•°æ®: ${temperatures[index]}Â°C`, 'success');
                    index++;
                }, 2000);
                
            } catch (error) {
                showStatus('âŒ æ•°æ®æ¨¡æ‹Ÿå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function testThresholds() {
            if (!temperatureComponentInstance) {
                showStatus('âŒ è¯·å…ˆåŠ è½½ç»„ä»¶', 'error');
                return;
            }
            
            try {
                // æµ‹è¯•ä¸åŒçš„é˜ˆå€¼è®¾ç½®
                const testCases = [
                    { temp: 15, expected: 'è¿‡ä½' },
                    { temp: 25, expected: 'æ­£å¸¸' },
                    { temp: 35, expected: 'è¿‡é«˜' }
                ];
                
                testCases.forEach((testCase, index) => {
                    setTimeout(() => {
                        temperatureComponentInstance.updateEnvironmentData({
                            temperature: testCase.temp,
                            recordedAt: new Date().toISOString()
                        });
                        
                        showStatus(`ğŸ§ª æµ‹è¯•é˜ˆå€¼: ${testCase.temp}Â°C (é¢„æœŸ: ${testCase.expected})`, 'success');
                    }, index * 1500);
                });
                
            } catch (error) {
                showStatus('âŒ é˜ˆå€¼æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function testChart() {
            if (!temperatureComponentInstance) {
                showStatus('âŒ è¯·å…ˆåŠ è½½ç»„ä»¶', 'error');
                return;
            }
            
            try {
                // ç”Ÿæˆå†å²æ•°æ®ç”¨äºå›¾è¡¨æµ‹è¯•
                const historyData = [];
                const now = new Date();
                
                for (let i = 23; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                    const baseTemp = 24;
                    const variation = Math.sin(i * 0.5) * 5 + Math.random() * 2;
                    
                    historyData.push({
                        temperature: (baseTemp + variation).toFixed(1),
                        recordedAt: time.toISOString()
                    });
                }
                
                temperatureComponentInstance.historyData = historyData;
                temperatureComponentInstance.drawTrendChart();
                temperatureComponentInstance.updateStatistics();
                
                showStatus('âœ… å›¾è¡¨æµ‹è¯•å®Œæˆï¼Œå·²ç”Ÿæˆ24å°æ—¶å†å²æ•°æ®', 'success');
                
            } catch (error) {
                showStatus('âŒ å›¾è¡¨æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('ğŸš€ æµ‹è¯•é¡µé¢å·²å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•', 'success');
        });
    </script>
</body>
</html>