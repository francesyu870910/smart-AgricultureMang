<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ç®¡ç†æœ€ç»ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-status {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ§ª ç”¨æˆ·ç®¡ç†åŠŸèƒ½æœ€ç»ˆæµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢å°†æµ‹è¯•ä¿®å¤ç‰ˆæœ¬çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½</p>
    </div>

    <div id="test-results"></div>
    <div id="user-management-container"></div>

    <script src="user-management-fixed.js"></script>
    <script>
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            const container = document.getElementById('user-management-container');
            let testResults = [];

            // æµ‹è¯•1: æ£€æŸ¥è„šæœ¬æ˜¯å¦åŠ è½½
            try {
                if (typeof loadUsersContent === 'function') {
                    testResults.push({
                        test: 'è„šæœ¬åŠ è½½æµ‹è¯•',
                        status: 'success',
                        message: 'âœ… user-management-fixed.js åŠ è½½æˆåŠŸ'
                    });
                } else {
                    testResults.push({
                        test: 'è„šæœ¬åŠ è½½æµ‹è¯•',
                        status: 'error',
                        message: 'âŒ loadUsersContent å‡½æ•°æœªæ‰¾åˆ°'
                    });
                }
            } catch (error) {
                testResults.push({
                    test: 'è„šæœ¬åŠ è½½æµ‹è¯•',
                    status: 'error',
                    message: 'âŒ è„šæœ¬åŠ è½½é”™è¯¯: ' + error.message
                });
            }

            // æµ‹è¯•2: æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            try {
                if (typeof usersData !== 'undefined' && Array.isArray(usersData) && usersData.length > 0) {
                    testResults.push({
                        test: 'æ•°æ®æ£€æŸ¥æµ‹è¯•',
                        status: 'success',
                        message: `âœ… ç”¨æˆ·æ•°æ®åŠ è½½æˆåŠŸï¼Œå…± ${usersData.length} ä¸ªç”¨æˆ·`
                    });
                } else {
                    testResults.push({
                        test: 'æ•°æ®æ£€æŸ¥æµ‹è¯•',
                        status: 'error',
                        message: 'âŒ ç”¨æˆ·æ•°æ®æœªæ­£ç¡®åŠ è½½'
                    });
                }
            } catch (error) {
                testResults.push({
                    test: 'æ•°æ®æ£€æŸ¥æµ‹è¯•',
                    status: 'error',
                    message: 'âŒ æ•°æ®æ£€æŸ¥é”™è¯¯: ' + error.message
                });
            }

            // æµ‹è¯•3: å°è¯•åŠ è½½ç”¨æˆ·ç®¡ç†ç•Œé¢
            try {
                loadUsersContent(container);
                testResults.push({
                    test: 'ç•Œé¢åŠ è½½æµ‹è¯•',
                    status: 'success',
                    message: 'âœ… ç”¨æˆ·ç®¡ç†ç•Œé¢åŠ è½½æˆåŠŸ'
                });
            } catch (error) {
                testResults.push({
                    test: 'ç•Œé¢åŠ è½½æµ‹è¯•',
                    status: 'error',
                    message: 'âŒ ç•Œé¢åŠ è½½é”™è¯¯: ' + error.message
                });
            }

            // æµ‹è¯•4: æ£€æŸ¥å…³é”®å‡½æ•°æ˜¯å¦å­˜åœ¨
            const keyFunctions = [
                'showAddUserModal',
                'closeAddUserModal', 
                'saveNewUser',
                'searchUsers',
                'refreshUserList',
                'deleteUser'
            ];

            let functionsOk = 0;
            keyFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    functionsOk++;
                }
            });

            if (functionsOk === keyFunctions.length) {
                testResults.push({
                    test: 'åŠŸèƒ½å‡½æ•°æµ‹è¯•',
                    status: 'success',
                    message: `âœ… æ‰€æœ‰ ${keyFunctions.length} ä¸ªå…³é”®å‡½æ•°éƒ½å·²æ­£ç¡®å®šä¹‰`
                });
            } else {
                testResults.push({
                    test: 'åŠŸèƒ½å‡½æ•°æµ‹è¯•',
                    status: 'error',
                    message: `âŒ åªæœ‰ ${functionsOk}/${keyFunctions.length} ä¸ªå‡½æ•°æ­£ç¡®å®šä¹‰`
                });
            }

            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            let resultsHTML = '<h2>æµ‹è¯•ç»“æœ</h2>';
            testResults.forEach(result => {
                resultsHTML += `<div class="test-status ${result.status}">
                    <strong>${result.test}:</strong> ${result.message}
                </div>`;
            });

            // æ·»åŠ ä½¿ç”¨è¯´æ˜
            resultsHTML += `
                <div class="test-status info">
                    <strong>ä½¿ç”¨è¯´æ˜:</strong> 
                    å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œæ‚¨å¯ä»¥ç‚¹å‡»ä¸‹æ–¹çš„"â• æ·»åŠ ç”¨æˆ·"æŒ‰é’®æ¥æµ‹è¯•æ·»åŠ ç”¨æˆ·åŠŸèƒ½ã€‚
                    å¡«å†™è¡¨å•ä¿¡æ¯åç‚¹å‡»ä¿å­˜ï¼Œæ–°ç”¨æˆ·å°†ä¼šå‡ºç°åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ã€‚
                </div>
            `;

            resultsDiv.innerHTML = resultsHTML;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', runTests);

        // æ•è·å…¨å±€é”™è¯¯
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            const resultsDiv = document.getElementById('test-results');
            if (resultsDiv) {
                resultsDiv.innerHTML += `<div class="test-status error">
                    <strong>è¿è¡Œæ—¶é”™è¯¯:</strong> ${e.message} (è¡Œ: ${e.lineno})
                </div>`;
            }
        });
    </script>
</body>
</html>