<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©å®¤æ•°å­—åŒ–ç›‘æ§ç³»ç»Ÿ</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ±</text></svg>">
    <script src="dashboard-emergency-fix.js"></script>
    <script src="user-management-standalone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #2C3E50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-right: 30px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 280px;
            height: calc(100vh - 60px);
            background: #34495E;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-menu {
            padding: 30px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            color: #ecf0f1;
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }

        .menu-item:hover {
            background: rgba(52, 152, 219, 0.2);
            border-left-color: #3498db;
            color: #3498db;
            transform: translateX(5px);
        }

        .menu-item.active {
            background: rgba(46, 204, 113, 0.2);
            border-left-color: #2ecc71;
            color: #2ecc71;
            transform: translateX(5px);
        }

        .menu-item .icon {
            margin-right: 15px;
            width: 24px;
            height: 24px;
            font-size: 20px;
            text-align: center;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            margin-left: 280px;
            margin-top: 60px;
            padding: 30px;
            min-height: calc(100vh - 60px);
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        /* å†…å®¹é¡µé¢å®¹å™¨ */
        .content-page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .content-page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            background: white;
            padding: 25px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4CAF50;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            display: flex;
            align-items: center;
        }

        .page-title .icon {
            margin-right: 15px;
            font-size: 32px;
        }

        .page-subtitle {
            color: #7f8c8d;
            margin-top: 8px;
            font-size: 16px;
        }

        /* ç³»ç»ŸçŠ¶æ€ç½‘æ ¼ */
        .system-status {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .status-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .status-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .status-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-value.status-online {
            color: #28a745;
        }

        .status-value.status-warning {
            color: #ffc107;
        }

        .status-value.status-error {
            color: #dc3545;
        }

        .status-label {
            color: #666;
            font-size: 14px;
        }

        /* ä»ªè¡¨æ¿å¡ç‰‡ */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #4CAF50;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 48px;
            margin-right: 20px;
        }

        .card-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .card-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .card-action {
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* å¼¹çª—åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* è¡¨å•æ ·å¼ä¼˜åŒ– */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498DB;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
    </style>
</head>

<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="header-left">
            <div class="logo">ğŸŒ± æ¸©å®¤æ•°å­—åŒ–ç›‘æ§ç³»ç»Ÿ</div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <span>ğŸ‘¤ ç®¡ç†å‘˜</span>
                <button class="logout-btn" onclick="logoutSystem()">é€€å‡ºç³»ç»Ÿ</button>
            </div>
        </div>
    </header>

    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
        <nav class="sidebar-menu">
            <div class="menu-item active" onclick="showPage('dashboard')">
                <span class="icon">ğŸ“Š</span> ç³»ç»Ÿæ¦‚è§ˆ
            </div>
            <div class="menu-item" onclick="showPage('environment')">
                <span class="icon">ğŸŒ¡ï¸</span> ç¯å¢ƒç›‘æ§
            </div>
            <div class="menu-item" onclick="showPage('devices')">
                <span class="icon">âš™ï¸</span> è®¾å¤‡æ§åˆ¶
            </div>
            <div class="menu-item" onclick="showPage('alerts')">
                <span class="icon">ğŸš¨</span> æŠ¥è­¦ç®¡ç†
            </div>
            <div class="menu-item" onclick="showPage('tasks')">
                <span class="icon">â°</span> å®šæ—¶ä»»åŠ¡
            </div>
            <div class="menu-item" onclick="showPage('analytics')">
                <span class="icon">ğŸ“ˆ</span> æ•°æ®åˆ†æ
            </div>
            <div class="menu-item" onclick="showPage('history')">
                <span class="icon">ğŸ“‹</span> å†å²è®°å½•
            </div>
            <div class="menu-item" onclick="showPage('users')">
                <span class="icon">ğŸ‘¥</span> ç”¨æˆ·ç®¡ç†
            </div>
        </nav>
    </aside>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- ç³»ç»Ÿæ¦‚è§ˆé¡µé¢ -->
        <div id="dashboard-page" class="content-page active">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">ğŸ“Š</span>
                    ç³»ç»Ÿæ¦‚è§ˆ
                </h1>
                <p class="page-subtitle">æ¸©å®¤æ•°å­—åŒ–ç›‘æ§ç³»ç»Ÿæ€»è§ˆ</p>
            </div>

            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="system-status">
                <h2 style="margin-bottom: 20px;">ç³»ç»ŸçŠ¶æ€</h2>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-value status-online" id="systemStatus">æ­£å¸¸</div>
                        <div class="status-label">ç³»ç»ŸçŠ¶æ€</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value status-online" id="deviceCount">12</div>
                        <div class="status-label">åœ¨çº¿è®¾å¤‡</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value status-warning" id="alertCount">3</div>
                        <div class="status-label">å¾…å¤„ç†æŠ¥è­¦</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value status-online" id="taskStatus">è¿è¡Œä¸­</div>
                        <div class="status-label">å®šæ—¶ä»»åŠ¡</div>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½æ¨¡å—å¡ç‰‡ -->
            <div class="dashboard-cards">
                <div class="card environment-card" onclick="showPage('environment')">
                    <div class="card-header">
                        <div class="card-icon">ğŸŒ¡ï¸</div>
                        <div class="card-title">ç¯å¢ƒç›‘æ§</div>
                    </div>
                    <div class="card-description">
                        å®æ—¶ç›‘æ§æ¸©å®¤å†…çš„æ¸©åº¦ã€æ¹¿åº¦ã€å…‰ç…§å¼ºåº¦ã€åœŸå£¤æ¹¿åº¦å’ŒCO2æµ“åº¦ç­‰ç¯å¢ƒå‚æ•°
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>

                <div class="card device-card" onclick="showPage('devices')">
                    <div class="card-header">
                        <div class="card-icon">âš™ï¸</div>
                        <div class="card-title">è®¾å¤‡æ§åˆ¶</div>
                    </div>
                    <div class="card-description">
                        è¿œç¨‹æ§åˆ¶æ¸©å®¤å†…çš„åŠ çƒ­å™¨ã€å†·å´å™¨ã€åŠ æ¹¿å™¨ã€é£æ‰‡ã€è¡¥å…‰ç¯ç­‰è®¾å¤‡
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>

                <div class="card alert-card" onclick="showPage('alerts')">
                    <div class="card-header">
                        <div class="card-icon">ğŸš¨</div>
                        <div class="card-title">æŠ¥è­¦ç®¡ç†</div>
                    </div>
                    <div class="card-description">
                        ç®¡ç†ç¯å¢ƒå‚æ•°å¼‚å¸¸ã€è®¾å¤‡æ•…éšœç­‰å„ç±»æŠ¥è­¦ä¿¡æ¯ï¼ŒåŠæ—¶å“åº”å¤„ç†
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>

                <div class="card task-card" onclick="showPage('tasks')">
                    <div class="card-header">
                        <div class="card-icon">â°</div>
                        <div class="card-title">å®šæ—¶ä»»åŠ¡</div>
                    </div>
                    <div class="card-description">
                        ç®¡ç†æ•°æ®é‡‡é›†ã€è®¾å¤‡æ§åˆ¶ã€æŠ¥è­¦æ£€æµ‹ç­‰è‡ªåŠ¨åŒ–å®šæ—¶ä»»åŠ¡
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>

                <div class="card analytics-card" onclick="showPage('analytics')">
                    <div class="card-header">
                        <div class="card-icon">ğŸ“ˆ</div>
                        <div class="card-title">æ•°æ®åˆ†æ</div>
                    </div>
                    <div class="card-description">
                        åˆ†æç¯å¢ƒæ•°æ®è¶‹åŠ¿ï¼Œç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨ï¼Œä¼˜åŒ–æ¸©å®¤ç®¡ç†ç­–ç•¥
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>

                <div class="card history-card" onclick="showPage('history')">
                    <div class="card-header">
                        <div class="card-icon">ğŸ“‹</div>
                        <div class="card-title">å†å²è®°å½•</div>
                    </div>
                    <div class="card-description">
                        æŸ¥çœ‹å†å²ç¯å¢ƒæ•°æ®ã€è®¾å¤‡æ“ä½œè®°å½•ã€æŠ¥è­¦å¤„ç†è®°å½•ç­‰
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>

                <div class="card user-card" onclick="showPage('users')">
                    <div class="card-header">
                        <div class="card-icon">ğŸ‘¥</div>
                        <div class="card-title">ç”¨æˆ·ç®¡ç†</div>
                    </div>
                    <div class="card-description">
                        ç®¡ç†ç³»ç»Ÿç”¨æˆ·è´¦æˆ·ã€æƒé™è®¾ç½®ã€ç”¨æˆ·çŠ¶æ€ç›‘æ§ç­‰åŠŸèƒ½
                    </div>
                    <a href="#" class="card-action">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                </div>
            </div>
        </div>

        <!-- ç¯å¢ƒç›‘æ§é¡µé¢ -->
        <div id="environment-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">ğŸŒ¡ï¸</span>
                    ç¯å¢ƒç›‘æ§
                </h1>
                <p class="page-subtitle">å®æ—¶ç›‘æ§æ¸©å®¤ç¯å¢ƒå‚æ•°</p>
            </div>
            <div id="environment-content">æ­£åœ¨åŠ è½½ç¯å¢ƒç›‘æ§æ•°æ®...</div>
        </div>

        <!-- è®¾å¤‡æ§åˆ¶é¡µé¢ -->
        <div id="devices-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">âš™ï¸</span>
                    è®¾å¤‡æ§åˆ¶
                </h1>
                <p class="page-subtitle">è¿œç¨‹æ§åˆ¶æ¸©å®¤è®¾å¤‡</p>
            </div>
            <div id="devices-content">æ­£åœ¨åŠ è½½è®¾å¤‡æ§åˆ¶é¢æ¿...</div>
        </div>

        <!-- æŠ¥è­¦ç®¡ç†é¡µé¢ -->
        <div id="alerts-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">ğŸš¨</span>
                    æŠ¥è­¦ç®¡ç†
                </h1>
                <p class="page-subtitle">ç®¡ç†ç³»ç»ŸæŠ¥è­¦ä¿¡æ¯</p>
            </div>
            <div id="alerts-content">æ­£åœ¨åŠ è½½æŠ¥è­¦ç®¡ç†...</div>
        </div>

        <!-- å®šæ—¶ä»»åŠ¡é¡µé¢ -->
        <div id="tasks-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">â°</span>
                    å®šæ—¶ä»»åŠ¡ç®¡ç†
                </h1>
                <p class="page-subtitle">ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨åŒ–ä»»åŠ¡</p>
            </div>
            <div id="tasks-content">æ­£åœ¨åŠ è½½å®šæ—¶ä»»åŠ¡...</div>
        </div>

        <!-- æ•°æ®åˆ†æé¡µé¢ -->
        <div id="analytics-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">ğŸ“ˆ</span>
                    æ•°æ®åˆ†æ
                </h1>
                <p class="page-subtitle">åˆ†æç¯å¢ƒæ•°æ®å’Œç³»ç»Ÿæ€§èƒ½</p>
            </div>
            <div id="analytics-content">æ­£åœ¨åŠ è½½æ•°æ®åˆ†æ...</div>
        </div>

        <!-- å†å²è®°å½•é¡µé¢ -->
        <div id="history-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">ğŸ“‹</span>
                    å†å²è®°å½•
                </h1>
                <p class="page-subtitle">æŸ¥çœ‹ç³»ç»Ÿå†å²æ•°æ®</p>
            </div>
            <div id="history-content">æ­£åœ¨åŠ è½½å†å²è®°å½•...</div>
        </div>

        <!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
        <div id="users-page" class="content-page">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">ğŸ‘¥</span>
                    ç”¨æˆ·ç®¡ç†
                </h1>
                <p class="page-subtitle">ç®¡ç†ç³»ç»Ÿç”¨æˆ·è´¦æˆ·å’Œæƒé™</p>
            </div>
            <div id="users-content">æ­£åœ¨åŠ è½½ç”¨æˆ·ç®¡ç†...</div>
        </div>
    </main>
    <script>
        // æœ€å°åŒ–è„šæœ¬ - æ‰€æœ‰ä¸»è¦åŠŸèƒ½å·²ç§»è‡³ dashboard-emergency-fix.js
        console.log('Dashboard main script loading...');

        // ç¡®ä¿ç´§æ€¥ä¿®å¤è„šæœ¬å·²åŠ è½½
        if (typeof window.showPage !== 'function') {
            console.error('Emergency fix script not loaded! Defining fallback functions...');

            // åå¤‡å‡½æ•°å®šä¹‰
            window.showPage = function (pageId) {
                console.log('Fallback showPage called:', pageId);
                UserFriendlyAlert.showInfo('é¡µé¢åˆ‡æ¢åŠŸèƒ½æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨åå†è¯•...');
            };

            window.logoutSystem = function () {
                if (confirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ')) {
                    window.location.href = '/login.html';
                }
            };
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åŸºæœ¬åˆå§‹åŒ–

        // æ¶ˆæ¯æ˜ å°„è¡¨ - å°†æ“ä½œè½¬æ¢ä¸ºç”¨æˆ·å‹å¥½çš„æ¶ˆæ¯
        const MESSAGE_MAPPINGS = {
            // ç¯å¢ƒç›‘æ§ç›¸å…³
            'environment_data_refresh': 'ç¯å¢ƒæ•°æ®å·²åˆ·æ–°',
            'environment_data_export': 'ç¯å¢ƒæ•°æ®å¯¼å‡ºæˆåŠŸ',
            'environment_alerts_set': 'ç¯å¢ƒæŠ¥è­¦è®¾ç½®å·²ä¿å­˜',
            'environment_trends_generated': 'ç¯å¢ƒè¶‹åŠ¿åˆ†æå·²ç”Ÿæˆ',
            'sensors_calibrated': 'ä¼ æ„Ÿå™¨æ ¡å‡†å®Œæˆ',
            'environment_report_generated': 'ç¯å¢ƒç›‘æµ‹æŠ¥å‘Šç”ŸæˆæˆåŠŸ',

            // è®¾å¤‡æ§åˆ¶ç›¸å…³
            'device_start_all': 'æ‰€æœ‰è®¾å¤‡å¯åŠ¨æˆåŠŸ',
            'device_stop_all': 'æ‰€æœ‰è®¾å¤‡å·²åœæ­¢',
            'device_refresh': 'è®¾å¤‡çŠ¶æ€å·²æ›´æ–°',
            'device_start_single': 'è®¾å¤‡å¯åŠ¨æˆåŠŸ',
            'device_stop_single': 'è®¾å¤‡å·²åœæ­¢',

            // ä»»åŠ¡ç®¡ç†ç›¸å…³
            'tasks_start_all': 'æ‰€æœ‰ä»»åŠ¡å·²å¯åŠ¨',
            'tasks_stop_all': 'æ‰€æœ‰ä»»åŠ¡å·²åœæ­¢',
            'tasks_refresh': 'ä»»åŠ¡çŠ¶æ€å·²åˆ·æ–°',
            'tasks_trigger_all': 'ä»»åŠ¡æ‰‹åŠ¨è§¦å‘å®Œæˆ',

            // æ•°æ®åˆ†æç›¸å…³
            'report_generated': 'åˆ†ææŠ¥å‘Šç”ŸæˆæˆåŠŸ',
            'analytics_exported': 'åˆ†ææ•°æ®å¯¼å‡ºå®Œæˆ',
            'analytics_refreshed': 'åˆ†ææ•°æ®å·²æ›´æ–°',

            // æŠ¥è¡¨ä¸­å¿ƒç›¸å…³
            'daily_report_generated': 'ç¯å¢ƒæ•°æ®æ—¥æŠ¥ç”ŸæˆæˆåŠŸ',
            'daily_report_exported': 'ç¯å¢ƒæ•°æ®æ—¥æŠ¥å¯¼å‡ºæˆåŠŸ',
            'device_report_generated': 'è®¾å¤‡è¿è¡ŒæŠ¥å‘Šç”ŸæˆæˆåŠŸ',
            'device_report_exported': 'è®¾å¤‡è¿è¡ŒæŠ¥å‘Šå¯¼å‡ºæˆåŠŸ',
            'monthly_report_generated': 'æœˆåº¦åˆ†ææŠ¥å‘Šç”ŸæˆæˆåŠŸ',
            'monthly_report_exported': 'æœˆåº¦åˆ†ææŠ¥å‘Šå¯¼å‡ºæˆåŠŸ',
            'alert_report_generated': 'æŠ¥è­¦ç»Ÿè®¡æŠ¥å‘Šç”ŸæˆæˆåŠŸ',
            'alert_report_exported': 'æŠ¥è­¦ç»Ÿè®¡æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ',
            'comprehensive_report_generated': 'ç»¼åˆæŠ¥å‘Šç”ŸæˆæˆåŠŸ',
            'all_data_exported': 'å…¨éƒ¨æ•°æ®å¯¼å‡ºæˆåŠŸ',
            'all_analytics_refreshed': 'å…¨éƒ¨æ•°æ®å·²åˆ·æ–°',

            // å†å²è®°å½•ç›¸å…³
            'history_searched': 'å†å²è®°å½•æœç´¢å®Œæˆ',

            // ç”¨æˆ·ç®¡ç†ç›¸å…³
            'user_added': 'ç”¨æˆ·æ·»åŠ æˆåŠŸ',
            'user_edited': 'ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ',
            'user_deleted': 'ç”¨æˆ·åˆ é™¤æˆåŠŸ',
            'password_reset': 'å¯†ç é‡ç½®æˆåŠŸ',
            'user_list_exported': 'ç”¨æˆ·åˆ—è¡¨å¯¼å‡ºæˆåŠŸ',
            'user_list_refreshed': 'ç”¨æˆ·åˆ—è¡¨å·²åˆ·æ–°',
            'user_searched': 'ç”¨æˆ·æœç´¢å®Œæˆ',
            'logout_success': 'é€€å‡ºç³»ç»ŸæˆåŠŸ',

            // æŠ¥è­¦ç®¡ç†ç›¸å…³
            'alert_handled': 'æŠ¥è­¦å¤„ç†æˆåŠŸ',
            'alert_assigned': 'æŠ¥è­¦åˆ†é…æˆåŠŸ',
            'alert_ignored': 'æŠ¥è­¦å·²å¿½ç•¥',
            'alert_escalated': 'æŠ¥è­¦ä¸ŠæŠ¥æˆåŠŸ',
            'alerts_exported': 'æŠ¥è­¦è®°å½•å¯¼å‡ºæˆåŠŸ',
            'alerts_refreshed': 'æŠ¥è­¦åˆ—è¡¨å·²åˆ·æ–°',
            'alerts_filtered': 'æŠ¥è­¦ç­›é€‰å®Œæˆ'
        };

        // é”™è¯¯æ¶ˆæ¯æ˜ å°„è¡¨
        const ERROR_MAPPINGS = {
            'connection_failed': 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®',
            'server_error': 'æœåŠ¡å™¨æš‚æ—¶æ— æ³•å“åº”ï¼Œè¯·ç¨åé‡è¯•',
            'data_not_found': 'æœªæ‰¾åˆ°ç›¸å…³æ•°æ®',
            'permission_denied': 'æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜',
            'validation_failed': 'è¾“å…¥ä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•'
        };

        // æ¶ˆæ¯æ¸…ç†å™¨ç±»
        class MessageCleaner {
            // æ¸…ç†æŠ€æœ¯ä¿¡æ¯
            static cleanTechnicalInfo(message) {
                if (!message) return message;

                // ç§»é™¤æœåŠ¡å™¨åœ°å€å’Œç«¯å£ä¿¡æ¯
                let cleanedMessage = message
                    .replace(/localhost:\d+/g, '')
                    .replace(/http:\/\/[^\/\s]+/g, '')
                    .replace(/https:\/\/[^\/\s]+/g, '')
                    .replace(/\d+\.\d+\.\d+\.\d+:\d+/g, '')
                    .replace(/:\d+/g, '')
                    .replace(/localhost/g, '')
                    .replace(/127\.0\.0\.1/g, '');

                // æ¸…ç†å¤šä½™çš„ç©ºæ ¼å’Œæ ‡ç‚¹
                cleanedMessage = cleanedMessage
                    .replace(/\s+/g, ' ')
                    .replace(/^\s+|\s+$/g, '')
                    .replace(/^[:\-\s]+|[:\-\s]+$/g, '');

                return cleanedMessage || 'æ“ä½œå®Œæˆ';
            }

            // ç§»é™¤æœåŠ¡å™¨ä¿¡æ¯
            static removeServerInfo(message) {
                return this.cleanTechnicalInfo(message);
            }

            // ç§»é™¤ç«¯å£ä¿¡æ¯
            static removePortInfo(message) {
                return message ? message.replace(/:\d+/g, '') : message;
            }

            // æ¸…ç†URLä¿¡æ¯
            static cleanUrlInfo(message) {
                return message ? message.replace(/https?:\/\/[^\s]+/g, '') : message;
            }
        }

        // æ¶ˆæ¯æ ¼å¼åŒ–å™¨ç±»
        class MessageFormatter {
            // æ ¼å¼åŒ–æˆåŠŸæ¶ˆæ¯
            static formatSuccess(operation, details = null) {
                const baseMessage = MESSAGE_MAPPINGS[operation] || 'æ“ä½œæˆåŠŸ';
                const cleanMessage = MessageCleaner.cleanTechnicalInfo(baseMessage);
                return details ? `${cleanMessage} - ${details}` : cleanMessage;
            }

            // æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯
            static formatError(operation, error = null) {
                if (error && ERROR_MAPPINGS[error]) {
                    return ERROR_MAPPINGS[error];
                }

                const cleanError = error ? MessageCleaner.cleanTechnicalInfo(error) : 'æ“ä½œå¤±è´¥';
                return cleanError || 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
            }

            // æ ¼å¼åŒ–ä¿¡æ¯æç¤º
            static formatInfo(message) {
                return MessageCleaner.cleanTechnicalInfo(message) || 'ä¿¡æ¯æç¤º';
            }

            // æ ¼å¼åŒ–è­¦å‘Šæ¶ˆæ¯
            static formatWarning(message) {
                return MessageCleaner.cleanTechnicalInfo(message) || 'è­¦å‘Šæç¤º';
            }
        }

        // ç”¨æˆ·å‹å¥½çš„å¼¹æ¡†ç»„ä»¶ç±»
        class UserFriendlyAlert {
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            static showSuccess(message, duration = 3000) {
                const cleanMessage = MessageCleaner.cleanTechnicalInfo(message);
                this.showNotification(cleanMessage, 'success', duration);
            }

            // æ˜¾ç¤ºé”™è¯¯æç¤º
            static showError(message, duration = 5000) {
                const cleanMessage = MessageCleaner.cleanTechnicalInfo(message);
                this.showNotification(cleanMessage, 'error', duration);
            }

            // æ˜¾ç¤ºä¿¡æ¯æç¤º
            static showInfo(message, duration = 3000) {
                const cleanMessage = MessageCleaner.cleanTechnicalInfo(message);
                this.showNotification(cleanMessage, 'info', duration);
            }

            // æ˜¾ç¤ºè­¦å‘Šæç¤º
            static showWarning(message, duration = 4000) {
                const cleanMessage = MessageCleaner.cleanTechnicalInfo(message);
                this.showNotification(cleanMessage, 'warning', duration);
            }

            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            static showConfirm(message, onConfirm, onCancel) {
                const cleanMessage = MessageCleaner.cleanTechnicalInfo(message);
                this.showCustomConfirm(cleanMessage, onConfirm, onCancel);
            }

            // è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            static showCustomConfirm(message, onConfirm, onCancel) {
                // åˆ›å»ºé®ç½©å±‚
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 10001;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;

                // åˆ›å»ºå¯¹è¯æ¡†
                const dialog = document.createElement('div');
                dialog.style.cssText = `
                    background: white;
                    border-radius: 12px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    text-align: center;
                `;

                dialog.innerHTML = `
                    <div style="font-size: 18px; color: #333; margin-bottom: 25px; line-height: 1.5;">${message}</div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button id="confirm-btn" style="padding: 12px 24px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">ç¡®å®š</button>
                        <button id="cancel-btn" style="padding: 12px 24px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">å–æ¶ˆ</button>
                    </div>
                `;

                overlay.appendChild(dialog);
                document.body.appendChild(overlay);

                // ç»‘å®šäº‹ä»¶
                const confirmBtn = dialog.querySelector('#confirm-btn');
                const cancelBtn = dialog.querySelector('#cancel-btn');

                confirmBtn.addEventListener('click', () => {
                    document.body.removeChild(overlay);
                    if (onConfirm) onConfirm();
                });

                cancelBtn.addEventListener('click', () => {
                    document.body.removeChild(overlay);
                    if (onCancel) onCancel();
                });

                // ç‚¹å‡»é®ç½©å±‚å…³é—­
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        document.body.removeChild(overlay);
                        if (onCancel) onCancel();
                    }
                });
            }

            // é€šç”¨é€šçŸ¥æ˜¾ç¤ºæ–¹æ³•
            static showNotification(message, type = 'info', duration = 3000) {
                // åˆ›å»ºé€šçŸ¥å®¹å™¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                let container = document.getElementById('notification-container');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'notification-container';
                    container.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 10000;
                        pointer-events: none;
                    `;
                    document.body.appendChild(container);
                }

                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                const icons = {
                    success: 'âœ…',
                    error: 'âŒ',
                    warning: 'âš ï¸',
                    info: 'â„¹ï¸'
                };

                const colors = {
                    success: '#d4edda',
                    error: '#f8d7da',
                    warning: '#fff3cd',
                    info: '#d1ecf1'
                };

                const borderColors = {
                    success: '#c3e6cb',
                    error: '#f5c6cb',
                    warning: '#ffeaa7',
                    info: '#bee5eb'
                };

                notification.style.cssText = `
                    background: ${colors[type] || colors.info};
                    border: 1px solid ${borderColors[type] || borderColors.info};
                    border-radius: 8px;
                    padding: 12px 16px;
                    margin-bottom: 10px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    display: flex;
                    align-items: center;
                    font-size: 14px;
                    font-weight: 500;
                    color: #333;
                    pointer-events: auto;
                    transform: translateX(100%);
                    transition: transform 0.3s ease-in-out;
                    max-width: 350px;
                    word-wrap: break-word;
                `;

                notification.innerHTML = `
                    <span style="margin-right: 8px; font-size: 16px;">${icons[type] || icons.info}</span>
                    <span>${message}</span>
                `;

                container.appendChild(notification);

                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 10);

                // è‡ªåŠ¨éšè—
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, duration);

                // ç‚¹å‡»å…³é—­
                notification.addEventListener('click', () => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                });
            }
        }







        // é¡µé¢åˆ‡æ¢å‡½æ•°ï¼ˆå¤‡ç”¨å®šä¹‰ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå®šä¹‰å¤±è´¥ï¼‰
        if (typeof showPage === 'undefined') {
            function showPage(pageId) {
                // éšè—æ‰€æœ‰é¡µé¢
                document.querySelectorAll('.content-page').forEach(page => {
                    page.classList.remove('active');
                });

                // æ˜¾ç¤ºç›®æ ‡é¡µé¢
                const targetPage = document.getElementById(pageId + '-page');
                if (targetPage) {
                    targetPage.classList.add('active');
                }

                // æ›´æ–°èœå•çŠ¶æ€
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });

                // æ‰¾åˆ°è¢«ç‚¹å‡»çš„èœå•é¡¹å¹¶è®¾ä¸ºæ´»è·ƒçŠ¶æ€
                const clickedMenuItem = event ? event.target.closest('.menu-item') : null;
                if (clickedMenuItem) {
                    clickedMenuItem.classList.add('active');
                }

                // æ›´æ–°å½“å‰é¡µé¢
                currentPage = pageId;

                // åŠ è½½é¡µé¢å†…å®¹
                loadPageContent(pageId);
            }
        }

        // åŠ è½½é¡µé¢å†…å®¹
        function loadPageContent(pageId) {
            const contentContainer = document.getElementById(pageId + '-content');
            if (!contentContainer) return;

            switch (pageId) {
                case 'environment':
                    loadEnvironmentContent(contentContainer);
                    break;
                case 'devices':
                    loadDevicesContent(contentContainer);
                    break;
                case 'alerts':
                    loadAlertsContent(contentContainer);
                    break;
                case 'tasks':
                    loadTasksContent(contentContainer);
                    break;
                case 'analytics':
                    loadAnalyticsContent(contentContainer);
                    break;
                case 'history':
                    loadHistoryContent(contentContainer);
                    break;
                case 'users':
                    loadUsersContent(contentContainer);
                    break;
                default:
                    // é»˜è®¤æƒ…å†µä¸‹ä¸éœ€è¦åŠ è½½é¢å¤–å†…å®¹
                    break;
            }
        }

        // é€€å‡ºç³»ç»Ÿå‡½æ•°
        function logoutSystem() {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess('é€€å‡ºç³»ç»ŸæˆåŠŸ');
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„é€€å‡ºé€»è¾‘
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 1500);
                }
            );
        }

        // åŠ è½½ç¯å¢ƒç›‘æ§å†…å®¹
        async function loadEnvironmentContent(container) {
            container.innerHTML = `
                <!-- æ¸©å®¤é€‰æ‹©å™¨ -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ </span>æ¸©å®¤é€‰æ‹©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="greenhouse-btn active" onclick="selectGreenhouse(1)" style="padding: 12px 20px; background: #2C3E50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">1å·æ¸©å®¤ (è”¬èœåŒº)</button>
                        <button class="greenhouse-btn" onclick="selectGreenhouse(2)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">2å·æ¸©å®¤ (èŠ±å‰åŒº)</button>
                        <button class="greenhouse-btn" onclick="selectGreenhouse(3)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">3å·æ¸©å®¤ (è‚²è‹—åŒº)</button>
                        <button class="greenhouse-btn" onclick="selectGreenhouse(4)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">4å·æ¸©å®¤ (å®éªŒåŒº)</button>
                    </div>
                </div>

                <!-- ç¯å¢ƒå‚æ•°ç›‘æ§ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;" id="environmentGrid">
                    <!-- åŸºç¡€ç¯å¢ƒå‚æ•° -->
                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ¡ï¸</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">ç©ºæ°”æ¸©åº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="airTemp">23.5Â°C</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">æ­£å¸¸èŒƒå›´</div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ’§</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">ç©ºæ°”æ¹¿åº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="airHumidity">65.8%</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">æ­£å¸¸èŒƒå›´</div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">â˜€ï¸</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">å…‰ç…§å¼ºåº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="lightIntensity">25000 lux</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">å……è¶³</div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ±</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">åœŸå£¤æ¹¿åº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="soilMoisture">58.2%</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">é€‚å®œ</div>
                    </div>

                    <!-- æ‰©å±•ç¯å¢ƒå‚æ•° -->
                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ’¨</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">CO2æµ“åº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="co2Level">420 ppm</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">æ­£å¸¸</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ¡ï¸</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">åœŸå£¤æ¸©åº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="soilTemp">21.8Â°C</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">é€‚å®œ</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ¬ï¸</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">é£é€Ÿ</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="windSpeed">0.8 m/s</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">å¾®é£</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ§ª</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">åœŸå£¤pHå€¼</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="soilPH">6.8</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">é€‚å®œ</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">âš¡</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">åœŸå£¤ECå€¼</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="soilEC">1.2 mS/cm</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">æ­£å¸¸</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ¡ï¸</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">å¶é¢æ¸©åº¦</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="leafTemp">22.3Â°C</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">æ­£å¸¸</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒŠ</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">è’¸è…¾é€Ÿç‡</div>
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px; color: #2C3E50;" id="transpiration">2.4 mm/h</div>
                        <div style="color: #27AE60; font-size: 14px; font-weight: 600;">æ­£å¸¸</div>
                    </div>
                </div>

                <!-- ç¯å¢ƒè´¨é‡ç»¼åˆè¯„ä¼° -->
                <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ“Š</span>ç¯å¢ƒè´¨é‡è¯„ä¼°
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #27AE60; margin-bottom: 5px;">ä¼˜ç§€</div>
                            <div style="font-size: 14px; color: #666;">ç»¼åˆç¯å¢ƒè¯„çº§</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #3498DB; margin-bottom: 5px;">96.8%</div>
                            <div style="font-size: 14px; color: #666;">ç¯å¢ƒé€‚å®œåº¦</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #F39C12; margin-bottom: 5px;">12</div>
                            <div style="font-size: 14px; color: #666;">ä¼ æ„Ÿå™¨æ•°é‡</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #8E44AD; margin-bottom: 5px;">æ­£å¸¸</div>
                            <div style="font-size: 14px; color: #666;">ç³»ç»ŸçŠ¶æ€</div>
                        </div>
                    </div>
                </div>
                
                <!-- æ§åˆ¶é¢æ¿ -->
                <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ› ï¸</span>ç›‘æ§æ§åˆ¶
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                        <button style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="refreshEnvironmentData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                        <button style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="exportEnvironmentData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                        <button style="padding: 12px 20px; background: #F39C12; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="setEnvironmentAlerts()">âš ï¸ è®¾ç½®æŠ¥è­¦</button>
                        <button style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="viewEnvironmentTrends()">ğŸ“ˆ æŸ¥çœ‹è¶‹åŠ¿</button>
                        <button style="padding: 12px 20px; background: #E74C3C; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="calibrateSensors()">ğŸ”§ ä¼ æ„Ÿå™¨æ ¡å‡†</button>
                        <button style="padding: 12px 20px; background: #2C3E50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="generateEnvironmentReport()">ğŸ“‹ ç”ŸæˆæŠ¥å‘Š</button>
                    </div>
                </div>
            `;

            // å¯åŠ¨æ•°æ®æ›´æ–°
            setInterval(updateEnvironmentData, 30000);
        }



        // åŠ è½½æŠ¥è­¦ç®¡ç†å†…å®¹
        async function loadAlertsContent(container) {
            container.innerHTML = `
                <!-- æ¸©å®¤é€‰æ‹©å™¨ -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ </span>æ¸©å®¤é€‰æ‹©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="alert-greenhouse-btn active" onclick="selectAlertGreenhouse(1)" style="padding: 12px 20px; background: #2C3E50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">1å·æ¸©å®¤ (è”¬èœåŒº)</button>
                        <button class="alert-greenhouse-btn" onclick="selectAlertGreenhouse(2)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">2å·æ¸©å®¤ (èŠ±å‰åŒº)</button>
                        <button class="alert-greenhouse-btn" onclick="selectAlertGreenhouse(3)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">3å·æ¸©å®¤ (è‚²è‹—åŒº)</button>
                        <button class="alert-greenhouse-btn" onclick="selectAlertGreenhouse(4)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">4å·æ¸©å®¤ (å®éªŒåŒº)</button>
                    </div>
                </div>

                <!-- æŠ¥è­¦ç»Ÿè®¡å¡ç‰‡ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;" id="alertStatsGrid">
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 10px;">ğŸš¨</div>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px; color: #E74C3C;" id="criticalAlerts">2</div>
                        <div style="color: #666; font-size: 14px;">ä¸¥é‡æŠ¥è­¦</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 10px;">âš ï¸</div>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px; color: #F39C12;" id="warningAlerts">5</div>
                        <div style="color: #666; font-size: 14px;">è­¦å‘ŠæŠ¥è­¦</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 10px;">â„¹ï¸</div>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px; color: #3498DB;" id="infoAlerts">3</div>
                        <div style="color: #666; font-size: 14px;">ä¿¡æ¯æŠ¥è­¦</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 10px;">âœ…</div>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px; color: #27AE60;" id="resolvedAlerts">12</div>
                        <div style="color: #666; font-size: 14px;">å·²å¤„ç†</div>
                    </div>
                </div>

                <!-- æŠ¥è­¦ç­›é€‰å·¥å…·æ  -->
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0; color: #333; display: flex; align-items: center; font-size: 16px;">
                            <span style="margin-right: 10px;">ğŸ”</span>æŠ¥è­¦ç­›é€‰
                        </h4>
                        <button style="padding: 6px 12px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="refreshAlerts()">ğŸ”„ åˆ·æ–°</button>
                    </div>
                    
                    <!-- ç­›é€‰æ¡ä»¶ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 11px; color: #666; font-weight: 600;">æŠ¥è­¦ä¸¥é‡ç¨‹åº¦</label>
                            <select id="alertTypeFilter" onchange="applyAlertFilters()" style="width: 100%; padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                <option value="">å…¨éƒ¨</option>
                                <option value="ä¸¥é‡">ä¸¥é‡</option>
                                <option value="è­¦å‘Š">è­¦å‘Š</option>
                                <option value="ä¿¡æ¯">ä¿¡æ¯</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 11px; color: #666; font-weight: 600;">å¤„ç†çŠ¶æ€</label>
                            <select id="alertStatusFilter" onchange="applyAlertFilters()" style="width: 100%; padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="æœªå¤„ç†">æœªå¤„ç†</option>
                                <option value="å¤„ç†ä¸­">å¤„ç†ä¸­</option>
                                <option value="å·²å¤„ç†">å·²å¤„ç†</option>
                                <option value="å·²å¿½ç•¥">å·²å¿½ç•¥</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 11px; color: #666; font-weight: 600;">æ—¥æœŸç­›é€‰</label>
                            <input type="date" id="alertDateFilter" onchange="applyAlertFilters()" style="width: 100%; padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 11px; color: #666; font-weight: 600;">å…³é”®è¯æœç´¢</label>
                            <input type="text" id="alertKeywordFilter" placeholder="æœç´¢å…³é”®è¯..." oninput="applyAlertFilters()" style="width: 100%; padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button onclick="clearAlertFilters()" style="width: 100%; padding: 6px 10px; background: #95A5A6; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 11px;">æ¸…é™¤ç­›é€‰</button>
                        </div>
                    </div>
                </div>

                <!-- æŠ¥è­¦åˆ—è¡¨ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <!-- æŠ¥è­¦åˆ—è¡¨æ ‡é¢˜å’Œå†…å®¹ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸš¨</span>æŠ¥è­¦åˆ—è¡¨
                            <span style="margin-left: 10px; font-size: 14px; color: #666; font-weight: normal;" id="alertCountDisplay">å…± 0 æ¡æŠ¥è­¦</span>
                        </h3>
                    </div>
                    <div id="alertsList">
                        ${generateAlertItems(currentAlertGreenhouse)}
                    </div>
                </div>
            `;
        }

        // åŠ è½½å®šæ—¶ä»»åŠ¡å†…å®¹
        async function loadTasksContent(container) {
            container.innerHTML = `
                <div style="background: #2C3E50; border-radius: 12px; padding: 20px; margin-bottom: 30px; color: white;">
                    <h3 style="margin-bottom: 15px; font-size: 1.3rem;">ğŸš€ ç³»ç»Ÿè‡ªåŠ¨åŒ–ç‰¹æ€§</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="display: flex; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; font-size: 14px;">âœ“ æ¯30ç§’è‡ªåŠ¨ç”Ÿæˆç¯å¢ƒæ•°æ®</div>
                        <div style="display: flex; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; font-size: 14px;">âœ“ æ¯1åˆ†é’Ÿæ›´æ–°è®¾å¤‡çŠ¶æ€</div>
                        <div style="display: flex; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; font-size: 14px;">âœ“ æ¯2åˆ†é’Ÿæ‰§è¡Œè‡ªåŠ¨åŒ–æ§åˆ¶</div>
                        <div style="display: flex; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; font-size: 14px;">âœ“ æ¯1åˆ†é’Ÿæ£€æµ‹ç¯å¢ƒæŠ¥è­¦</div>
                    </div>
                </div>
                
                <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                        <button style="padding: 15px 25px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="startAllTasks()">ğŸš€ å¯åŠ¨æ‰€æœ‰ä»»åŠ¡</button>
                        <button style="padding: 15px 25px; background: #E74C3C; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="stopAllTasks()">ğŸ›‘ åœæ­¢æ‰€æœ‰ä»»åŠ¡</button>
                        <button style="padding: 15px 25px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="refreshTaskStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
                        <button style="padding: 15px 25px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="triggerAllTasks()">âš¡ æ‰‹åŠ¨è§¦å‘æ‰€æœ‰ä»»åŠ¡</button>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div style="display: flex; align-items: center; font-size: 1.1rem; font-weight: 500;">
                            <span style="width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background: #56ab2f; box-shadow: 0 0 10px rgba(86, 171, 47, 0.5); animation: pulse 2s infinite;" id="taskStatusDot"></span>
                            <span>ç³»ç»ŸçŠ¶æ€ï¼š<strong id="taskStatusText">è¿è¡Œä¸­</strong></span>
                        </div>
                    </div>
                </div>

                <!-- ä»»åŠ¡åˆ—è¡¨ -->
                <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">å½“å‰ä»»åŠ¡åˆ—è¡¨</h3>
                    <div style="background: rgba(248, 249, 250, 0.8); border-radius: 15px; overflow: hidden; border: 1px solid rgba(0, 0, 0, 0.1);">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1.5fr 1.5fr 1.5fr 1fr 1.5fr; background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%); color: white; font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">ä»»åŠ¡åç§°</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">çŠ¶æ€</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">æ‰§è¡Œé¢‘ç‡</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">ä¸Šæ¬¡æ‰§è¡Œ</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">ä¸‹æ¬¡æ‰§è¡Œ</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">æ‰§è¡Œæ¬¡æ•°</div>
                            <div style="padding: 15px 12px; text-align: center;">æ“ä½œ</div>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${generateTaskListHTML()}
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin: 30px 0;">
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: #2C3E50;"></div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">ç¯å¢ƒæ•°æ®ç”Ÿæˆ</div>
                        <div style="font-size: 2.5rem; font-weight: 700; color: #333; margin-bottom: 10px;" id="envTaskCount">156</div>
                        <div style="font-size: 12px; color: #888; font-weight: 500;">æ¬¡æ‰§è¡Œ</div>
                    </div>
                    
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: #34495E;"></div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">è®¾å¤‡çŠ¶æ€æ›´æ–°</div>
                        <div style="font-size: 2.5rem; font-weight: 700; color: #333; margin-bottom: 10px;" id="deviceTaskCount">89</div>
                        <div style="font-size: 12px; color: #888; font-weight: 500;">æ¬¡æ‰§è¡Œ</div>
                    </div>
                    
                    <div style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: #5D6D7E;"></div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">æŠ¥è­¦æ£€æµ‹</div>
                        <div style="font-size: 2.5rem; font-weight: 700; color: #333; margin-bottom: 10px;" id="alertTaskCount">67</div>
                        <div style="font-size: 12px; color: #888; font-weight: 500;">æ¬¡æ‰§è¡Œ</div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½æ•°æ®åˆ†æå†…å®¹
        async function loadAnalyticsContent(container) {
            container.innerHTML = `
                <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #2C3E50; border-radius: 12px; padding: 25px; color: white; box-shadow: 0 4px 15px rgba(44, 62, 80, 0.15);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 32px; margin-right: 15px;">ğŸ“Š</span>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; opacity: 0.9;">æ€»æ•°æ®ç‚¹</h4>
                                <div style="font-size: 28px; font-weight: bold; margin-top: 5px;">12,847</div>
                            </div>
                        </div>
                        <div style="font-size: 14px; opacity: 0.8;">è¾ƒæ˜¨æ—¥å¢é•¿ +8.5%</div>
                    </div>
                    
                    <div style="background: #34495E; border-radius: 12px; padding: 25px; color: white; box-shadow: 0 4px 15px rgba(52, 73, 94, 0.15);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 32px; margin-right: 15px;">ğŸ“ˆ</span>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; opacity: 0.9;">å¹³å‡æ¸©åº¦</h4>
                                <div style="font-size: 28px; font-weight: bold; margin-top: 5px;">24.3Â°C</div>
                            </div>
                        </div>
                        <div style="font-size: 14px; opacity: 0.8;">è¶‹åŠ¿ï¼šç¨³å®šä¸Šå‡</div>
                    </div>
                    
                    <div style="background: #5D6D7E; border-radius: 12px; padding: 25px; color: white; box-shadow: 0 4px 15px rgba(93, 109, 126, 0.15);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 32px; margin-right: 15px;">ğŸ’§</span>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; opacity: 0.9;">å¹³å‡æ¹¿åº¦</h4>
                                <div style="font-size: 28px; font-weight: bold; margin-top: 5px;">67.8%</div>
                            </div>
                        </div>
                        <div style="font-size: 14px; opacity: 0.8;">è¶‹åŠ¿ï¼šè½»å¾®ä¸‹é™</div>
                    </div>
                    
                    <div style="background: #566573; border-radius: 12px; padding: 25px; color: white; box-shadow: 0 4px 15px rgba(86, 101, 115, 0.15);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 32px; margin-right: 15px;">âš¡</span>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; opacity: 0.9;">ç³»ç»Ÿæ•ˆç‡</h4>
                                <div style="font-size: 28px; font-weight: bold; margin-top: 5px;">96.7%</div>
                            </div>
                        </div>
                        <div style="font-size: 14px; opacity: 0.8;">è¿è¡ŒçŠ¶æ€ï¼šä¼˜ç§€</div>
                    </div>
                </div>

                <!-- è¯¦ç»†æ•°æ®åˆ†æ -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“Š</span>ç¯å¢ƒæ•°æ®è¶‹åŠ¿åˆ†æ
                        </h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #4CAF50;">
                                <div style="font-size: 14px; color: #666; margin-bottom: 5px;">æ¸©åº¦å˜åŒ–ç‡</div>
                                <div style="font-size: 20px; font-weight: bold; color: #4CAF50;">+2.3%</div>
                                <div style="font-size: 12px; color: #999;">è¿‡å»7å¤©</div>
                            </div>
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #2196F3;">
                                <div style="font-size: 14px; color: #666; margin-bottom: 5px;">æ¹¿åº¦ç¨³å®šæ€§</div>
                                <div style="font-size: 20px; font-weight: bold; color: #2196F3;">98.5%</div>
                                <div style="font-size: 12px; color: #999;">ç¨³å®šåº¦æŒ‡æ ‡</div>
                            </div>
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #FF9800;">
                                <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å…‰ç…§åˆ©ç”¨ç‡</div>
                                <div style="font-size: 20px; font-weight: bold; color: #FF9800;">87.2%</div>
                                <div style="font-size: 12px; color: #999;">æ—¥å‡åˆ©ç”¨ç‡</div>
                            </div>
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #9C27B0;">
                                <div style="font-size: 14px; color: #666; margin-bottom: 5px;">åœŸå£¤å¥åº·åº¦</div>
                                <div style="font-size: 20px; font-weight: bold; color: #9C27B0;">ä¼˜ç§€</div>
                                <div style="font-size: 12px; color: #999;">ç»¼åˆè¯„ä¼°</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ¯</span>å…³é”®æŒ‡æ ‡
                        </h3>
                        <div style="space-y: 15px;">
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-size: 14px; color: #666;">èƒ½è€—æ•ˆç‡</span>
                                    <span style="font-size: 14px; font-weight: bold; color: #4CAF50;">92%</span>
                                </div>
                                <div style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px;">
                                    <div style="width: 92%; height: 100%; background: #27AE60; border-radius: 4px;"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-size: 14px; color: #666;">è®¾å¤‡è¿è¡Œç‡</span>
                                    <span style="font-size: 14px; font-weight: bold; color: #3498DB;">96%</span>
                                </div>
                                <div style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px;">
                                    <div style="width: 96%; height: 100%; background: #3498DB; border-radius: 4px;"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-size: 14px; color: #666;">æ•°æ®å‡†ç¡®æ€§</span>
                                    <span style="font-size: 14px; font-weight: bold; color: #F39C12;">99%</span>
                                </div>
                                <div style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px;">
                                    <div style="width: 99%; height: 100%; background: #F39C12; border-radius: 4px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æŠ¥è¡¨ä¸­å¿ƒ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 25px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ“‹</span>æŠ¥è¡¨ä¸­å¿ƒ
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='#4CAF50'; this.style.boxShadow='0 4px 15px rgba(76, 175, 80, 0.2)'" onmouseout="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <span style="font-size: 24px; margin-right: 12px;">ğŸ“Š</span>
                                <div>
                                    <h4 style="margin: 0; color: #333;">ç¯å¢ƒæ•°æ®æ—¥æŠ¥</h4>
                                    <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">æ¯æ—¥ç¯å¢ƒå‚æ•°ç»Ÿè®¡åˆ†æ</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="generateDailyReport()">ç”ŸæˆæŠ¥è¡¨</button>
                                <button style="flex: 1; padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="exportDailyReport()">å¯¼å‡ºæŠ¥è¡¨</button>
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='#2196F3'; this.style.boxShadow='0 4px 15px rgba(33, 150, 243, 0.2)'" onmouseout="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <span style="font-size: 24px; margin-right: 12px;">âš™ï¸</span>
                                <div>
                                    <h4 style="margin: 0; color: #333;">è®¾å¤‡è¿è¡ŒæŠ¥å‘Š</h4>
                                    <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">è®¾å¤‡çŠ¶æ€å’Œè¿è¡Œæ•ˆç‡åˆ†æ</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="generateDeviceReport()">ç”ŸæˆæŠ¥è¡¨</button>
                                <button style="flex: 1; padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="exportDeviceReport()">å¯¼å‡ºæŠ¥è¡¨</button>
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='#FF9800'; this.style.boxShadow='0 4px 15px rgba(255, 152, 0, 0.2)'" onmouseout="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <span style="font-size: 24px; margin-right: 12px;">ğŸ“ˆ</span>
                                <div>
                                    <h4 style="margin: 0; color: #333;">æœˆåº¦åˆ†ææŠ¥å‘Š</h4>
                                    <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">æœˆåº¦æ•°æ®è¶‹åŠ¿å’Œå¯¹æ¯”åˆ†æ</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="generateMonthlyReport()">ç”ŸæˆæŠ¥è¡¨</button>
                                <button style="flex: 1; padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="exportMonthlyReport()">å¯¼å‡ºæŠ¥è¡¨</button>
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='#9C27B0'; this.style.boxShadow='0 4px 15px rgba(156, 39, 176, 0.2)'" onmouseout="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <span style="font-size: 24px; margin-right: 12px;">ğŸš¨</span>
                                <div>
                                    <h4 style="margin: 0; color: #333;">æŠ¥è­¦ç»Ÿè®¡æŠ¥å‘Š</h4>
                                    <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">ç³»ç»ŸæŠ¥è­¦è®°å½•å’Œå¤„ç†ç»Ÿè®¡</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="generateAlertReport()">ç”ŸæˆæŠ¥è¡¨</button>
                                <button style="flex: 1; padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;" onclick="exportAlertReport()">å¯¼å‡ºæŠ¥è¡¨</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæ“ä½œå·¥å…·æ  -->
                <div style="background: #34495E; border-radius: 15px; padding: 25px; color: white;">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ› ï¸</span>å¿«é€Ÿæ“ä½œ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button style="padding: 15px 20px; background: rgba(255, 255, 255, 0.2); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'" onclick="generateComprehensiveReport()">ğŸ“Š ç”Ÿæˆç»¼åˆæŠ¥å‘Š</button>
                        <button style="padding: 15px 20px; background: rgba(255, 255, 255, 0.2); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'" onclick="exportAllData()">ğŸ’¾ å¯¼å‡ºå…¨éƒ¨æ•°æ®</button>
                        <button style="padding: 15px 20px; background: rgba(255, 255, 255, 0.2); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'" onclick="refreshAllAnalytics()">ğŸ”„ åˆ·æ–°å…¨éƒ¨æ•°æ®</button>
                        <button style="padding: 15px 20px; background: rgba(255, 255, 255, 0.2); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'" onclick="scheduleReport()">â° å®šæ—¶æŠ¥å‘Šè®¾ç½®</button>
                    </div>
                </div>
            `;
        }

        // åŠ è½½å†å²è®°å½•å†…å®¹
        async function loadHistoryContent(container) {
            container.innerHTML = `
                <!-- æ¸©å®¤é€‰æ‹©å™¨ -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ </span>æ¸©å®¤é€‰æ‹©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="history-greenhouse-btn active" onclick="selectHistoryGreenhouse(1)" style="padding: 12px 20px; background: #2C3E50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">1å·æ¸©å®¤ (è”¬èœåŒº)</button>
                        <button class="history-greenhouse-btn" onclick="selectHistoryGreenhouse(2)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">2å·æ¸©å®¤ (èŠ±å‰åŒº)</button>
                        <button class="history-greenhouse-btn" onclick="selectHistoryGreenhouse(3)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">3å·æ¸©å®¤ (è‚²è‹—åŒº)</button>
                        <button class="history-greenhouse-btn" onclick="selectHistoryGreenhouse(4)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">4å·æ¸©å®¤ (å®éªŒåŒº)</button>
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ”</span>ç­›é€‰æ¡ä»¶
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <select style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option>é€‰æ‹©æ•°æ®ç±»å‹</option>
                            <option>ç¯å¢ƒæ•°æ®</option>
                            <option>è®¾å¤‡æ“ä½œ</option>
                            <option>æŠ¥è­¦è®°å½•</option>
                            <option>ç”¨æˆ·æ“ä½œ</option>
                            <option>ç³»ç»Ÿäº‹ä»¶</option>
                        </select>
                        <input type="date" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                        <input type="date" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                        <button style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="searchHistory()">ğŸ” æœç´¢è®°å½•</button>
                        <button style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="exportHistory()">ğŸ“¤ å¯¼å‡ºè®°å½•</button>
                    </div>
                </div>
                
                <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px;">å†å²è®°å½•</h3>
                    <div id="historyList">
                        ${generateHistoryItems()}
                    </div>
                </div>
            `;
        }

        // åŠ è½½ç”¨æˆ·ç®¡ç†å†…å®¹
        async function loadUsersContent(container) {
            container.innerHTML = `
                <!-- ç”¨æˆ·ç®¡ç†æ“ä½œæ  -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ› ï¸</span>ç”¨æˆ·æ“ä½œ
                        </h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button style="padding: 12px 20px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="batchManageUsers()">ğŸ“‹ æ‰¹é‡åˆ é™¤</button>
                        <button style="padding: 12px 20px; background: #FF9800; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="exportUserList()">ğŸ“¤ å¯¼å‡ºç”¨æˆ·åˆ—è¡¨</button>
                        <button style="padding: 12px 20px; background: #607D8B; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="refreshUserList()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                    </div>
                </div>

                <!-- ç”¨æˆ·åˆ—è¡¨ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ“‹</span>ç”¨æˆ·åˆ—è¡¨
                    </h3>
                    
                    <!-- æœç´¢æ  -->
                    <div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                        <input type="text" placeholder="æœç´¢ç”¨æˆ·åæˆ–é‚®ç®±..." style="flex: 1; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;" id="userSearchInput">
                        <select style="padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="">å…¨éƒ¨è§’è‰²</option>
                            <option value="admin">ç®¡ç†å‘˜</option>
                            <option value="user">æ™®é€šç”¨æˆ·</option>
                        </select>
                        <button style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer;" onclick="searchUsers()">æœç´¢</button>
                    </div>
                    
                    <!-- ç”¨æˆ·è¡¨æ ¼ -->
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead>
                                <tr style="background: #f8f9fa; border-bottom: 2px solid #e0e0e0;">
                                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #333;">
                                        <input type="checkbox" onclick="toggleAllUsers(this)" style="margin-right: 8px;">
                                        ç”¨æˆ·ä¿¡æ¯
                                    </th>
                                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #333;">è§’è‰²</th>
                                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #333;">çŠ¶æ€</th>
                                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #333;">æœ€åç™»å½•</th>
                                    <th style="padding: 15px; text-align: center; font-weight: 600; color: #333;">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                ${generateUserTableRows()}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // è®¾å¤‡æ•°æ®å­˜å‚¨
        const devicesByGreenhouse = {
            1: [
                {
                    name: 'åŠ çƒ­å™¨A1', icon: 'ğŸ”¥', status: 'è¿è¡Œä¸­', color: '#27AE60',
                    runningHours: 720, usageFrequency: 85, lastMaintenance: '2024-07-15',
                    nextMaintenance: '2024-08-15', maintenanceStatus: 'éœ€è¦ç»´æŠ¤',
                    maintenanceRecords: [
                        { date: '2024-07-15', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´åŠ çƒ­å…ƒä»¶ï¼Œæ£€æŸ¥ç”µè·¯è¿æ¥', technician: 'å¼ å¸ˆå‚…' },
                        { date: '2024-06-10', type: 'æ•…éšœç»´ä¿®', description: 'æ›´æ¢æ¸©åº¦ä¼ æ„Ÿå™¨', technician: 'æå¸ˆå‚…' }
                    ]
                },
                {
                    name: 'å†·å´å™¨A1', icon: 'â„ï¸', status: 'å¾…æœº', color: '#3498DB',
                    runningHours: 450, usageFrequency: 60, lastMaintenance: '2024-08-01',
                    nextMaintenance: '2024-09-01', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-08-01', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´å†·å‡å™¨ï¼Œæ£€æŸ¥åˆ¶å†·å‰‚', technician: 'ç‹å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'åŠ æ¹¿å™¨A1', icon: 'ğŸ’¨', status: 'è¿è¡Œä¸­', color: '#5DADE2',
                    runningHours: 320, usageFrequency: 70, lastMaintenance: '2024-07-20',
                    nextMaintenance: '2024-08-20', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-07-20', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´æ°´ç®±ï¼Œæ›´æ¢æ»¤èŠ¯', technician: 'é™ˆå¸ˆå‚…' }
                    ]
                },
                {
                    name: 'é£æ‰‡A1', icon: 'ğŸŒªï¸', status: 'è¿è¡Œä¸­', color: '#58D68D',
                    runningHours: 890, usageFrequency: 95, lastMaintenance: '2024-06-30',
                    nextMaintenance: '2024-08-14', maintenanceStatus: 'å³å°†åˆ°æœŸ',
                    maintenanceRecords: [
                        { date: '2024-06-30', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´å¶ç‰‡ï¼Œæ¶¦æ»‘è½´æ‰¿', technician: 'åˆ˜å¸ˆå‚…' },
                        { date: '2024-05-15', type: 'æ•…éšœç»´ä¿®', description: 'æ›´æ¢ç”µæœºè½´æ‰¿', technician: 'å¼ å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'è¡¥å…‰ç¯A1', icon: 'ğŸ’¡', status: 'å…³é—­', color: '#F7DC6F',
                    runningHours: 1200, usageFrequency: 80, lastMaintenance: '2024-05-10',
                    nextMaintenance: '2024-08-10', maintenanceStatus: 'å·²è¿‡æœŸ',
                    maintenanceRecords: [
                        { date: '2024-05-10', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´ç¯å…·ï¼Œæ£€æŸ¥LEDæ¨¡å—', technician: 'èµµå¸ˆå‚…' }
                    ]
                },
                {
                    name: 'æ°´æ³µA1', icon: 'ğŸš°', status: 'è¿è¡Œä¸­', color: '#85C1E9',
                    runningHours: 650, usageFrequency: 75, lastMaintenance: '2024-07-25',
                    nextMaintenance: '2024-08-25', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-07-25', type: 'å®šæœŸä¿å…»', description: 'æ£€æŸ¥æ°´æ³µå¯†å°ï¼Œæ¸…æ´è¿‡æ»¤å™¨', technician: 'å­™å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'é€šé£ç³»ç»ŸA1', icon: 'ğŸŒ¬ï¸', status: 'è¿è¡Œä¸­', color: '#A9DFBF',
                    runningHours: 780, usageFrequency: 88, lastMaintenance: '2024-07-05',
                    nextMaintenance: '2024-08-16', maintenanceStatus: 'å³å°†åˆ°æœŸ',
                    maintenanceRecords: [
                        { date: '2024-07-05', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´é€šé£ç®¡é“ï¼Œæ£€æŸ¥é£é—¨', technician: 'é©¬å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'CO2å‘ç”Ÿå™¨A1', icon: 'ğŸ’¨', status: 'å¾…æœº', color: '#D7DBDD',
                    runningHours: 280, usageFrequency: 45, lastMaintenance: '2024-08-05',
                    nextMaintenance: '2024-09-05', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-08-05', type: 'å®šæœŸä¿å…»', description: 'æ£€æŸ¥CO2æµ“åº¦ä¼ æ„Ÿå™¨ï¼Œæ¸…æ´å‘ç”Ÿå™¨', technician: 'å‘¨å¸ˆå‚…' }
                    ]
                }
            ],
            2: [
                {
                    name: 'åŠ çƒ­å™¨B1', icon: 'ğŸ”¥', status: 'å¾…æœº', color: '#95A5A6',
                    runningHours: 380, usageFrequency: 55, lastMaintenance: '2024-08-01',
                    nextMaintenance: '2024-09-01', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-08-01', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´åŠ çƒ­å…ƒä»¶ï¼Œæ£€æŸ¥ç”µè·¯', technician: 'å¼ å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'å†·å´å™¨B1', icon: 'â„ï¸', status: 'è¿è¡Œä¸­', color: '#3498DB',
                    runningHours: 520, usageFrequency: 70, lastMaintenance: '2024-07-28',
                    nextMaintenance: '2024-08-28', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-07-28', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´å†·å‡å™¨ï¼Œæ£€æŸ¥åˆ¶å†·å‰‚', technician: 'ç‹å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'åŠ æ¹¿å™¨B1', icon: 'ğŸ’¨', status: 'è¿è¡Œä¸­', color: '#5DADE2',
                    runningHours: 420, usageFrequency: 65, lastMaintenance: '2024-07-15',
                    nextMaintenance: '2024-08-15', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-07-15', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´æ°´ç®±ï¼Œæ›´æ¢æ»¤èŠ¯', technician: 'é™ˆå¸ˆå‚…' }
                    ]
                },
                {
                    name: 'é£æ‰‡B1', icon: 'ğŸŒªï¸', status: 'è¿è¡Œä¸­', color: '#58D68D',
                    runningHours: 680, usageFrequency: 80, lastMaintenance: '2024-07-10',
                    nextMaintenance: '2024-08-18', maintenanceStatus: 'å³å°†åˆ°æœŸ',
                    maintenanceRecords: [
                        { date: '2024-07-10', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´å¶ç‰‡ï¼Œæ¶¦æ»‘è½´æ‰¿', technician: 'åˆ˜å¸ˆå‚…' }
                    ]
                }
            ],
            3: [
                {
                    name: 'åŠ çƒ­å™¨C1', icon: 'ğŸ”¥', status: 'è¿è¡Œä¸­', color: '#E74C3C',
                    runningHours: 290, usageFrequency: 50, lastMaintenance: '2024-08-05',
                    nextMaintenance: '2024-09-05', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-08-05', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´åŠ çƒ­å…ƒä»¶', technician: 'å¼ å¸ˆå‚…' }
                    ]
                },
                {
                    name: 'è‚²è‹—ç¯C1', icon: 'ğŸ’¡', status: 'è¿è¡Œä¸­', color: '#F7DC6F',
                    runningHours: 850, usageFrequency: 90, lastMaintenance: '2024-06-20',
                    nextMaintenance: '2024-08-12', maintenanceStatus: 'å·²è¿‡æœŸ',
                    maintenanceRecords: [
                        { date: '2024-06-20', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´ç¯å…·ï¼Œæ£€æŸ¥LEDæ¨¡å—', technician: 'èµµå¸ˆå‚…' }
                    ]
                },
                {
                    name: 'æ»´çŒç³»ç»ŸC1', icon: 'ğŸ’§', status: 'è¿è¡Œä¸­', color: '#85C1E9',
                    runningHours: 340, usageFrequency: 60, lastMaintenance: '2024-07-30',
                    nextMaintenance: '2024-08-30', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-07-30', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´æ»´å¤´ï¼Œæ£€æŸ¥ç®¡è·¯', technician: 'å­™å¸ˆå‚…' }
                    ]
                }
            ],
            4: [
                {
                    name: 'ç²¾å¯†åŠ çƒ­å™¨D1', icon: 'ğŸ”¥', status: 'è¿è¡Œä¸­', color: '#E74C3C',
                    runningHours: 450, usageFrequency: 75, lastMaintenance: '2024-07-25',
                    nextMaintenance: '2024-08-25', maintenanceStatus: 'æ­£å¸¸',
                    maintenanceRecords: [
                        { date: '2024-07-25', type: 'å®šæœŸä¿å…»', description: 'ç²¾å¯†æ ¡å‡†ï¼Œæ¸…æ´ä¼ æ„Ÿå™¨', technician: 'ä¸“ä¸šæŠ€å¸ˆ' }
                    ]
                },
                {
                    name: 'æ•°æ®é‡‡é›†å™¨D1', icon: 'ğŸ“Š', status: 'è¿è¡Œä¸­', color: '#BB8FCE',
                    runningHours: 2100, usageFrequency: 100, lastMaintenance: '2024-05-01',
                    nextMaintenance: '2024-08-01', maintenanceStatus: 'å·²è¿‡æœŸ',
                    maintenanceRecords: [
                        { date: '2024-05-01', type: 'å®šæœŸä¿å…»', description: 'æ ¡å‡†ä¼ æ„Ÿå™¨ï¼Œæ›´æ–°å›ºä»¶', technician: 'æŠ€æœ¯ä¸“å®¶' }
                    ]
                }
            ]
        };

        // ç”Ÿæˆè®¾å¤‡å¡ç‰‡
        function generateDeviceCards(greenhouseId = 1) {
            const devices = devicesByGreenhouse[greenhouseId] || devicesByGreenhouse[1];

            return devices.map(device => {
                const maintenanceColor = getMaintenanceStatusColor(device.maintenanceStatus);
                const maintenanceIcon = getMaintenanceStatusIcon(device.maintenanceStatus);

                return `
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; position: relative;" 
                     onmouseover="this.style.boxShadow='0 6px 20px rgba(0,0,0,0.15)'; this.style.transform='translateY(-2px)'" 
                     onmouseout="this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'"
                     onclick="showDeviceControlModal('${device.name}', '${device.icon}', '${device.status}', '${device.color}', ${JSON.stringify(device).replace(/"/g, '&quot;')})">
                    
                    <!-- ç»´æŠ¤çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                    <div style="position: absolute; top: 10px; right: 10px; background: ${maintenanceColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                        ${maintenanceIcon} ${device.maintenanceStatus}
                    </div>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 32px; margin-right: 15px;">${device.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 18px; font-weight: bold; color: #333;">${device.name}</div>
                            <div style="color: ${device.color}; font-size: 14px; font-weight: 600; margin-bottom: 5px;">${device.status}</div>
                            <div style="font-size: 12px; color: #666;">
                                è¿è¡Œæ—¶é—´: ${device.runningHours}h | ä½¿ç”¨ç‡: ${device.usageFrequency}%
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                ä¸‹æ¬¡ç»´æŠ¤: ${device.nextMaintenance}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button style="flex: 1; padding: 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="event.stopPropagation(); startDevice('${device.name}')">å¯åŠ¨</button>
                        <button style="flex: 1; padding: 8px; background: #E74C3C; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="event.stopPropagation(); stopDevice('${device.name}')">åœæ­¢</button>
                        <button style="flex: 1; padding: 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="event.stopPropagation(); showMaintenanceModal('${device.name}')">ç»´æŠ¤</button>
                    </div>
                </div>
            `;
            }).join('');
        }

        // æŠ¥è­¦æ•°æ®å­˜å‚¨ - æŒ‰æ¸©å®¤åˆ†ç»„
        const alertsData = {
            1: [
                { id: 1, type: 'ä¸¥é‡', message: 'æ¸©åº¦è¿‡é«˜ï¼šå½“å‰æ¸©åº¦35Â°Cï¼Œè¶…å‡ºå®‰å…¨èŒƒå›´ï¼Œå¯èƒ½å½±å“ä½œç‰©ç”Ÿé•¿', time: '2åˆ†é’Ÿå‰', color: '#E74C3C', status: 'æœªå¤„ç†', date: '2024-01-15', greenhouse: 1 },
                { id: 2, type: 'è­¦å‘Š', message: 'æ¹¿åº¦åä½ï¼šå½“å‰æ¹¿åº¦45%ï¼Œå»ºè®®å¯åŠ¨åŠ æ¹¿è®¾å¤‡', time: '5åˆ†é’Ÿå‰', color: '#F39C12', status: 'å¤„ç†ä¸­', date: '2024-01-15', greenhouse: 1 },
                { id: 3, type: 'ä¿¡æ¯', message: 'è®¾å¤‡ç»´æŠ¤æé†’ï¼šåŠ çƒ­å™¨å·²è¿è¡Œ720å°æ—¶ï¼Œå»ºè®®è¿›è¡Œå®šæœŸæ£€æŸ¥', time: '10åˆ†é’Ÿå‰', color: '#3498DB', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 1 },
                { id: 4, type: 'ä¸¥é‡', message: 'åœŸå£¤æ¹¿åº¦å¼‚å¸¸ï¼šä¼ æ„Ÿå™¨æ£€æµ‹åˆ°åœŸå£¤è¿‡äºå¹²ç‡¥ï¼Œéœ€è¦ç«‹å³çŒæº‰', time: '15åˆ†é’Ÿå‰', color: '#E74C3C', status: 'æœªå¤„ç†', date: '2024-01-15', greenhouse: 1 },
                { id: 5, type: 'è­¦å‘Š', message: 'å…‰ç…§å¼ºåº¦ä¸è¶³ï¼šå½“å‰å…‰ç…§15000luxï¼Œä½äºæœ€ä½³ç”Ÿé•¿éœ€æ±‚', time: '20åˆ†é’Ÿå‰', color: '#F39C12', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 1 }
            ],
            2: [
                { id: 6, type: 'ä¿¡æ¯', message: 'ç³»ç»Ÿæ›´æ–°é€šçŸ¥ï¼šæ–°ç‰ˆæœ¬å›ºä»¶å¯ç”¨ï¼Œå»ºè®®åœ¨ç»´æŠ¤çª—å£æœŸé—´æ›´æ–°', time: '25åˆ†é’Ÿå‰', color: '#3498DB', status: 'å·²å¿½ç•¥', date: '2024-01-15', greenhouse: 2 },
                { id: 7, type: 'ä¸¥é‡', message: 'è®¾å¤‡æ•…éšœï¼š2å·æ¸©åº¦ä¼ æ„Ÿå™¨è¿æ¥å¼‚å¸¸ï¼Œæ•°æ®é‡‡é›†ä¸­æ–­', time: '30åˆ†é’Ÿå‰', color: '#E74C3C', status: 'å¤„ç†ä¸­', date: '2024-01-15', greenhouse: 2 },
                { id: 8, type: 'è­¦å‘Š', message: 'CO2æµ“åº¦åé«˜ï¼šå½“å‰æµ“åº¦1200ppmï¼Œå»ºè®®å¢å¼ºé€šé£', time: '35åˆ†é’Ÿå‰', color: '#F39C12', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 2 },
                { id: 9, type: 'ä¿¡æ¯', message: 'å®šæ—¶ä»»åŠ¡å®Œæˆï¼šç¯å¢ƒæ•°æ®å¤‡ä»½å·²æˆåŠŸå®Œæˆ', time: '40åˆ†é’Ÿå‰', color: '#3498DB', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 2 }
            ],
            3: [
                { id: 10, type: 'è­¦å‘Š', message: 'ç”µæºç”µå‹æ³¢åŠ¨ï¼šæ£€æµ‹åˆ°ä¾›ç”µä¸ç¨³å®šï¼Œå¯èƒ½å½±å“è®¾å¤‡æ­£å¸¸è¿è¡Œ', time: '45åˆ†é’Ÿå‰', color: '#F39C12', status: 'æœªå¤„ç†', date: '2024-01-15', greenhouse: 3 },
                { id: 11, type: 'ä¸¥é‡', message: 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼šä¸ä¸­å¤®æœåŠ¡å™¨é€šä¿¡ä¸­æ–­ï¼Œæ•°æ®åŒæ­¥å¤±è´¥', time: '50åˆ†é’Ÿå‰', color: '#E74C3C', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 3 },
                { id: 12, type: 'ä¿¡æ¯', message: 'ç”¨æˆ·ç™»å½•é€šçŸ¥ï¼šç®¡ç†å‘˜ç‹å»ºå›½äº16:30ç™»å½•ç³»ç»Ÿ', time: '55åˆ†é’Ÿå‰', color: '#3498DB', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 3 }
            ],
            4: [
                { id: 13, type: 'è­¦å‘Š', message: 'å­˜å‚¨ç©ºé—´ä¸è¶³ï¼šç³»ç»Ÿå­˜å‚¨ä½¿ç”¨ç‡è¾¾åˆ°85%ï¼Œå»ºè®®æ¸…ç†å†å²æ•°æ®', time: '1å°æ—¶å‰', color: '#F39C12', status: 'æœªå¤„ç†', date: '2024-01-15', greenhouse: 4 },
                { id: 14, type: 'ä¸¥é‡', message: 'å®‰å…¨è­¦æŠ¥ï¼šæ£€æµ‹åˆ°å¼‚å¸¸è®¿é—®å°è¯•ï¼Œå·²è‡ªåŠ¨é”å®šç›¸å…³è´¦æˆ·', time: '1å°æ—¶5åˆ†é’Ÿå‰', color: '#E74C3C', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 4 },
                { id: 15, type: 'ä¿¡æ¯', message: 'ç³»ç»Ÿæ€§èƒ½æŠ¥å‘Šï¼šè¿‡å»24å°æ—¶ç³»ç»Ÿè¿è¡Œç¨³å®šï¼Œå¹³å‡å“åº”æ—¶é—´120ms', time: '1å°æ—¶10åˆ†é’Ÿå‰', color: '#3498DB', status: 'å·²å¤„ç†', date: '2024-01-15', greenhouse: 4 }
            ]
        };

        // å½“å‰ç­›é€‰æ¡ä»¶
        let currentAlertFilters = {
            type: '',
            status: '',
            date: '',
            keyword: ''
        };

        // ç”ŸæˆæŠ¥è­¦é¡¹ç›®
        function generateAlertItems(greenhouseId = 1) {
            let alerts = alertsData[greenhouseId] || [];

            // åº”ç”¨ç­›é€‰æ¡ä»¶
            alerts = applyFiltersToAlerts(alerts);

            // æ›´æ–°æŠ¥è­¦è®¡æ•°æ˜¾ç¤º
            updateAlertCountDisplay(alerts.length);

            if (alerts.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: #666; font-size: 16px;">æš‚æ— ç¬¦åˆæ¡ä»¶çš„æŠ¥è­¦ä¿¡æ¯</div>';
            }

            const statusColors = {
                'æœªå¤„ç†': '#E74C3C',
                'å¤„ç†ä¸­': '#F39C12',
                'å·²å¤„ç†': '#27AE60',
                'å·²å¿½ç•¥': '#95A5A6'
            };

            return alerts.map(alert => `
                <div style="border-left: 4px solid ${alert.color}; padding: 20px; margin-bottom: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 15px rgba(0,0,0,0.15)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="background: ${alert.color}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">${alert.type}</span>
                            <span style="background: ${statusColors[alert.status]}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">${alert.status}</span>
                        </div>
                        <span style="color: #666; font-size: 12px; font-weight: 500;">${alert.time}</span>
                    </div>
                    <div style="color: #333; font-size: 14px; line-height: 1.5; margin-bottom: 15px;">${alert.message}</div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button style="padding: 6px 16px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;" onclick="viewAlertDetails(${alert.id})">æŸ¥çœ‹è¯¦æƒ…</button>
                        ${alert.status !== 'å·²å¤„ç†' && alert.status !== 'å·²å¿½ç•¥' ?
                    `<button style="padding: 6px 16px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;" onclick="markAlertAsHandled(${alert.id})">æ ‡è®°å¤„ç†</button>` :
                    `<button style="padding: 6px 16px; background: #95A5A6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;" disabled>å·²å¤„ç†</button>`
                }
                    </div>
                </div>
            `).join('');
        }

        // åº”ç”¨ç­›é€‰æ¡ä»¶åˆ°æŠ¥è­¦æ•°æ®
        function applyFiltersToAlerts(alerts) {
            return alerts.filter(alert => {
                // ç±»å‹ç­›é€‰
                if (currentAlertFilters.type && alert.type !== currentAlertFilters.type) {
                    return false;
                }

                // çŠ¶æ€ç­›é€‰
                if (currentAlertFilters.status && alert.status !== currentAlertFilters.status) {
                    return false;
                }

                // æ—¥æœŸç­›é€‰
                if (currentAlertFilters.date && alert.date !== currentAlertFilters.date) {
                    return false;
                }

                // å…³é”®è¯ç­›é€‰
                if (currentAlertFilters.keyword) {
                    const keyword = currentAlertFilters.keyword.toLowerCase();
                    if (!alert.message.toLowerCase().includes(keyword)) {
                        return false;
                    }
                }

                return true;
            });
        }

        // æ›´æ–°æŠ¥è­¦è®¡æ•°æ˜¾ç¤º
        function updateAlertCountDisplay(count) {
            const countDisplay = document.getElementById('alertCountDisplay');
            if (countDisplay) {
                countDisplay.textContent = `å…± ${count} æ¡æŠ¥è­¦`;
            }
        }

        // åº”ç”¨æŠ¥è­¦ç­›é€‰
        function applyAlertFilters() {
            currentAlertFilters.type = document.getElementById('alertTypeFilter')?.value || '';
            currentAlertFilters.status = document.getElementById('alertStatusFilter')?.value || '';
            currentAlertFilters.date = document.getElementById('alertDateFilter')?.value || '';
            currentAlertFilters.keyword = document.getElementById('alertKeywordFilter')?.value || '';

            // é‡æ–°ç”ŸæˆæŠ¥è­¦åˆ—è¡¨
            const alertsList = document.getElementById('alertsList');
            if (alertsList) {
                alertsList.innerHTML = generateAlertItems(currentAlertGreenhouse);
            }

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateAlertStats(currentAlertGreenhouse);
        }

        // æ¸…é™¤æŠ¥è­¦ç­›é€‰
        function clearAlertFilters() {
            currentAlertFilters = {
                type: '',
                status: '',
                date: '',
                keyword: ''
            };

            // æ¸…ç©ºç­›é€‰è¡¨å•
            const typeFilter = document.getElementById('alertTypeFilter');
            const statusFilter = document.getElementById('alertStatusFilter');
            const dateFilter = document.getElementById('alertDateFilter');
            const keywordFilter = document.getElementById('alertKeywordFilter');

            if (typeFilter) typeFilter.value = '';
            if (statusFilter) statusFilter.value = '';
            if (dateFilter) dateFilter.value = '';
            if (keywordFilter) keywordFilter.value = '';

            // é‡æ–°ç”ŸæˆæŠ¥è­¦åˆ—è¡¨
            const alertsList = document.getElementById('alertsList');
            if (alertsList) {
                alertsList.innerHTML = generateAlertItems(currentAlertGreenhouse);
            }

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateAlertStats(currentAlertGreenhouse);
        }

        // æ ‡è®°æŠ¥è­¦ä¸ºå·²å¤„ç†ï¼ˆå¸¦ç¡®è®¤å¼¹çª—ï¼‰
        function markAlertAsHandled(alertId) {
            // æ‰¾åˆ°å¯¹åº”çš„æŠ¥è­¦
            let alert = null;
            let alertIndex = -1;
            let greenhouseAlerts = null;

            for (let greenhouse in alertsData) {
                const alerts = alertsData[greenhouse];
                const index = alerts.findIndex(a => a.id === alertId);
                if (index !== -1) {
                    alert = alerts[index];
                    alertIndex = index;
                    greenhouseAlerts = alerts;
                    break;
                }
            }

            if (!alert) {
                alert('æœªæ‰¾åˆ°å¯¹åº”çš„æŠ¥è­¦ä¿¡æ¯');
                return;
            }

            // æ˜¾ç¤ºç¡®è®¤å¼¹çª—
            showAlertHandleConfirmModal(alert, function () {
                // ç¡®è®¤å¤„ç†
                alert.status = 'å·²å¤„ç†';
                alert.handledTime = new Date().toLocaleString();
                alert.handledBy = 'å½“å‰ç”¨æˆ·'; // è¿™é‡Œå¯ä»¥æ›¿æ¢ä¸ºå®é™…çš„ç”¨æˆ·ä¿¡æ¯

                // åˆ·æ–°æŠ¥è­¦åˆ—è¡¨
                const alertsList = document.getElementById('alertsList');
                if (alertsList) {
                    alertsList.innerHTML = generateAlertItems(currentAlertGreenhouse);
                }

                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateAlertStats(currentAlertGreenhouse);

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                UserFriendlyAlert.showSuccess('æŠ¥è­¦å·²æ ‡è®°ä¸ºå·²å¤„ç†');
            });
        }

        // æ˜¾ç¤ºæŠ¥è­¦å¤„ç†ç¡®è®¤å¼¹çª—
        function showAlertHandleConfirmModal(alert, onConfirm) {
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

            // åˆ›å»ºå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 15px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: slideIn 0.3s ease;
            `;

            modal.innerHTML = `
                <div style="padding: 25px; border-bottom: 1px solid #eee;">
                    <h3 style="margin: 0; color: #333; font-size: 20px; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">âš ï¸</span>ç¡®è®¤å¤„ç†æŠ¥è­¦
                    </h3>
                </div>
                
                <div style="padding: 25px;">
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <span style="background: ${alert.color}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">${alert.type}</span>
                            <span style="color: #666; font-size: 12px;">${alert.time}</span>
                        </div>
                        <div style="color: #333; font-size: 14px; line-height: 1.5;">${alert.message}</div>
                    </div>
                    
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="color: #856404; font-size: 14px; font-weight: 600; margin-bottom: 5px;">âš ï¸ å¤„ç†ç¡®è®¤</div>
                        <div style="color: #856404; font-size: 13px;">ç¡®è®¤å°†æ­¤æŠ¥è­¦æ ‡è®°ä¸ºå·²å¤„ç†ï¼Ÿæ­¤æ“ä½œå°†æ›´æ–°æŠ¥è­¦çŠ¶æ€ï¼Œè¯·ç¡®ä¿é—®é¢˜å·²å¾—åˆ°å¦¥å–„è§£å†³ã€‚</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #555; font-weight: 600;">å¤„ç†å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="handleNotes" placeholder="è¯·è¾“å…¥å¤„ç†æƒ…å†µè¯´æ˜..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical;" rows="3"></textarea>
                    </div>
                </div>
                
                <div style="padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="closeAlertHandleModal()" style="padding: 10px 20px; background: #95A5A6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                    <button type="button" onclick="confirmAlertHandle()" style="padding: 10px 20px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ç¡®è®¤å¤„ç†</button>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    closeAlertHandleModal();
                }
            });

            // ä¿å­˜å¼¹çª—å¼•ç”¨å’Œå›è°ƒå‡½æ•°
            window.currentAlertHandleModal = overlay;
            window.currentAlertHandleCallback = onConfirm;
        }

        // å…³é—­æŠ¥è­¦å¤„ç†ç¡®è®¤å¼¹çª—
        function closeAlertHandleModal() {
            if (window.currentAlertHandleModal) {
                document.body.removeChild(window.currentAlertHandleModal);
                window.currentAlertHandleModal = null;
                window.currentAlertHandleCallback = null;
            }
        }

        // ç¡®è®¤å¤„ç†æŠ¥è­¦
        function confirmAlertHandle() {
            const notes = document.getElementById('handleNotes')?.value || '';

            // æ‰§è¡Œå›è°ƒå‡½æ•°
            if (window.currentAlertHandleCallback) {
                window.currentAlertHandleCallback(notes);
            }

            // å…³é—­å¼¹çª—
            closeAlertHandleModal();
        }

        // æŸ¥çœ‹æŠ¥è­¦è¯¦æƒ…
        function viewAlertDetails(alertId) {
            // æ‰¾åˆ°å¯¹åº”çš„æŠ¥è­¦
            let alert = null;

            for (let greenhouse in alertsData) {
                const alerts = alertsData[greenhouse];
                alert = alerts.find(a => a.id === alertId);
                if (alert) break;
            }

            if (!alert) {
                alert('æœªæ‰¾åˆ°å¯¹åº”çš„æŠ¥è­¦ä¿¡æ¯');
                return;
            }

            // æ˜¾ç¤ºè¯¦æƒ…å¼¹çª—
            showAlertDetailsModal(alert);
        }

        // æ˜¾ç¤ºæŠ¥è­¦è¯¦æƒ…å¼¹çª—
        function showAlertDetailsModal(alert) {
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

            // åˆ›å»ºå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 15px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: slideIn 0.3s ease;
            `;

            // è·å–æ¸©å®¤åç§°
            const greenhouseName = `${alert.greenhouse}å·æ¸©å®¤`;

            // è·å–çŠ¶æ€é¢œè‰²
            const statusColors = {
                'æœªå¤„ç†': '#E74C3C',
                'å¤„ç†ä¸­': '#F39C12',
                'å·²å¤„ç†': '#27AE60',
                'å·²å¿½ç•¥': '#95A5A6'
            };

            modal.innerHTML = `
                <div style="padding: 25px; border-bottom: 1px solid #eee;">
                    <h3 style="margin: 0; color: #333; font-size: 20px; display: flex; align-items: center; justify-content: space-between;">
                        <span style="display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸš¨</span>æŠ¥è­¦è¯¦æƒ…
                        </span>
                        <button onclick="closeAlertDetailsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">Ã—</button>
                    </h3>
                </div>
                
                <div style="padding: 25px;">
                    <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">åŸºæœ¬ä¿¡æ¯</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">æŠ¥è­¦ç±»å‹</label>
                                <div style="margin-top: 5px;">
                                    <span style="background: \${alert.color}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">\${alert.type}</span>
                                </div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">å¤„ç†çŠ¶æ€</label>
                                <div style="margin-top: 5px;">
                                    <span style="background: \${statusColors[alert.status]}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">\${alert.status}</span>
                                </div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">å‘ç”Ÿæ—¶é—´</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">\${alert.time}</div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">æ‰€å±æ¸©å®¤</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">\${greenhouseName}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æŠ¥è­¦å†…å®¹å¡ç‰‡ -->
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">æŠ¥è­¦å†…å®¹</h4>
                        <div style="font-size: 14px; color: #333; line-height: 1.6; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid \${alert.color};">
                            \${alert.message}
                        </div>
                    </div>
                    
                    <!-- å¤„ç†ä¿¡æ¯å¡ç‰‡ -->
                    ${alert.status === 'å·²å¤„ç†' && alert.handledTime ? `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">å¤„ç†ä¿¡æ¯</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">å¤„ç†æ—¶é—´</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">\${alert.handledTime}</div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">å¤„ç†äººå‘˜</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">\${alert.handledBy || 'ç³»ç»Ÿç”¨æˆ·'}</div>
                            </div>
                        </div>
                        ${alert.handleNotes ? `
                        <div style="margin-top: 15px;">
                            <label style="font-size: 12px; color: #666; font-weight: 600;">å¤„ç†å¤‡æ³¨</label>
                            <div style="font-size: 14px; color: #333; margin-top: 5px; padding: 10px; background: white; border-radius: 6px;">${alert.handleNotes}</div>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    <!-- å»ºè®®æ“ä½œå¡ç‰‡ -->
                    <div style="background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 10px; padding: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #1976d2;">ğŸ’¡ å»ºè®®æ“ä½œ</h4>
                        <div style="font-size: 14px; color: #1976d2; line-height: 1.6;">
                            \${getSuggestedActions(alert)}
                        </div>
                    </div>
                </div>
                
                <div style="padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px;">
                    ${alert.status !== 'å·²å¤„ç†' && alert.status !== 'å·²å¿½ç•¥' ?
                    `<button type="button" onclick="markAlertAsHandledFromDetails(${alert.id})" style="padding: 10px 20px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">æ ‡è®°å¤„ç†</button>` :
                    ''
                }
                    <button type="button" onclick="closeAlertDetailsModal()" style="padding: 10px 20px; background: #95A5A6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">å…³é—­</button>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    closeAlertDetailsModal();
                }
            });

            // ä¿å­˜å¼¹çª—å¼•ç”¨
            window.currentAlertDetailsModal = overlay;
        }

        // å…³é—­æŠ¥è­¦è¯¦æƒ…å¼¹çª—
        function closeAlertDetailsModal() {
            if (window.currentAlertDetailsModal) {
                document.body.removeChild(window.currentAlertDetailsModal);
                window.currentAlertDetailsModal = null;
            }
        }

        // ä»è¯¦æƒ…é¡µé¢æ ‡è®°å¤„ç†
        function markAlertAsHandledFromDetails(alertId) {
            closeAlertDetailsModal();
            markAlertAsHandled(alertId);
        }

        // è·å–å»ºè®®æ“ä½œ
        function getSuggestedActions(alert) {
            const suggestions = {
                'ä¸¥é‡': {
                    'æ¸©åº¦': 'ç«‹å³æ£€æŸ¥æ¸©æ§è®¾å¤‡ï¼Œè°ƒæ•´æ¸©åº¦è®¾ç½®ï¼Œç¡®ä¿é€šé£ç³»ç»Ÿæ­£å¸¸è¿è¡Œ',
                    'æ¹¿åº¦': 'æ£€æŸ¥åŠ æ¹¿/é™¤æ¹¿è®¾å¤‡ï¼Œè°ƒæ•´æ¹¿åº¦æ§åˆ¶å‚æ•°ï¼Œæ£€æŸ¥é€šé£æƒ…å†µ',
                    'è®¾å¤‡': 'ç«‹å³æ£€æŸ¥è®¾å¤‡è¿æ¥çŠ¶æ€ï¼Œé‡å¯è®¾å¤‡æˆ–è”ç³»æŠ€æœ¯äººå‘˜ç»´ä¿®',
                    'ç½‘ç»œ': 'æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œé‡å¯ç½‘ç»œè®¾å¤‡ï¼Œè”ç³»ç½‘ç»œç®¡ç†å‘˜',
                    'å®‰å…¨': 'ç«‹å³æ£€æŸ¥ç³»ç»Ÿå®‰å…¨çŠ¶æ€ï¼Œæ›´æ”¹å¯†ç ï¼Œæ£€æŸ¥è®¿é—®æ—¥å¿—'
                },
                'è­¦å‘Š': {
                    'æ¸©åº¦': 'ç›‘æ§æ¸©åº¦å˜åŒ–è¶‹åŠ¿ï¼Œé€‚å½“è°ƒæ•´æ¸©æ§è®¾å¤‡å‚æ•°',
                    'æ¹¿åº¦': 'å…³æ³¨æ¹¿åº¦å˜åŒ–ï¼Œå¿…è¦æ—¶å¯åŠ¨æ¹¿åº¦è°ƒèŠ‚è®¾å¤‡',
                    'å…‰ç…§': 'æ£€æŸ¥è¡¥å…‰è®¾å¤‡çŠ¶æ€ï¼Œè°ƒæ•´å…‰ç…§æ—¶é—´å’Œå¼ºåº¦',
                    'ç”µæº': 'æ£€æŸ¥ç”µæºä¾›åº”ç¨³å®šæ€§ï¼Œå‡†å¤‡å¤‡ç”¨ç”µæº',
                    'å­˜å‚¨': 'æ¸…ç†ä¸å¿…è¦çš„å†å²æ•°æ®ï¼Œæ‰©å±•å­˜å‚¨ç©ºé—´'
                },
                'ä¿¡æ¯': {
                    'ç»´æŠ¤': 'æŒ‰è®¡åˆ’è¿›è¡Œè®¾å¤‡ç»´æŠ¤ï¼Œè®°å½•ç»´æŠ¤æƒ…å†µ',
                    'æ›´æ–°': 'åœ¨åˆé€‚æ—¶é—´è¿›è¡Œç³»ç»Ÿæ›´æ–°ï¼Œå¤‡ä»½é‡è¦æ•°æ®',
                    'ç”¨æˆ·': 'è®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—ï¼Œå¿…è¦æ—¶è¿›è¡Œå®‰å…¨æ£€æŸ¥',
                    'æ€§èƒ½': 'æŒç»­ç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼Œä¼˜åŒ–ç³»ç»Ÿé…ç½®'
                }
            };

            const type = alert.type;
            const message = alert.message.toLowerCase();

            if (suggestions[type]) {
                for (let key in suggestions[type]) {
                    if (message.includes(key)) {
                        return suggestions[type][key];
                    }
                }
            }

            // é»˜è®¤å»ºè®®
            return 'è¯·æ ¹æ®æŠ¥è­¦å†…å®¹é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚å¦‚éœ€å¸®åŠ©ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚';
        }

        // ç”Ÿæˆå†å²è®°å½•é¡¹ç›®
        function generateHistoryItems(greenhouseId = 1) {
            const history = [
                { type: 'ç¯å¢ƒæ•°æ®', content: 'æ¸©åº¦: 24.5Â°C, æ¹¿åº¦: 68%, å…‰ç…§: 25000lux, åœŸå£¤æ¹¿åº¦: 58%', time: '2024-01-15 16:30:00' },
                { type: 'è®¾å¤‡æ“ä½œ', content: 'å¯åŠ¨åŠ çƒ­å™¨ - æ¸©åº¦è°ƒèŠ‚è‡³ç›®æ ‡å€¼', time: '2024-01-15 16:25:00' },
                { type: 'æŠ¥è­¦è®°å½•', content: 'æ¹¿åº¦è¿‡ä½æŠ¥è­¦å·²å¤„ç† - å¯åŠ¨åŠ æ¹¿å™¨', time: '2024-01-15 16:20:00' },
                { type: 'ç¯å¢ƒæ•°æ®', content: 'æ¸©åº¦: 23.8Â°C, æ¹¿åº¦: 65%, å…‰ç…§: 24500lux, åœŸå£¤æ¹¿åº¦: 60%', time: '2024-01-15 16:15:00' },
                { type: 'è®¾å¤‡æ“ä½œ', content: 'åœæ­¢é£æ‰‡ - æ¸©åº¦å·²è¾¾åˆ°é€‚å®œèŒƒå›´', time: '2024-01-15 16:10:00' },
                { type: 'ç”¨æˆ·æ“ä½œ', content: 'ç®¡ç†å‘˜é™ˆå¿—å¼ºç™»å½•ç³»ç»Ÿ', time: '2024-01-15 16:05:00' },
                { type: 'æŠ¥è­¦è®°å½•', content: 'æ¸©åº¦è¿‡é«˜æŠ¥è­¦ - è‡ªåŠ¨å¯åŠ¨å†·å´ç³»ç»Ÿ', time: '2024-01-15 16:00:00' },
                { type: 'ç¯å¢ƒæ•°æ®', content: 'æ¸©åº¦: 26.2Â°C, æ¹¿åº¦: 62%, å…‰ç…§: 24000lux, åœŸå£¤æ¹¿åº¦: 55%', time: '2024-01-15 15:55:00' },
                { type: 'è®¾å¤‡æ“ä½œ', content: 'å¯åŠ¨æ°´æ³µ - åœŸå£¤æ¹¿åº¦è¡¥å……', time: '2024-01-15 15:50:00' },
                { type: 'ç³»ç»Ÿäº‹ä»¶', content: 'å®šæ—¶ä»»åŠ¡æ‰§è¡Œ - ç¯å¢ƒæ•°æ®é‡‡é›†å®Œæˆ', time: '2024-01-15 15:45:00' },
                { type: 'è®¾å¤‡æ“ä½œ', content: 'å¼€å¯è¡¥å…‰ç¯ - å…‰ç…§å¼ºåº¦ä¸è¶³', time: '2024-01-15 15:40:00' },
                { type: 'ç¯å¢ƒæ•°æ®', content: 'æ¸©åº¦: 22.1Â°C, æ¹¿åº¦: 70%, å…‰ç…§: 18000lux, åœŸå£¤æ¹¿åº¦: 52%', time: '2024-01-15 15:35:00' },
                { type: 'æŠ¥è­¦è®°å½•', content: 'å…‰ç…§å¼ºåº¦ä¸è¶³æŠ¥è­¦ - å·²è‡ªåŠ¨è°ƒèŠ‚', time: '2024-01-15 15:30:00' },
                { type: 'ç”¨æˆ·æ“ä½œ', content: 'ç”¨æˆ·æç¾åå¯¼å‡ºç¯å¢ƒæ•°æ®æŠ¥è¡¨', time: '2024-01-15 15:25:00' },
                { type: 'ç³»ç»Ÿäº‹ä»¶', content: 'ç³»ç»Ÿè‡ªæ£€å®Œæˆ - æ‰€æœ‰è®¾å¤‡è¿è¡Œæ­£å¸¸', time: '2024-01-15 15:20:00' }
            ];

            const typeColors = {
                'ç¯å¢ƒæ•°æ®': '#2C3E50',
                'è®¾å¤‡æ“ä½œ': '#27AE60',
                'æŠ¥è­¦è®°å½•': '#E74C3C',
                'ç”¨æˆ·æ“ä½œ': '#3498DB',
                'ç³»ç»Ÿäº‹ä»¶': '#8E44AD'
            };

            return history.map(item => `
                <div style="border-bottom: 1px solid #eee; padding: 15px 0; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="background: ${typeColors[item.type] || '#4CAF50'}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">${item.type}</span>
                        <span style="color: #666; font-size: 12px; font-weight: 500;">${item.time}</span>
                    </div>
                    <div style="color: #333; font-size: 14px; line-height: 1.4;">${item.content}</div>
                </div>
            `).join('');
        }

        // æ¸©å®¤æ•°æ®é…ç½®
        const greenhouseData = {
            1: {
                name: '1å·æ¸©å®¤ (è”¬èœåŒº)',
                data: {
                    airTemp: '23.5Â°C',
                    airHumidity: '65.8%',
                    lightIntensity: '25000 lux',
                    soilMoisture: '58.2%',
                    co2Level: '420 ppm',
                    soilTemp: '21.8Â°C',
                    windSpeed: '0.8 m/s',
                    soilPH: '6.8',
                    soilEC: '1.2 mS/cm',
                    leafTemp: '22.3Â°C',
                    transpiration: '2.4 mm/h'
                }
            },
            2: {
                name: '2å·æ¸©å®¤ (èŠ±å‰åŒº)',
                data: {
                    airTemp: '25.2Â°C',
                    airHumidity: '72.3%',
                    lightIntensity: '28000 lux',
                    soilMoisture: '62.5%',
                    co2Level: '380 ppm',
                    soilTemp: '23.1Â°C',
                    windSpeed: '1.2 m/s',
                    soilPH: '6.5',
                    soilEC: '1.4 mS/cm',
                    leafTemp: '24.1Â°C',
                    transpiration: '3.1 mm/h'
                }
            },
            3: {
                name: '3å·æ¸©å®¤ (è‚²è‹—åŒº)',
                data: {
                    airTemp: '26.8Â°C',
                    airHumidity: '78.5%',
                    lightIntensity: '22000 lux',
                    soilMoisture: '68.9%',
                    co2Level: '450 ppm',
                    soilTemp: '25.3Â°C',
                    windSpeed: '0.5 m/s',
                    soilPH: '6.2',
                    soilEC: '0.9 mS/cm',
                    leafTemp: '25.6Â°C',
                    transpiration: '2.8 mm/h'
                }
            },
            4: {
                name: '4å·æ¸©å®¤ (å®éªŒåŒº)',
                data: {
                    airTemp: '22.1Â°C',
                    airHumidity: '60.4%',
                    lightIntensity: '30000 lux',
                    soilMoisture: '55.7%',
                    co2Level: '500 ppm',
                    soilTemp: '20.9Â°C',
                    windSpeed: '1.5 m/s',
                    soilPH: '7.1',
                    soilEC: '1.6 mS/cm',
                    leafTemp: '21.8Â°C',
                    transpiration: '2.1 mm/h'
                }
            }
        };

        // æ¸©å®¤é€‰æ‹©å‡½æ•°
        function selectGreenhouse(id) {
            currentGreenhouse = id;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.greenhouse-btn').forEach(btn => {
                btn.style.background = '#95A5A6';
            });
            event.target.style.background = '#2C3E50';

            // æ›´æ–°ç¯å¢ƒæ•°æ®æ˜¾ç¤º
            updateGreenhouseData(id);

            UserFriendlyAlert.showSuccess(`å·²åˆ‡æ¢åˆ°${greenhouseData[id].name}`);
        }

        // æ›´æ–°æ¸©å®¤æ•°æ®æ˜¾ç¤º
        function updateGreenhouseData(id) {
            const data = greenhouseData[id].data;

            // æ›´æ–°æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®
            Object.keys(data).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = data[key];
                }
            });
        }

        // ç¯å¢ƒæ•°æ®ç›¸å…³å‡½æ•°
        function refreshEnvironmentData() {
            updateGreenhouseData(currentGreenhouse);
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('environment_data_refresh'));
        }

        function exportEnvironmentData() {
            UserFriendlyAlert.showSuccess(`${greenhouseData[currentGreenhouse].name}ç¯å¢ƒæ•°æ®å¯¼å‡ºæˆåŠŸ`);
        }

        function setEnvironmentAlerts() {
            UserFriendlyAlert.showSuccess('ç¯å¢ƒæŠ¥è­¦é˜ˆå€¼è®¾ç½®å·²ä¿å­˜');
        }

        function viewEnvironmentTrends() {
            UserFriendlyAlert.showSuccess('æ­£åœ¨ç”Ÿæˆç¯å¢ƒè¶‹åŠ¿åˆ†æå›¾è¡¨');
        }

        function calibrateSensors() {
            UserFriendlyAlert.showSuccess(`${greenhouseData[currentGreenhouse].name}ä¼ æ„Ÿå™¨æ ¡å‡†å®Œæˆ`);
        }

        function generateEnvironmentReport() {
            UserFriendlyAlert.showSuccess(`${greenhouseData[currentGreenhouse].name}ç¯å¢ƒç›‘æµ‹æŠ¥å‘Šç”ŸæˆæˆåŠŸ`);
        }

        function updateEnvironmentData() {
            // æ¨¡æ‹Ÿæ•°æ®æ›´æ–°
            updateGreenhouseData(currentGreenhouse);
        }

        // è®¾å¤‡æ§åˆ¶é¡µé¢æ¸©å®¤é€‰æ‹©
        function selectDeviceGreenhouse(id) {
            currentDeviceGreenhouse = id;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.device-greenhouse-btn').forEach(btn => {
                btn.style.background = '#95A5A6';
            });
            event.target.style.background = '#2C3E50';

            // é‡æ–°ç”Ÿæˆè®¾å¤‡å¡ç‰‡
            const devicesGrid = document.getElementById('devicesGrid');
            if (devicesGrid) {
                devicesGrid.innerHTML = generateDeviceCards(id);
            }

            UserFriendlyAlert.showSuccess(`å·²åˆ‡æ¢åˆ°${greenhouseData[id].name}çš„è®¾å¤‡æ§åˆ¶`);
        }

        // æŠ¥è­¦ç®¡ç†é¡µé¢æ¸©å®¤é€‰æ‹©
        function selectAlertGreenhouse(id) {
            currentAlertGreenhouse = id;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.alert-greenhouse-btn').forEach(btn => {
                btn.style.background = '#95A5A6';
            });
            event.target.style.background = '#2C3E50';

            // æ›´æ–°æŠ¥è­¦ç»Ÿè®¡æ•°æ®
            updateAlertStats(id);

            // é‡æ–°ç”ŸæˆæŠ¥è­¦åˆ—è¡¨
            const alertsList = document.getElementById('alertsList');
            if (alertsList) {
                alertsList.innerHTML = generateAlertItems(id);
            }

            UserFriendlyAlert.showSuccess(`å·²åˆ‡æ¢åˆ°${greenhouseData[id].name}çš„æŠ¥è­¦ç®¡ç†`);
        }

        // å†å²è®°å½•é¡µé¢æ¸©å®¤é€‰æ‹©
        function selectHistoryGreenhouse(id) {
            currentHistoryGreenhouse = id;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.history-greenhouse-btn').forEach(btn => {
                btn.style.background = '#95A5A6';
            });
            event.target.style.background = '#2C3E50';

            // é‡æ–°ç”Ÿæˆå†å²è®°å½•
            const historyList = document.getElementById('historyList');
            if (historyList) {
                historyList.innerHTML = generateHistoryItems(id);
            }

            UserFriendlyAlert.showSuccess(`å·²åˆ‡æ¢åˆ°${greenhouseData[id].name}çš„å†å²è®°å½•`);
        }

        // æ›´æ–°æŠ¥è­¦ç»Ÿè®¡æ•°æ®
        function updateAlertStats(greenhouseId) {
            const alerts = alertsData[greenhouseId] || [];

            // åº”ç”¨å½“å‰ç­›é€‰æ¡ä»¶
            const filteredAlerts = applyFiltersToAlerts(alerts);

            // ç»Ÿè®¡å„ç±»å‹æŠ¥è­¦æ•°é‡
            const stats = {
                critical: filteredAlerts.filter(alert => alert.type === 'ä¸¥é‡').length,
                warning: filteredAlerts.filter(alert => alert.type === 'è­¦å‘Š').length,
                info: filteredAlerts.filter(alert => alert.type === 'ä¿¡æ¯').length,
                resolved: filteredAlerts.filter(alert => alert.status === 'å·²å¤„ç†').length
            };

            // æ›´æ–°æ˜¾ç¤º
            const criticalElement = document.getElementById('criticalAlerts');
            const warningElement = document.getElementById('warningAlerts');
            const infoElement = document.getElementById('infoAlerts');
            const resolvedElement = document.getElementById('resolvedAlerts');

            if (criticalElement) criticalElement.textContent = stats.critical;
            if (warningElement) warningElement.textContent = stats.warning;
            if (infoElement) infoElement.textContent = stats.info;
            if (resolvedElement) resolvedElement.textContent = stats.resolved;
        }

        // è®¾å¤‡æ§åˆ¶ç›¸å…³å‡½æ•°
        function startAllDevices() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_start_all'));
        }

        function stopAllDevices() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_stop_all'));
        }

        function refreshDevices() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_refresh'));
        }

        function startDevice(deviceName) {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_start_single', `${deviceName}å·²å¯åŠ¨`));
        }

        function stopDevice(deviceName) {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_stop_single', `${deviceName}å·²åœæ­¢`));
        }

        // æ˜¾ç¤ºè®¾å¤‡æ§åˆ¶å¼¹æ¡†
        function showDeviceControlModal(deviceName, deviceIcon, deviceStatus, deviceColor) {
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;

            // è·å–è®¾å¤‡ç±»å‹
            const deviceType = getDeviceType(deviceName);
            const deviceId = deviceName.replace(/\s+/g, '-').toLowerCase();

            // åˆ›å»ºå¼¹æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 0;
                max-width: 500px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                transform: scale(0.9);
                transition: transform 0.3s ease;
            `;

            modal.innerHTML = `
                <!-- å¼¹æ¡†å¤´éƒ¨ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 20px 20px 0 0; position: relative;">
                    <button onclick="closeDeviceModal()" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">Ã—</button>
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 48px; margin-right: 20px;">${deviceIcon}</div>
                        <div>
                            <h2 style="margin: 0; font-size: 24px; font-weight: 700;">${deviceName}</h2>
                            <div style="font-size: 16px; opacity: 0.9; margin-top: 5px;">è®¾å¤‡ç±»å‹ï¼š${deviceType}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="padding: 6px 12px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; font-weight: 600;">
                            çŠ¶æ€ï¼š<span style="color: ${deviceColor};">${deviceStatus}</span>
                        </span>
                        <span id="device-power-display" style="padding: 6px 12px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; font-weight: 600;">
                            åŠŸç‡ï¼š75%
                        </span>
                    </div>
                </div>

                <!-- å¼¹æ¡†å†…å®¹ -->
                <div style="padding: 30px;">
                    <!-- è®¾å¤‡ä¿¡æ¯ -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“‹</span>è®¾å¤‡ä¿¡æ¯
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px;">
                                <div><strong>è®¾å¤‡IDï¼š</strong>${deviceId}</div>
                                <div><strong>è®¾å¤‡ç±»å‹ï¼š</strong>${deviceType}</div>
                                <div><strong>å½“å‰çŠ¶æ€ï¼š</strong><span style="color: ${deviceColor}; font-weight: 600;">${deviceStatus}</span></div>
                                <div><strong>è¿è¡Œæ—¶é—´ï¼š</strong>2å°æ—¶35åˆ†é’Ÿ</div>
                                <div><strong>æœ€åç»´æŠ¤ï¼š</strong>2024-08-10</div>
                                <div><strong>ä¸‹æ¬¡ç»´æŠ¤ï¼š</strong>2024-09-10</div>
                            </div>
                        </div>
                    </div>

                    <!-- åŠŸç‡æ§åˆ¶ -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">âš¡</span>åŠŸç‡æ§åˆ¶
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">è®¾ç½®åŠŸç‡çº§åˆ«ï¼š</label>
                                <input type="range" id="power-slider" min="0" max="100" value="75" 
                                       style="width: 100%; height: 8px; border-radius: 5px; background: #ddd; outline: none; -webkit-appearance: none;"
                                       oninput="updatePowerDisplay(this.value)">
                                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-top: 5px;">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                            <div style="text-align: center; font-size: 18px; font-weight: 600; color: #333;">
                                å½“å‰åŠŸç‡ï¼š<span id="power-value">75</span>%
                            </div>
                        </div>
                    </div>

                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ›ï¸</span>è®¾å¤‡æ§åˆ¶
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                            <button onclick="controlDevice('${deviceName}', 'start')" style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#229954'" onmouseout="this.style.background='#27AE60'">
                                ğŸš€ å¯åŠ¨
                            </button>
                            <button onclick="controlDevice('${deviceName}', 'stop')" style="padding: 12px 20px; background: #E74C3C; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#C0392B'" onmouseout="this.style.background='#E74C3C'">
                                ğŸ›‘ åœæ­¢
                            </button>
                            <button onclick="controlDevice('${deviceName}', 'pause')" style="padding: 12px 20px; background: #F39C12; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#E67E22'" onmouseout="this.style.background='#F39C12'">
                                â¸ï¸ æš‚åœ
                            </button>
                            <button onclick="controlDevice('${deviceName}', 'reset')" style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#7D3C98'" onmouseout="this.style.background='#8E44AD'">
                                ğŸ”„ é‡ç½®
                            </button>
                        </div>
                    </div>

                    <!-- è¿è¡Œå‚æ•° -->
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“Š</span>è¿è¡Œå‚æ•°
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #3498DB;">2.3A</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">ç”µæµ</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #E74C3C;">220V</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">ç”µå‹</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #F39C12;">506W</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">åŠŸè€—</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #27AE60;">42Â°C</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">æ¸©åº¦</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                modal.style.transform = 'scale(1)';
            }, 10);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeDeviceModal();
                }
            });

            // ä¿å­˜å¼¹æ¡†å¼•ç”¨ä»¥ä¾¿å…³é—­
            window.currentDeviceModal = overlay;
        }

        // å…³é—­è®¾å¤‡æ§åˆ¶å¼¹æ¡†
        function closeDeviceModal() {
            if (window.currentDeviceModal) {
                const modal = window.currentDeviceModal.querySelector('div');
                modal.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    document.body.removeChild(window.currentDeviceModal);
                    window.currentDeviceModal = null;
                }, 300);
            }
        }

        // è·å–è®¾å¤‡ç±»å‹
        function getDeviceType(deviceName) {
            if (deviceName.includes('åŠ çƒ­å™¨')) return 'æ¸©åº¦æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('å†·å´å™¨')) return 'æ¸©åº¦æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('åŠ æ¹¿å™¨')) return 'æ¹¿åº¦æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('é£æ‰‡')) return 'é€šé£è®¾å¤‡';
            if (deviceName.includes('è¡¥å…‰ç¯') || deviceName.includes('è‚²è‹—ç¯')) return 'å…‰ç…§è®¾å¤‡';
            if (deviceName.includes('æ°´æ³µ')) return 'çŒæº‰è®¾å¤‡';
            if (deviceName.includes('é€šé£')) return 'é€šé£è®¾å¤‡';
            if (deviceName.includes('CO2')) return 'æ°”ä½“æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('å–·é›¾')) return 'æ¹¿åº¦æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('é®é˜³')) return 'å…‰ç…§æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('æ»´çŒ')) return 'çŒæº‰è®¾å¤‡';
            if (deviceName.includes('æ¸©æ§')) return 'æ¸©åº¦æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('æ•°æ®é‡‡é›†')) return 'ç›‘æµ‹è®¾å¤‡';
            if (deviceName.includes('ç¯å¢ƒæ§åˆ¶')) return 'ç»¼åˆæ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('pH')) return 'æ°´è´¨æ§åˆ¶è®¾å¤‡';
            if (deviceName.includes('è¥å…»æ¶²')) return 'è¥å…»ä¾›ç»™è®¾å¤‡';
            return 'æ™ºèƒ½è®¾å¤‡';
        }

        // æ›´æ–°åŠŸç‡æ˜¾ç¤º
        function updatePowerDisplay(value) {
            document.getElementById('power-value').textContent = value;
            document.getElementById('device-power-display').innerHTML = `åŠŸç‡ï¼š${value}%`;
        }

        // è®¾å¤‡æ§åˆ¶æ“ä½œ
        function controlDevice(deviceName, action) {
            const actionMap = {
                'start': 'å¯åŠ¨',
                'stop': 'åœæ­¢',
                'pause': 'æš‚åœ',
                'reset': 'é‡ç½®'
            };

            const actionText = actionMap[action] || action;
            const powerValue = document.getElementById('power-value').textContent;

            let message = `${deviceName} ${actionText}æˆåŠŸ`;
            if (action === 'start') {
                message += `ï¼ŒåŠŸç‡è®¾ç½®ä¸º ${powerValue}%`;
            }

            UserFriendlyAlert.showSuccess(message);

            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å®é™…çš„APIè°ƒç”¨
            // ä¾‹å¦‚ï¼šawait deviceControlAPI(deviceName, action, powerValue);
        }

        // è·å–ç»´æŠ¤çŠ¶æ€é¢œè‰²
        function getMaintenanceStatusColor(status) {
            const colorMap = {
                'æ­£å¸¸': '#27AE60',
                'å³å°†åˆ°æœŸ': '#F39C12',
                'éœ€è¦ç»´æŠ¤': '#E67E22',
                'å·²è¿‡æœŸ': '#E74C3C'
            };
            return colorMap[status] || '#95A5A6';
        }

        // è·å–ç»´æŠ¤çŠ¶æ€å›¾æ ‡
        function getMaintenanceStatusIcon(status) {
            const iconMap = {
                'æ­£å¸¸': 'âœ…',
                'å³å°†åˆ°æœŸ': 'âš ï¸',
                'éœ€è¦ç»´æŠ¤': 'ğŸ”§',
                'å·²è¿‡æœŸ': 'âŒ'
            };
            return iconMap[status] || 'ğŸ”§';
        }

        // æ˜¾ç¤ºç»´æŠ¤ç®¡ç†å¼¹æ¡†
        function showMaintenanceModal(deviceName) {
            // æŸ¥æ‰¾è®¾å¤‡æ•°æ®
            const allDevices = [];
            Object.values(devicesByGreenhouse).forEach(devices => {
                allDevices.push(...devices);
            });
            const device = allDevices.find(d => d.name === deviceName);

            if (!device) {
                UserFriendlyAlert.showError('è®¾å¤‡ä¿¡æ¯æœªæ‰¾åˆ°');
                return;
            }

            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;

            // åˆ›å»ºå¼¹æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 0;
                max-width: 700px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                transform: scale(0.9);
                transition: transform 0.3s ease;
            `;

            const maintenanceStatusColor = getMaintenanceStatusColor(device.maintenanceStatus);
            const maintenanceIcon = getMaintenanceStatusIcon(device.maintenanceStatus);

            modal.innerHTML = `
                <!-- å¼¹æ¡†å¤´éƒ¨ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 20px 20px 0 0; position: relative;">
                    <button onclick="closeMaintenanceModal()" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">Ã—</button>
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 48px; margin-right: 20px;">${device.icon}</div>
                        <div>
                            <h2 style="margin: 0; font-size: 24px; font-weight: 700;">${device.name} - ç»´æŠ¤ç®¡ç†</h2>
                            <div style="font-size: 16px; opacity: 0.9; margin-top: 5px;">è®¾å¤‡è¿è¡ŒçŠ¶æ€ï¼š${device.status}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="padding: 8px 16px; background: ${maintenanceStatusColor}; border-radius: 20px; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 5px;">
                            ${maintenanceIcon} ${device.maintenanceStatus}
                        </span>
                        <span style="padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; font-weight: 600;">
                            è¿è¡Œæ—¶é—´ï¼š${device.runningHours}å°æ—¶
                        </span>
                        <span style="padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; font-weight: 600;">
                            ä½¿ç”¨ç‡ï¼š${device.usageFrequency}%
                        </span>
                    </div>
                </div>

                <!-- å¼¹æ¡†å†…å®¹ -->
                <div style="padding: 30px;">
                    <!-- ç»´æŠ¤è®¡åˆ’ -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“…</span>ç»´æŠ¤è®¡åˆ’
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <div style="font-size: 14px; color: #666; margin-bottom: 5px;">ä¸Šæ¬¡ç»´æŠ¤æ—¶é—´</div>
                                    <div style="font-size: 16px; font-weight: 600; color: #333;">${device.lastMaintenance}</div>
                                </div>
                                <div>
                                    <div style="font-size: 14px; color: #666; margin-bottom: 5px;">ä¸‹æ¬¡ç»´æŠ¤æ—¶é—´</div>
                                    <div style="font-size: 16px; font-weight: 600; color: ${maintenanceStatusColor};">${device.nextMaintenance}</div>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 8px; padding: 15px; border-left: 4px solid ${maintenanceStatusColor};">
                                <div style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px;">ç»´æŠ¤æé†’</div>
                                <div style="font-size: 13px; color: #666; line-height: 1.5;">
                                    ${getMaintenanceReminder(device)}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤è®°å½• -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“‹</span>ç»´æŠ¤è®°å½•
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            ${generateMaintenanceRecords(device.maintenanceRecords)}
                        </div>
                    </div>

                    <!-- ç»´æŠ¤æ“ä½œ -->
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ”§</span>ç»´æŠ¤æ“ä½œ
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                            <button onclick="scheduleMaintenance('${device.name}')" style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#2980B9'" onmouseout="this.style.background='#3498DB'">
                                ğŸ“… å®‰æ’ç»´æŠ¤
                            </button>
                            <button onclick="completeMaintenance('${device.name}')" style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#229954'" onmouseout="this.style.background='#27AE60'">
                                âœ… å®Œæˆç»´æŠ¤
                            </button>
                            <button onclick="postponeMaintenance('${device.name}')" style="padding: 12px 20px; background: #F39C12; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#E67E22'" onmouseout="this.style.background='#F39C12'">
                                â° å»¶æœŸç»´æŠ¤
                            </button>
                            <button onclick="viewMaintenanceGuide('${device.name}')" style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#7D3C98'" onmouseout="this.style.background='#8E44AD'">
                                ğŸ“– ç»´æŠ¤æŒ‡å—
                            </button>
                        </div>
                    </div>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                modal.style.transform = 'scale(1)';
            }, 10);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeMaintenanceModal();
                }
            });

            // ä¿å­˜å¼¹æ¡†å¼•ç”¨ä»¥ä¾¿å…³é—­
            window.currentMaintenanceModal = overlay;
        }

        // å…³é—­ç»´æŠ¤ç®¡ç†å¼¹æ¡†
        function closeMaintenanceModal() {
            if (window.currentMaintenanceModal) {
                const modal = window.currentMaintenanceModal.querySelector('div');
                modal.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    document.body.removeChild(window.currentMaintenanceModal);
                    window.currentMaintenanceModal = null;
                }, 300);
            }
        }

        // è·å–ç»´æŠ¤æé†’ä¿¡æ¯
        function getMaintenanceReminder(device) {
            switch (device.maintenanceStatus) {
                case 'æ­£å¸¸':
                    return `è®¾å¤‡ç»´æŠ¤çŠ¶æ€è‰¯å¥½ï¼Œä¸‹æ¬¡ç»´æŠ¤æ—¶é—´ä¸º ${device.nextMaintenance}ã€‚å»ºè®®å®šæœŸæ£€æŸ¥è®¾å¤‡è¿è¡ŒçŠ¶æ€ã€‚`;
                case 'å³å°†åˆ°æœŸ':
                    return `è®¾å¤‡ç»´æŠ¤å³å°†åˆ°æœŸï¼Œè¯·åœ¨ ${device.nextMaintenance} å‰å®‰æ’ç»´æŠ¤å·¥ä½œï¼Œé¿å…å½±å“è®¾å¤‡æ­£å¸¸è¿è¡Œã€‚`;
                case 'éœ€è¦ç»´æŠ¤':
                    return `è®¾å¤‡éœ€è¦è¿›è¡Œç»´æŠ¤ï¼Œå»ºè®®å°½å¿«å®‰æ’ä¸“ä¸šæŠ€æœ¯äººå‘˜è¿›è¡Œæ£€æŸ¥å’Œä¿å…»ï¼Œç¡®ä¿è®¾å¤‡ç¨³å®šè¿è¡Œã€‚`;
                case 'å·²è¿‡æœŸ':
                    return `è®¾å¤‡ç»´æŠ¤å·²è¿‡æœŸï¼è¯·ç«‹å³å®‰æ’ç»´æŠ¤å·¥ä½œï¼Œé•¿æœŸæœªç»´æŠ¤å¯èƒ½å¯¼è‡´è®¾å¤‡æ•…éšœæˆ–æ€§èƒ½ä¸‹é™ã€‚`;
                default:
                    return 'è¯·å®šæœŸç»´æŠ¤è®¾å¤‡ä»¥ç¡®ä¿æ­£å¸¸è¿è¡Œã€‚';
            }
        }

        // ç”Ÿæˆç»´æŠ¤è®°å½•HTML
        function generateMaintenanceRecords(records) {
            if (!records || records.length === 0) {
                return '<div style="text-align: center; color: #666; padding: 20px;">æš‚æ— ç»´æŠ¤è®°å½•</div>';
            }

            return records.map(record => `
                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 4px solid #3498DB;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-size: 14px; font-weight: 600; color: #333;">${record.type}</div>
                        <div style="font-size: 12px; color: #666;">${record.date}</div>
                    </div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px; line-height: 1.4;">${record.description}</div>
                    <div style="font-size: 12px; color: #3498DB;">ç»´æŠ¤äººå‘˜ï¼š${record.technician}</div>
                </div>
            `).join('');
        }

        // ç»´æŠ¤æ“ä½œå‡½æ•°
        function scheduleMaintenance(deviceName) {
            UserFriendlyAlert.showSuccess(`å·²ä¸º ${deviceName} å®‰æ’ç»´æŠ¤è®¡åˆ’`);
            closeMaintenanceModal();
        }

        function completeMaintenance(deviceName) {
            UserFriendlyAlert.showSuccess(`${deviceName} ç»´æŠ¤å·²å®Œæˆï¼Œç»´æŠ¤è®°å½•å·²æ›´æ–°`);
            closeMaintenanceModal();
        }

        function postponeMaintenance(deviceName) {
            UserFriendlyAlert.showWarning(`${deviceName} ç»´æŠ¤å·²å»¶æœŸï¼Œè¯·å°½å¿«å®‰æ’ç»´æŠ¤å·¥ä½œ`);
            closeMaintenanceModal();
        }

        function viewMaintenanceGuide(deviceName) {
            UserFriendlyAlert.showInfo(`æ­£åœ¨æ‰“å¼€ ${deviceName} çš„ç»´æŠ¤æŒ‡å—...`);
        }

        // ç»´æŠ¤ç®¡ç†æ¦‚è§ˆåŠŸèƒ½
        function showMaintenanceSchedule() {
            UserFriendlyAlert.showInfo('æ­£åœ¨æ‰“å¼€ç»´æŠ¤è®¡åˆ’ç®¡ç†ç•Œé¢...');
        }

        function exportMaintenanceReport() {
            UserFriendlyAlert.showSuccess('ç»´æŠ¤æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ');
        }

        function showMaintenanceGuides() {
            UserFriendlyAlert.showInfo('æ­£åœ¨æ‰“å¼€è®¾å¤‡ç»´æŠ¤æŒ‡å—åº“...');
        }

        function scheduleMaintenanceReminder() {
            UserFriendlyAlert.showSuccess('ç»´æŠ¤æé†’å·²è®¾ç½®ï¼Œç³»ç»Ÿå°†åœ¨ç»´æŠ¤åˆ°æœŸå‰é€šçŸ¥æ‚¨');
        }

        // ç”Ÿæˆç»´æŠ¤è®¡åˆ’åˆ—è¡¨
        function generateMaintenanceScheduleList() {
            const schedules = [
                { deviceName: 'è¡¥å…‰ç¯A1', deviceIcon: 'ğŸ’¡', scheduledDate: '2024-08-10', priority: 'é«˜', status: 'å·²è¿‡æœŸ', description: 'æ¸…æ´ç¯å…·ï¼Œæ£€æŸ¥LEDæ¨¡å—' },
                { deviceName: 'æ•°æ®é‡‡é›†å™¨D1', deviceIcon: 'ğŸ“Š', scheduledDate: '2024-08-01', priority: 'é«˜', status: 'å·²è¿‡æœŸ', description: 'æ ¡å‡†ä¼ æ„Ÿå™¨ï¼Œæ›´æ–°å›ºä»¶' },
                { deviceName: 'é£æ‰‡A1', deviceIcon: 'ğŸŒªï¸', scheduledDate: '2024-08-14', priority: 'ä¸­', status: 'å³å°†åˆ°æœŸ', description: 'æ¸…æ´å¶ç‰‡ï¼Œæ¶¦æ»‘è½´æ‰¿' },
                { deviceName: 'é€šé£ç³»ç»ŸA1', deviceIcon: 'ğŸŒ¬ï¸', scheduledDate: '2024-08-16', priority: 'ä¸­', status: 'å³å°†åˆ°æœŸ', description: 'æ¸…æ´é€šé£ç®¡é“ï¼Œæ£€æŸ¥é£é—¨' },
                { deviceName: 'é£æ‰‡B1', deviceIcon: 'ğŸŒªï¸', scheduledDate: '2024-08-18', priority: 'ä¸­', status: 'è®¡åˆ’ä¸­', description: 'æ¸…æ´å¶ç‰‡ï¼Œæ¶¦æ»‘è½´æ‰¿' },
                { deviceName: 'åŠ çƒ­å™¨A1', deviceIcon: 'ğŸ”¥', scheduledDate: '2024-08-15', priority: 'é«˜', status: 'éœ€è¦ç»´æŠ¤', description: 'æ¸…æ´åŠ çƒ­å…ƒä»¶ï¼Œæ£€æŸ¥ç”µè·¯è¿æ¥' },
                { deviceName: 'å†·å´å™¨A1', deviceIcon: 'â„ï¸', scheduledDate: '2024-09-01', priority: 'ä½', status: 'è®¡åˆ’ä¸­', description: 'æ¸…æ´å†·å‡å™¨ï¼Œæ£€æŸ¥åˆ¶å†·å‰‚' },
                { deviceName: 'æ°´æ³µA1', deviceIcon: 'ğŸš°', scheduledDate: '2024-08-25', priority: 'ä¸­', status: 'è®¡åˆ’ä¸­', description: 'æ£€æŸ¥æ°´æ³µå¯†å°ï¼Œæ¸…æ´è¿‡æ»¤å™¨' }
            ];

            return schedules.map(schedule => {
                const priorityColor = schedule.priority === 'é«˜' ? '#E74C3C' : schedule.priority === 'ä¸­' ? '#F39C12' : '#27AE60';
                const statusColor = getMaintenanceStatusColor(schedule.status);

                return `
                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 4px solid ${priorityColor}; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                    <div style="display: flex; align-items: center; flex: 1;">
                        <div style="font-size: 24px; margin-right: 15px;">${schedule.deviceIcon}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 4px;">${schedule.deviceName}</div>
                            <div style="font-size: 13px; color: #666; margin-bottom: 4px;">${schedule.description}</div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="font-size: 12px; color: #666;">è®¡åˆ’æ—¶é—´ï¼š${schedule.scheduledDate}</span>
                                <span style="padding: 2px 8px; background: ${priorityColor}; color: white; border-radius: 10px; font-size: 10px; font-weight: 600;">${schedule.priority}ä¼˜å…ˆçº§</span>
                                <span style="padding: 2px 8px; background: ${statusColor}; color: white; border-radius: 10px; font-size: 10px; font-weight: 600;">${schedule.status}</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button style="padding: 6px 12px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;" onclick="completePlannedMaintenance('${schedule.deviceName}')">å®Œæˆ</button>
                        <button style="padding: 6px 12px; background: #F39C12; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;" onclick="postponePlannedMaintenance('${schedule.deviceName}')">å»¶æœŸ</button>
                        <button style="padding: 6px 12px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;" onclick="editMaintenancePlan('${schedule.deviceName}')">ç¼–è¾‘</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        // ç”Ÿæˆç»´æŠ¤è®°å½•åˆ—è¡¨
        function generateMaintenanceRecordsList() {
            const records = [
                { deviceName: 'åŠ çƒ­å™¨A1', deviceIcon: 'ğŸ”¥', date: '2024-07-15', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´åŠ çƒ­å…ƒä»¶ï¼Œæ£€æŸ¥ç”µè·¯è¿æ¥', technician: 'å¼ å¸ˆå‚…', result: 'æ­£å¸¸', nextDate: '2024-08-15' },
                { deviceName: 'æ°´æ³µA1', deviceIcon: 'ğŸš°', date: '2024-07-25', type: 'å®šæœŸä¿å…»', description: 'æ£€æŸ¥æ°´æ³µå¯†å°ï¼Œæ¸…æ´è¿‡æ»¤å™¨', technician: 'å­™å¸ˆå‚…', result: 'æ­£å¸¸', nextDate: '2024-08-25' },
                { deviceName: 'CO2å‘ç”Ÿå™¨A1', deviceIcon: 'ğŸ’¨', date: '2024-08-05', type: 'å®šæœŸä¿å…»', description: 'æ£€æŸ¥CO2æµ“åº¦ä¼ æ„Ÿå™¨ï¼Œæ¸…æ´å‘ç”Ÿå™¨', technician: 'å‘¨å¸ˆå‚…', result: 'æ­£å¸¸', nextDate: '2024-09-05' },
                { deviceName: 'å†·å´å™¨A1', deviceIcon: 'â„ï¸', date: '2024-08-01', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´å†·å‡å™¨ï¼Œæ£€æŸ¥åˆ¶å†·å‰‚', technician: 'ç‹å¸ˆå‚…', result: 'æ­£å¸¸', nextDate: '2024-09-01' },
                { deviceName: 'åŠ æ¹¿å™¨A1', deviceIcon: 'ğŸ’¨', date: '2024-07-20', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´æ°´ç®±ï¼Œæ›´æ¢æ»¤èŠ¯', technician: 'é™ˆå¸ˆå‚…', result: 'æ­£å¸¸', nextDate: '2024-08-20' },
                { deviceName: 'é£æ‰‡A1', deviceIcon: 'ğŸŒªï¸', date: '2024-06-30', type: 'æ•…éšœç»´ä¿®', description: 'æ›´æ¢ç”µæœºè½´æ‰¿ï¼Œæ¸…æ´å¶ç‰‡', technician: 'åˆ˜å¸ˆå‚…', result: 'å·²ä¿®å¤', nextDate: '2024-08-14' },
                { deviceName: 'é€šé£ç³»ç»ŸA1', deviceIcon: 'ğŸŒ¬ï¸', date: '2024-07-05', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´é€šé£ç®¡é“ï¼Œæ£€æŸ¥é£é—¨', technician: 'é©¬å¸ˆå‚…', result: 'æ­£å¸¸', nextDate: '2024-08-16' },
                { deviceName: 'è¡¥å…‰ç¯A1', deviceIcon: 'ğŸ’¡', date: '2024-05-10', type: 'å®šæœŸä¿å…»', description: 'æ¸…æ´ç¯å…·ï¼Œæ£€æŸ¥LEDæ¨¡å—', technician: 'èµµå¸ˆå‚…', result: 'éœ€è¦æ›´æ¢', nextDate: '2024-08-10' }
            ];

            return records.map(record => {
                const typeColor = record.type === 'æ•…éšœç»´ä¿®' ? '#E74C3C' : '#3498DB';
                const resultColor = record.result === 'æ­£å¸¸' ? '#27AE60' : record.result === 'å·²ä¿®å¤' ? '#3498DB' : '#F39C12';

                return `
                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 4px solid ${typeColor}; transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center;">
                            <div style="font-size: 20px; margin-right: 12px;">${record.deviceIcon}</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; color: #333;">${record.deviceName}</div>
                                <div style="font-size: 12px; color: #666;">${record.date} | ç»´æŠ¤äººå‘˜ï¼š${record.technician}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span style="padding: 4px 10px; background: ${typeColor}; color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">${record.type}</span>
                            <span style="padding: 4px 10px; background: ${resultColor}; color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">${record.result}</span>
                        </div>
                    </div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px; line-height: 1.4;">${record.description}</div>
                    <div style="font-size: 12px; color: #3498DB;">ä¸‹æ¬¡ç»´æŠ¤æ—¶é—´ï¼š${record.nextDate}</div>
                </div>
                `;
            }).join('');
        }

        // ç»´æŠ¤ç®¡ç†åŠŸèƒ½å‡½æ•°
        function showMaintenanceScheduleList() {
            const scheduleSection = document.getElementById('maintenanceScheduleSection');
            const recordsSection = document.getElementById('maintenanceRecordsSection');

            scheduleSection.style.display = 'block';
            recordsSection.style.display = 'none';

            UserFriendlyAlert.showInfo('æ­£åœ¨æ˜¾ç¤ºç»´æŠ¤è®¡åˆ’åˆ—è¡¨');
        }

        function showMaintenanceRecordsList() {
            const scheduleSection = document.getElementById('maintenanceScheduleSection');
            const recordsSection = document.getElementById('maintenanceRecordsSection');

            scheduleSection.style.display = 'none';
            recordsSection.style.display = 'block';

            UserFriendlyAlert.showInfo('æ­£åœ¨æ˜¾ç¤ºç»´æŠ¤è®°å½•åˆ—è¡¨');
        }



        function completePlannedMaintenance(deviceName) {
            UserFriendlyAlert.showSuccess(`${deviceName} çš„ç»´æŠ¤è®¡åˆ’å·²å®Œæˆï¼Œç»´æŠ¤è®°å½•å·²æ›´æ–°`);
            refreshMaintenanceData();
        }

        function postponePlannedMaintenance(deviceName) {
            UserFriendlyAlert.showWarning(`${deviceName} çš„ç»´æŠ¤è®¡åˆ’å·²å»¶æœŸï¼Œè¯·å°½å¿«å®‰æ’ç»´æŠ¤å·¥ä½œ`);
            refreshMaintenanceData();
        }

        function editMaintenancePlan(deviceName) {
            UserFriendlyAlert.showInfo(`æ­£åœ¨ç¼–è¾‘ ${deviceName} çš„ç»´æŠ¤è®¡åˆ’...`);
        }

        function refreshMaintenanceData() {
            // åˆ·æ–°ç»´æŠ¤è®¡åˆ’å’Œè®°å½•åˆ—è¡¨
            const scheduleList = document.getElementById('maintenanceScheduleList');
            const recordsList = document.getElementById('maintenanceRecordsList');

            if (scheduleList) {
                scheduleList.innerHTML = generateMaintenanceScheduleList();
            }
            if (recordsList) {
                recordsList.innerHTML = generateMaintenanceRecordsList();
            }
        }

        // æ›´æ–°è®¾å¤‡æ§åˆ¶å¼¹æ¡†ä»¥åŒ…å«ç»´æŠ¤ä¿¡æ¯
        function showDeviceControlModal(deviceName, deviceIcon, deviceStatus, deviceColor, deviceData) {
            let device;
            try {
                device = deviceData ? JSON.parse(deviceData.replace(/&quot;/g, '"')) : null;
            } catch (e) {
                // å¦‚æœè§£æå¤±è´¥ï¼ŒæŸ¥æ‰¾è®¾å¤‡æ•°æ®
                const allDevices = [];
                Object.values(devicesByGreenhouse).forEach(devices => {
                    allDevices.push(...devices);
                });
                device = allDevices.find(d => d.name === deviceName);
            }

            if (!device) {
                // åˆ›å»ºåŸºæœ¬è®¾å¤‡å¯¹è±¡
                device = {
                    name: deviceName,
                    icon: deviceIcon,
                    status: deviceStatus,
                    color: deviceColor,
                    runningHours: 0,
                    usageFrequency: 0,
                    lastMaintenance: 'æœªçŸ¥',
                    nextMaintenance: 'æœªè®¾ç½®',
                    maintenanceStatus: 'æœªçŸ¥'
                };
            }

            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;

            // è·å–è®¾å¤‡ç±»å‹
            const deviceType = getDeviceType(deviceName);
            const deviceId = deviceName.replace(/\s+/g, '-').toLowerCase();
            const maintenanceStatusColor = getMaintenanceStatusColor(device.maintenanceStatus);

            // åˆ›å»ºå¼¹æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 0;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                transform: scale(0.9);
                transition: transform 0.3s ease;
            `;

            modal.innerHTML = `
                <!-- å¼¹æ¡†å¤´éƒ¨ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 20px 20px 0 0; position: relative;">
                    <button onclick="closeDeviceModal()" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">Ã—</button>
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 48px; margin-right: 20px;">${device.icon}</div>
                        <div>
                            <h2 style="margin: 0; font-size: 24px; font-weight: 700;">${device.name}</h2>
                            <div style="font-size: 16px; opacity: 0.9; margin-top: 5px;">è®¾å¤‡ç±»å‹ï¼š${deviceType}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <span style="padding: 6px 12px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; font-weight: 600;">
                            çŠ¶æ€ï¼š<span style="color: ${device.color};">${device.status}</span>
                        </span>
                        <span id="device-power-display" style="padding: 6px 12px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; font-weight: 600;">
                            åŠŸç‡ï¼š75%
                        </span>
                        <span style="padding: 6px 12px; background: ${maintenanceStatusColor}; border-radius: 20px; font-size: 14px; font-weight: 600;">
                            ç»´æŠ¤ï¼š${device.maintenanceStatus}
                        </span>
                    </div>
                </div>

                <!-- å¼¹æ¡†å†…å®¹ -->
                <div style="padding: 30px;">
                    <!-- è®¾å¤‡ä¿¡æ¯ -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“‹</span>è®¾å¤‡ä¿¡æ¯
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px;">
                                <div><strong>è®¾å¤‡IDï¼š</strong>${deviceId}</div>
                                <div><strong>è®¾å¤‡ç±»å‹ï¼š</strong>${deviceType}</div>
                                <div><strong>å½“å‰çŠ¶æ€ï¼š</strong><span style="color: ${device.color}; font-weight: 600;">${device.status}</span></div>
                                <div><strong>è¿è¡Œæ—¶é—´ï¼š</strong>${device.runningHours}å°æ—¶</div>
                                <div><strong>ä½¿ç”¨é¢‘ç‡ï¼š</strong>${device.usageFrequency}%</div>
                                <div><strong>ç»´æŠ¤çŠ¶æ€ï¼š</strong><span style="color: ${maintenanceStatusColor}; font-weight: 600;">${device.maintenanceStatus}</span></div>
                                <div><strong>ä¸Šæ¬¡ç»´æŠ¤ï¼š</strong>${device.lastMaintenance}</div>
                                <div><strong>ä¸‹æ¬¡ç»´æŠ¤ï¼š</strong>${device.nextMaintenance}</div>
                            </div>
                        </div>
                    </div>

                    <!-- åŠŸç‡æ§åˆ¶ -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">âš¡</span>åŠŸç‡æ§åˆ¶
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">è®¾ç½®åŠŸç‡çº§åˆ«ï¼š</label>
                                <input type="range" id="power-slider" min="0" max="100" value="75" 
                                       style="width: 100%; height: 8px; border-radius: 5px; background: #ddd; outline: none; -webkit-appearance: none;"
                                       oninput="updatePowerDisplay(this.value)">
                                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-top: 5px;">
                                    <span>0%</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                            <div style="text-align: center; font-size: 18px; font-weight: 600; color: #333;">
                                å½“å‰åŠŸç‡ï¼š<span id="power-value">75</span>%
                            </div>
                        </div>
                    </div>

                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ›ï¸</span>è®¾å¤‡æ§åˆ¶
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                            <button onclick="controlDevice('${device.name}', 'start')" style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#229954'" onmouseout="this.style.background='#27AE60'">
                                ğŸš€ å¯åŠ¨
                            </button>
                            <button onclick="controlDevice('${device.name}', 'stop')" style="padding: 12px 20px; background: #E74C3C; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#C0392B'" onmouseout="this.style.background='#E74C3C'">
                                ğŸ›‘ åœæ­¢
                            </button>
                            <button onclick="controlDevice('${device.name}', 'pause')" style="padding: 12px 20px; background: #F39C12; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#E67E22'" onmouseout="this.style.background='#F39C12'">
                                â¸ï¸ æš‚åœ
                            </button>
                            <button onclick="controlDevice('${device.name}', 'reset')" style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#7D3C98'" onmouseout="this.style.background='#8E44AD'">
                                ğŸ”„ é‡ç½®
                            </button>
                            <button onclick="closeDeviceModal(); showMaintenanceModal('${device.name}')" style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#2980B9'" onmouseout="this.style.background='#3498DB'">
                                ğŸ”§ ç»´æŠ¤
                            </button>
                        </div>
                    </div>

                    <!-- è¿è¡Œå‚æ•° -->
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“Š</span>è¿è¡Œå‚æ•°
                        </h3>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #3498DB;">2.3A</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">ç”µæµ</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #E74C3C;">220V</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">ç”µå‹</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #F39C12;">506W</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">åŠŸè€—</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 20px; font-weight: bold; color: #27AE60;">42Â°C</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">æ¸©åº¦</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                modal.style.transform = 'scale(1)';
            }, 10);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeDeviceModal();
                }
            });

            // ä¿å­˜å¼¹æ¡†å¼•ç”¨ä»¥ä¾¿å…³é—­
            window.currentDeviceModal = overlay;
        }

        // ç”Ÿæˆä»»åŠ¡åˆ—è¡¨HTML
        function generateTaskListHTML() {
            const tasks = [
                {
                    id: 'env-data-generation',
                    name: 'ç¯å¢ƒæ•°æ®ç”Ÿæˆ',
                    icon: 'ğŸŒ¡ï¸',
                    status: 'running',
                    frequency: 'æ¯30ç§’',
                    lastExecution: '25ç§’å‰',
                    nextExecution: '2024-01-08 13:20:15',
                    executionCount: 156,
                    description: 'è‡ªåŠ¨é‡‡é›†æ¸©å®¤ç¯å¢ƒæ•°æ®'
                },
                {
                    id: 'device-status-update',
                    name: 'è®¾å¤‡çŠ¶æ€æ›´æ–°',
                    icon: 'âš™ï¸',
                    status: 'running',
                    frequency: 'æ¯1åˆ†é’Ÿ',
                    lastExecution: '45ç§’å‰',
                    nextExecution: '2024-01-08 13:21:30',
                    executionCount: 89,
                    description: 'æ›´æ–°æ‰€æœ‰è®¾å¤‡è¿è¡ŒçŠ¶æ€'
                },
                {
                    id: 'alert-detection',
                    name: 'æŠ¥è­¦æ£€æµ‹',
                    icon: 'ğŸš¨',
                    status: 'running',
                    frequency: 'æ¯1åˆ†é’Ÿ',
                    lastExecution: '30ç§’å‰',
                    nextExecution: '2024-01-08 13:21:45',
                    executionCount: 234,
                    description: 'æ£€æµ‹ç¯å¢ƒå¼‚å¸¸å¹¶ç”ŸæˆæŠ¥è­¦'
                },
                {
                    id: 'automatic-control',
                    name: 'è‡ªåŠ¨åŒ–æ§åˆ¶',
                    icon: 'ğŸ¤–',
                    status: 'running',
                    frequency: 'æ¯2åˆ†é’Ÿ',
                    lastExecution: '1åˆ†é’Ÿå‰',
                    nextExecution: '2024-01-08 13:22:10',
                    executionCount: 67,
                    description: 'æ ¹æ®ç¯å¢ƒæ•°æ®è‡ªåŠ¨æ§åˆ¶è®¾å¤‡'
                },
                {
                    id: 'device-fault-detection',
                    name: 'è®¾å¤‡æ•…éšœæ£€æµ‹',
                    icon: 'ğŸ”§',
                    status: 'running',
                    frequency: 'æ¯5åˆ†é’Ÿ',
                    lastExecution: '3åˆ†é’Ÿå‰',
                    nextExecution: '2024-01-08 13:25:00',
                    executionCount: 23,
                    description: 'æ£€æµ‹è®¾å¤‡æ•…éšœå’Œå¼‚å¸¸çŠ¶æ€'
                },
                {
                    id: 'data-backup',
                    name: 'æ•°æ®å¤‡ä»½',
                    icon: 'ğŸ’¾',
                    status: 'paused',
                    frequency: 'æ¯å°æ—¶',
                    lastExecution: '1å°æ—¶å‰',
                    nextExecution: '2024-01-08 14:20:00',
                    executionCount: 12,
                    description: 'å®šæœŸå¤‡ä»½ç³»ç»Ÿé‡è¦æ•°æ®'
                }
            ];

            return tasks.map(task => {
                const statusClass = task.status === 'running' ? 'status-running' :
                    task.status === 'paused' ? 'status-paused' : 'status-stopped';
                const statusText = task.status === 'running' ? 'è¿è¡Œä¸­' :
                    task.status === 'paused' ? 'å·²æš‚åœ' : 'å·²åœæ­¢';

                const actions = task.status === 'running' ?
                    `<button style="padding: 4px 8px; background: #F39C12; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="pauseTask('${task.id}')">æš‚åœ</button>
                     <button style="padding: 4px 8px; background: #E74C3C; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="stopTask('${task.id}')">åœæ­¢</button>
                     <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="triggerTask('${task.id}')">è§¦å‘</button>` :
                    task.status === 'paused' ?
                        `<button style="padding: 4px 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="resumeTask('${task.id}')">æ¢å¤</button>
                     <button style="padding: 4px 8px; background: #E74C3C; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="stopTask('${task.id}')">åœæ­¢</button>
                     <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="triggerTask('${task.id}')">è§¦å‘</button>` :
                        `<button style="padding: 4px 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="startTask('${task.id}')">å¯åŠ¨</button>
                     <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="triggerTask('${task.id}')">è§¦å‘</button>`;

                return `
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1.5fr 1.5fr 1.5fr 1fr 1.5fr; border-bottom: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; background: white;" 
                         onmouseover="this.style.background='rgba(52, 73, 94, 0.05)'; this.style.transform='translateX(2px)'" 
                         onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                        <div style="padding: 15px 12px; text-align: left; display: flex; align-items: center; font-size: 13px; font-weight: 600; color: #333;">
                            <span style="margin-right: 8px; font-size: 16px;">${task.icon}</span>
                            <div>
                                <div style="font-weight: 600;">${task.name}</div>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">${task.description}</div>
                            </div>
                        </div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 13px;">
                            <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; 
                                         background: ${task.status === 'running' ? 'rgba(39, 174, 96, 0.2)' : task.status === 'paused' ? 'rgba(243, 156, 18, 0.2)' : 'rgba(231, 76, 60, 0.2)'};
                                         color: ${task.status === 'running' ? '#27AE60' : task.status === 'paused' ? '#F39C12' : '#E74C3C'};
                                         border: 1px solid ${task.status === 'running' ? 'rgba(39, 174, 96, 0.3)' : task.status === 'paused' ? 'rgba(243, 156, 18, 0.3)' : 'rgba(231, 76, 60, 0.3)'};">
                                ${statusText}
                            </span>
                        </div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; font-family: 'Consolas', 'Monaco', monospace; color: #666;">${task.frequency}</div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 11px; font-family: 'Consolas', 'Monaco', monospace; color: #666;">${task.lastExecution}</div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 11px; font-family: 'Consolas', 'Monaco', monospace; color: #666;">${task.nextExecution}</div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; color: #3498DB;">${task.executionCount}</div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 5px;">
                            ${actions}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // å®šæ—¶ä»»åŠ¡ç›¸å…³å‡½æ•°
        function startAllTasks() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('tasks_start_all'));
        }

        function stopAllTasks() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('tasks_stop_all'));
        }

        function refreshTaskStatus() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('tasks_refresh'));
        }

        function triggerAllTasks() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('tasks_trigger_all'));
        }

        // å•ä¸ªä»»åŠ¡æ§åˆ¶å‡½æ•°
        function startTask(taskId) {
            UserFriendlyAlert.showSuccess(`ä»»åŠ¡ ${taskId} å·²å¯åŠ¨`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIè°ƒç”¨
        }

        function stopTask(taskId) {
            UserFriendlyAlert.showInfo(`ä»»åŠ¡ ${taskId} å·²åœæ­¢`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIè°ƒç”¨
        }

        function pauseTask(taskId) {
            UserFriendlyAlert.showInfo(`ä»»åŠ¡ ${taskId} å·²æš‚åœ`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIè°ƒç”¨
        }

        function resumeTask(taskId) {
            UserFriendlyAlert.showSuccess(`ä»»åŠ¡ ${taskId} å·²æ¢å¤è¿è¡Œ`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIè°ƒç”¨
        }

        function triggerTask(taskId) {
            UserFriendlyAlert.showSuccess(`ä»»åŠ¡ ${taskId} æ‰‹åŠ¨æ‰§è¡Œå®Œæˆ`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIè°ƒç”¨
        }

        // æ•°æ®åˆ†æç›¸å…³å‡½æ•°
        function generateReport() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('report_generated'));
        }

        function exportAnalytics() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('analytics_exported'));
        }

        function refreshAnalytics() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('analytics_refreshed'));
        }

        // æŠ¥è¡¨ä¸­å¿ƒç›¸å…³å‡½æ•°
        function generateDailyReport() {
            UserFriendlyAlert.showSuccess('ç¯å¢ƒæ•°æ®æ—¥æŠ¥ç”ŸæˆæˆåŠŸ');
        }

        function exportDailyReport() {
            UserFriendlyAlert.showSuccess('ç¯å¢ƒæ•°æ®æ—¥æŠ¥å¯¼å‡ºæˆåŠŸ');
        }

        function generateDeviceReport() {
            UserFriendlyAlert.showSuccess('è®¾å¤‡è¿è¡ŒæŠ¥å‘Šç”ŸæˆæˆåŠŸ');
        }

        function exportDeviceReport() {
            UserFriendlyAlert.showSuccess('è®¾å¤‡è¿è¡ŒæŠ¥å‘Šå¯¼å‡ºæˆåŠŸ');
        }

        function generateMonthlyReport() {
            UserFriendlyAlert.showSuccess('æœˆåº¦åˆ†ææŠ¥å‘Šç”ŸæˆæˆåŠŸ');
        }

        function exportMonthlyReport() {
            UserFriendlyAlert.showSuccess('æœˆåº¦åˆ†ææŠ¥å‘Šå¯¼å‡ºæˆåŠŸ');
        }

        function generateAlertReport() {
            UserFriendlyAlert.showSuccess('æŠ¥è­¦ç»Ÿè®¡æŠ¥å‘Šç”ŸæˆæˆåŠŸ');
        }

        function exportAlertReport() {
            UserFriendlyAlert.showSuccess('æŠ¥è­¦ç»Ÿè®¡æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ');
        }

        function generateComprehensiveReport() {
            UserFriendlyAlert.showSuccess('ç»¼åˆæŠ¥å‘Šç”ŸæˆæˆåŠŸ');
        }

        function exportAllData() {
            UserFriendlyAlert.showSuccess('å…¨éƒ¨æ•°æ®å¯¼å‡ºæˆåŠŸ');
        }

        function refreshAllAnalytics() {
            UserFriendlyAlert.showSuccess('å…¨éƒ¨æ•°æ®å·²åˆ·æ–°');
        }

        function scheduleReport() {
            UserFriendlyAlert.showSuccess('å®šæ—¶æŠ¥å‘Šè®¾ç½®å·²ä¿å­˜');
        }

        // ç”Ÿæˆç”¨æˆ·è¡¨æ ¼è¡Œ
        function generateUserTableRows() {
            const users = [
                { id: 1, name: 'é™ˆå¿—å¼º', email: 'chenzhiqiang@yuancho.com', role: 'ç®¡ç†å‘˜', status: 'åœ¨çº¿', lastLogin: '2024-01-15 14:30', avatar: 'ğŸ‘¨â€ğŸ’¼' },
                { id: 2, name: 'æç¾å', email: 'limeihua@yuancho.com', role: 'æ™®é€šç”¨æˆ·', status: 'ç¦»çº¿', lastLogin: '2024-01-15 10:20', avatar: 'ğŸ‘©â€ğŸ’»' },
                { id: 3, name: 'ç‹å»ºå›½', email: 'wangjianguo@yuancho.com', role: 'ç®¡ç†å‘˜', status: 'åœ¨çº¿', lastLogin: '2024-01-15 15:45', avatar: 'ğŸ‘¨â€ğŸ”§' },
                { id: 4, name: 'åˆ˜æ™“æ•', email: 'liuxiaomin@yuancho.com', role: 'æ™®é€šç”¨æˆ·', status: 'åœ¨çº¿', lastLogin: '2024-01-15 16:10', avatar: 'ğŸ‘©â€ğŸŒ¾' },
                { id: 5, name: 'å¼ æ°¸è¾‰', email: 'zhangyonghui@yuancho.com', role: 'æ™®é€šç”¨æˆ·', status: 'ç¦»çº¿', lastLogin: '2024-01-14 18:30', avatar: 'ğŸ‘¨â€ğŸ“' },
                { id: 6, name: 'èµµä¸½å¨Ÿ', email: 'zhaolijuan@yuancho.com', role: 'æ™®é€šç”¨æˆ·', status: 'åœ¨çº¿', lastLogin: '2024-01-15 17:20', avatar: 'ğŸ‘©â€ğŸ’¼' },
                { id: 7, name: 'å­™å¾·å', email: 'sundehua@yuancho.com', role: 'ç®¡ç†å‘˜', status: 'åœ¨çº¿', lastLogin: '2024-01-15 16:45', avatar: 'ğŸ‘¨â€ğŸŒ¾' }
            ];

            return users.map(user => `
                <tr style="border-bottom: 1px solid #e0e0e0; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                    <td style="padding: 15px;">
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" style="margin-right: 12px;" value="${user.id}">
                            <div style="font-size: 24px; margin-right: 12px;">${user.avatar}</div>
                            <div>
                                <div style="font-weight: 600; color: #333; margin-bottom: 2px;">${user.name}</div>
                                <div style="color: #666; font-size: 12px;">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td style="padding: 15px;">
                        <span style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; ${user.role === 'ç®¡ç†å‘˜' ? 'background: #e3f2fd; color: #1976d2;' : 'background: #f3e5f5; color: #7b1fa2;'}">${user.role}</span>
                    </td>
                    <td style="padding: 15px;">
                        <span style="display: flex; align-items: center; font-size: 14px;">
                            <span style="width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; ${user.status === 'åœ¨çº¿' ? 'background: #4caf50;' : 'background: #f44336;'}"></span>
                            ${user.status}
                        </span>
                    </td>
                    <td style="padding: 15px; color: #666; font-size: 14px;">${user.lastLogin}</td>
                    <td style="padding: 15px; text-align: center;">
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            <button style="padding: 6px 12px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="editUser(${user.id})">ç¼–è¾‘</button>
                            <button style="padding: 6px 12px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="resetPassword(${user.id})">é‡ç½®å¯†ç </button>
                            <button style="padding: 6px 12px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="deleteUser(${user.id})">åˆ é™¤</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ç”¨æˆ·ç®¡ç†ç›¸å…³å‡½æ•°
        function addNewUser() {
            UserFriendlyAlert.showSuccess('æ–°ç”¨æˆ·æ·»åŠ æˆåŠŸ');
        }

        function batchManageUsers() {
            UserFriendlyAlert.showSuccess('æ‰¹é‡ç®¡ç†æ“ä½œå®Œæˆ');
        }

        function exportUserList() {
            UserFriendlyAlert.showSuccess('ç”¨æˆ·åˆ—è¡¨å¯¼å‡ºæˆåŠŸ');
        }

        function userPermissionSettings() {
            UserFriendlyAlert.showSuccess('æƒé™è®¾ç½®å·²æ›´æ–°');
        }

        function refreshUserList() {
            UserFriendlyAlert.showSuccess('ç”¨æˆ·åˆ—è¡¨å·²åˆ·æ–°');
        }

        function searchUsers() {
            const searchInput = document.getElementById('userSearchInput');
            if (searchInput && searchInput.value.trim()) {
                UserFriendlyAlert.showSuccess(`æœç´¢ç”¨æˆ·ï¼š${searchInput.value}`);
            } else {
                UserFriendlyAlert.showWarning('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
            }
        }

        function toggleAllUsers(checkbox) {
            const checkboxes = document.querySelectorAll('#userTableBody input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            UserFriendlyAlert.showInfo(checkbox.checked ? 'å·²é€‰æ‹©å…¨éƒ¨ç”¨æˆ·' : 'å·²å–æ¶ˆå…¨éƒ¨é€‰æ‹©');
        }

        function editUser(userId) {
            UserFriendlyAlert.showSuccess(`ç”¨æˆ·ä¿¡æ¯ç¼–è¾‘å®Œæˆ`);
        }

        function resetPassword(userId) {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦é‡ç½®å½“å‰ç”¨æˆ·çš„å¯†ç å—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess(`å¯†ç é‡ç½®æˆåŠŸï¼Œæ–°å¯†ç å·²å‘é€è‡³ç”¨æˆ·é‚®ç®±`);
                },
                function () {
                    // ç”¨æˆ·å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ
                }
            );
        }

        function deleteUser(userId) {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess(`ç”¨æˆ·åˆ é™¤æˆåŠŸ`);
                },
                function () {
                    // ç”¨æˆ·å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ
                }
            );
        }

        // æŠ¥è­¦ç®¡ç†æ“ä½œå‡½æ•°
        function handleAlert(alertId, action) {
            UserFriendlyAlert.showSuccess(`æŠ¥è­¦ #${alertId} å·²æ ‡è®°ä¸ºå·²å¤„ç†`);
            // åˆ·æ–°æŠ¥è­¦åˆ—è¡¨
            setTimeout(() => {
                if (currentPage === 'alerts') {
                    loadPageContent('alerts');
                }
            }, 1000);
        }

        function viewAlertDetails(alertId) {
            UserFriendlyAlert.showInfo(`æ­£åœ¨æŸ¥çœ‹æŠ¥è­¦ #${alertId} çš„è¯¦ç»†ä¿¡æ¯...`);
            // è¿™é‡Œå¯ä»¥æ‰“å¼€è¯¦æƒ…å¼¹çª—æˆ–è·³è½¬åˆ°è¯¦æƒ…é¡µé¢
        }

        function assignAlert(alertId) {
            showCustomPrompt('è¯·è¾“å…¥å¤„ç†äººå‘˜å§“åï¼š', function (assignee) {
                if (assignee && assignee.trim()) {
                    UserFriendlyAlert.showSuccess(`æŠ¥è­¦ #${alertId} å·²åˆ†é…ç»™ ${assignee} å¤„ç†`);
                } else {
                    UserFriendlyAlert.showWarning('è¯·è¾“å…¥æœ‰æ•ˆçš„å¤„ç†äººå‘˜å§“å');
                }
            });
        }

        // è‡ªå®šä¹‰è¾“å…¥å¯¹è¯æ¡†
        function showCustomPrompt(message, onConfirm, onCancel) {
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            // åˆ›å»ºå¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 30px;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                text-align: center;
            `;

            dialog.innerHTML = `
                <div style="font-size: 18px; color: #333; margin-bottom: 20px; line-height: 1.5;">${message}</div>
                <input type="text" id="prompt-input" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; margin-bottom: 20px;" placeholder="è¯·è¾“å…¥...">
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button id="prompt-confirm-btn" style="padding: 12px 24px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">ç¡®å®š</button>
                    <button id="prompt-cancel-btn" style="padding: 12px 24px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">å–æ¶ˆ</button>
                </div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            const input = dialog.querySelector('#prompt-input');
            const confirmBtn = dialog.querySelector('#prompt-confirm-btn');
            const cancelBtn = dialog.querySelector('#prompt-cancel-btn');

            // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
            setTimeout(() => input.focus(), 100);

            // ç»‘å®šäº‹ä»¶
            confirmBtn.addEventListener('click', () => {
                const value = input.value;
                document.body.removeChild(overlay);
                if (onConfirm) onConfirm(value);
            });

            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(overlay);
                if (onCancel) onCancel();
            });

            // å›è½¦ç¡®è®¤
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const value = input.value;
                    document.body.removeChild(overlay);
                    if (onConfirm) onConfirm(value);
                }
            });

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    if (onCancel) onCancel();
                }
            });
        }

        function ignoreAlert(alertId) {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦å¿½ç•¥è¿™ä¸ªæŠ¥è­¦å—ï¼Ÿå¿½ç•¥åå°†ä¸å†æé†’ã€‚',
                function () {
                    UserFriendlyAlert.showSuccess(`æŠ¥è­¦ #${alertId} å·²å¿½ç•¥`);
                    // åˆ·æ–°æŠ¥è­¦åˆ—è¡¨
                    setTimeout(() => {
                        if (currentPage === 'alerts') {
                            loadPageContent('alerts');
                        }
                    }, 1000);
                },
                function () {
                    // ç”¨æˆ·å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ
                }
            );
        }

        function escalateAlert(alertId) {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦å°†æ­¤ä¸¥é‡æŠ¥è­¦ä¸ŠæŠ¥ç»™ä¸Šçº§ç®¡ç†å‘˜å—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess(`ä¸¥é‡æŠ¥è­¦ #${alertId} å·²ä¸ŠæŠ¥ï¼Œç›¸å…³äººå‘˜å°†æ”¶åˆ°ç´§æ€¥é€šçŸ¥`);
                },
                function () {
                    // ç”¨æˆ·å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ
                }
            );
        }

        // æ‰¹é‡æŠ¥è­¦æ“ä½œå‡½æ•°
        function batchHandleAlerts() {
            UserFriendlyAlert.showSuccess('æ‰¹é‡å¤„ç†æ“ä½œå®Œæˆ');
        }

        function exportAlerts() {
            UserFriendlyAlert.showSuccess('æŠ¥è­¦è®°å½•å¯¼å‡ºæˆåŠŸ');
        }

        function refreshAlerts() {
            // é‡æ–°ç”ŸæˆæŠ¥è­¦åˆ—è¡¨
            const alertsList = document.getElementById('alertsList');
            if (alertsList) {
                alertsList.innerHTML = generateAlertItems(currentAlertGreenhouse);
            }

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateAlertStats(currentAlertGreenhouse);

            UserFriendlyAlert.showSuccess('æŠ¥è­¦åˆ—è¡¨å·²åˆ·æ–°');
        }

        function filterAlerts() {
            UserFriendlyAlert.showSuccess('æŠ¥è­¦ç­›é€‰å·²åº”ç”¨');
        }

        // é€€å‡ºç³»ç»Ÿå‡½æ•°
        function logoutSystem() {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess('æ­£åœ¨é€€å‡ºç³»ç»Ÿ...');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                },
                function () {
                    // ç”¨æˆ·å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ
                }
            );
        }

        // å†å²è®°å½•ç›¸å…³å‡½æ•°
        function searchHistory() {
            UserFriendlyAlert.showSuccess(`${greenhouseData[currentHistoryGreenhouse].name}å†å²è®°å½•æœç´¢å®Œæˆ`);
        }

        function exportHistory() {
            UserFriendlyAlert.showSuccess(`${greenhouseData[currentHistoryGreenhouse].name}å†å²è®°å½•å¯¼å‡ºæˆåŠŸ`);
        }

        function exportDeviceStatus() {
            UserFriendlyAlert.showSuccess(`${greenhouseData[currentDeviceGreenhouse].name}è®¾å¤‡çŠ¶æ€å¯¼å‡ºæˆåŠŸ`);
        }

        // é€€å‡ºç³»ç»Ÿå‡½æ•°
        function logoutSystem() {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess('æ­£åœ¨é€€å‡ºç³»ç»Ÿ...');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                },
                function () {
                    // ç”¨æˆ·å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ
                }
            );
        }



        let taskData = [
            {
                id: 'env-data-generation',
                name: 'ç¯å¢ƒæ•°æ®ç”Ÿæˆ',
                icon: 'ğŸŒ¡ï¸',
                status: 'running',
                frequency: 'æ¯30ç§’',
                lastExecution: new Date(Date.now() - 25000),
                nextExecution: new Date('2024-01-08T13:20:15'),
                executionCount: 156,
                description: 'è‡ªåŠ¨é‡‡é›†æ¸©å®¤ç¯å¢ƒæ•°æ®'
            },
            {
                id: 'device-status-update',
                name: 'è®¾å¤‡çŠ¶æ€æ›´æ–°',
                icon: 'âš™ï¸',
                status: 'running',
                frequency: 'æ¯1åˆ†é’Ÿ',
                lastExecution: new Date(Date.now() - 45000),
                nextExecution: new Date('2024-01-08T13:21:30'),
                executionCount: 89,
                description: 'æ›´æ–°æ‰€æœ‰è®¾å¤‡è¿è¡ŒçŠ¶æ€'
            },
            {
                id: 'alert-detection',
                name: 'æŠ¥è­¦æ£€æµ‹',
                icon: 'ğŸš¨',
                status: 'running',
                frequency: 'æ¯1åˆ†é’Ÿ',
                lastExecution: new Date(Date.now() - 30000),
                nextExecution: new Date('2024-01-08T13:21:45'),
                executionCount: 234,
                description: 'æ£€æµ‹ç¯å¢ƒå¼‚å¸¸å¹¶ç”ŸæˆæŠ¥è­¦'
            },
            {
                id: 'automatic-control',
                name: 'è‡ªåŠ¨åŒ–æ§åˆ¶',
                icon: 'ğŸ¤–',
                status: 'running',
                frequency: 'æ¯2åˆ†é’Ÿ',
                lastExecution: new Date(Date.now() - 80000),
                nextExecution: new Date('2024-01-08T13:22:10'),
                executionCount: 67,
                description: 'æ ¹æ®ç¯å¢ƒæ•°æ®è‡ªåŠ¨æ§åˆ¶è®¾å¤‡'
            },
            {
                id: 'device-fault-detection',
                name: 'è®¾å¤‡æ•…éšœæ£€æµ‹',
                icon: 'ğŸ”§',
                status: 'running',
                frequency: 'æ¯5åˆ†é’Ÿ',
                lastExecution: new Date(Date.now() - 180000),
                nextExecution: new Date('2024-01-08T13:25:00'),
                executionCount: 23,
                description: 'æ£€æµ‹è®¾å¤‡æ•…éšœå’Œå¼‚å¸¸çŠ¶æ€'
            },
            {
                id: 'data-backup',
                name: 'æ•°æ®å¤‡ä»½',
                icon: 'ğŸ’¾',
                status: 'paused',
                frequency: 'æ¯å°æ—¶',
                lastExecution: new Date(Date.now() - 3600000),
                nextExecution: new Date('2024-01-08T14:20:00'),
                executionCount: 12,
                description: 'å®šæœŸå¤‡ä»½ç³»ç»Ÿé‡è¦æ•°æ®'
            }
        ];

        // åŠ è½½è®¾å¤‡æ§åˆ¶å†…å®¹
        function loadDevicesContent(container) {
            container.innerHTML = `
                <!-- æ¸©å®¤é€‰æ‹©å™¨ -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ </span>æ¸©å®¤é€‰æ‹©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="device-greenhouse-btn active" onclick="selectDeviceGreenhouse(1)" style="padding: 12px 20px; background: #2C3E50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">1å·æ¸©å®¤ (è”¬èœåŒº)</button>
                        <button class="device-greenhouse-btn" onclick="selectDeviceGreenhouse(2)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">2å·æ¸©å®¤ (èŠ±å‰åŒº)</button>
                        <button class="device-greenhouse-btn" onclick="selectDeviceGreenhouse(3)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">3å·æ¸©å®¤ (è‚²è‹—åŒº)</button>
                        <button class="device-greenhouse-btn" onclick="selectDeviceGreenhouse(4)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">4å·æ¸©å®¤ (å®éªŒåŒº)</button>
                    </div>
                </div>

                <!-- è®¾å¤‡æ§åˆ¶æ“ä½œæ  -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ› ï¸</span>è®¾å¤‡æ“ä½œ
                        </h3>
                        <div style="display: flex; gap: 10px;">
                            <span style="padding: 8px 12px; background: #27AE60; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">è¿è¡Œä¸­: 8</span>
                            <span style="padding: 8px 12px; background: #F39C12; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">å¾…æœº: 3</span>
                            <span style="padding: 8px 12px; background: #95A5A6; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">å…³é—­: 1</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                        <button style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="startAllDevices()">ğŸš€ å¯åŠ¨æ‰€æœ‰è®¾å¤‡</button>
                        <button style="padding: 12px 20px; background: #E74C3C; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="stopAllDevices()">ğŸ›‘ åœæ­¢æ‰€æœ‰è®¾å¤‡</button>
                        <button style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="refreshDevices()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
                        <button style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="exportDeviceStatus()">ğŸ“¤ å¯¼å‡ºçŠ¶æ€</button>
                    </div>
                </div>

                <!-- è®¾å¤‡ç½‘æ ¼ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">âš™ï¸</span>è®¾å¤‡åˆ—è¡¨
                        <span style="margin-left: auto; font-size: 14px; color: #666; font-weight: normal;">ç‚¹å‡»è®¾å¤‡å¡ç‰‡æŸ¥çœ‹è¯¦ç»†æ§åˆ¶ï¼Œç‚¹å‡»ç»´æŠ¤æŒ‰é’®ç®¡ç†ç»´æŠ¤</span>
                    </h3>
                    <div id="devicesGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${generateDeviceCards(currentDeviceGreenhouse)}
                    </div>
                </div>

                <!-- ç»´æŠ¤ç®¡ç†æ¦‚è§ˆ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ”§</span>ç»´æŠ¤ç®¡ç†ä¸­å¿ƒ
                        </h3>
                        <div style="display: flex; gap: 10px;">
                            <button style="padding: 8px 16px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="createMaintenancePlan()">+ åˆ›å»ºç»´æŠ¤è®¡åˆ’</button>
                            <button style="padding: 8px 16px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="refreshMaintenanceData()">ğŸ”„ åˆ·æ–°</button>
                        </div>
                    </div>
                    
                    <!-- ç»´æŠ¤çŠ¶æ€ç»Ÿè®¡ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #E74C3C;">
                            <div style="font-size: 24px; font-weight: bold; color: #E74C3C; margin-bottom: 5px;" id="overdueCount">2</div>
                            <div style="font-size: 14px; color: #666;">å·²è¿‡æœŸ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #F39C12;">
                            <div style="font-size: 24px; font-weight: bold; color: #F39C12; margin-bottom: 5px;" id="upcomingCount">5</div>
                            <div style="font-size: 14px; color: #666;">å³å°†åˆ°æœŸ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #27AE60;">
                            <div style="font-size: 24px; font-weight: bold; color: #27AE60; margin-bottom: 5px;" id="completedCount">12</div>
                            <div style="font-size: 14px; color: #666;">å·²å®Œæˆ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #3498DB;">
                            <div style="font-size: 24px; font-weight: bold; color: #3498DB; margin-bottom: 5px;" id="totalPlansCount">19</div>
                            <div style="font-size: 14px; color: #666;">æ€»è®¡åˆ’æ•°</div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤è®¡åˆ’åˆ—è¡¨ -->
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 8px;">ğŸ“‹</span>ç»´æŠ¤è®¡åˆ’
                        </h4>
                        <div style="background: #f8f9fa; border-radius: 8px; overflow: hidden;">
                            <!-- è¡¨å¤´ -->
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1.5fr; background: #34495E; color: white; font-weight: 600; font-size: 13px;">
                                <div style="padding: 12px 15px;">è®¾å¤‡åç§°</div>
                                <div style="padding: 12px 15px; text-align: center;">ç»´æŠ¤ç±»å‹</div>
                                <div style="padding: 12px 15px; text-align: center;">è®¡åˆ’æ—¥æœŸ</div>
                                <div style="padding: 12px 15px; text-align: center;">çŠ¶æ€</div>
                                <div style="padding: 12px 15px; text-align: center;">è´Ÿè´£äºº</div>
                                <div style="padding: 12px 15px; text-align: center;">æ“ä½œ</div>
                            </div>
                            <!-- ç»´æŠ¤è®¡åˆ’æ•°æ® -->
                            <div id="maintenancePlansContainer">
                                ${generateMaintenancePlansHTML()}
                            </div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤è®°å½•åˆ—è¡¨ -->
                    <div>
                        <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 8px;">ğŸ“</span>ç»´æŠ¤è®°å½•
                        </h4>
                        <div style="background: #f8f9fa; border-radius: 8px; overflow: hidden;">
                            <!-- è¡¨å¤´ -->
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 2fr; background: #2C3E50; color: white; font-weight: 600; font-size: 13px;">
                                <div style="padding: 12px 15px;">è®¾å¤‡åç§°</div>
                                <div style="padding: 12px 15px; text-align: center;">ç»´æŠ¤ç±»å‹</div>
                                <div style="padding: 12px 15px; text-align: center;">å®Œæˆæ—¥æœŸ</div>
                                <div style="padding: 12px 15px; text-align: center;">è€—æ—¶</div>
                                <div style="padding: 12px 15px; text-align: center;">æ‰§è¡Œäºº</div>
                                <div style="padding: 12px 15px;">å¤‡æ³¨</div>
                            </div>
                            <!-- ç»´æŠ¤è®°å½•æ•°æ® -->
                            <div id="maintenanceRecordsContainer">
                                ${generateMaintenanceRecordsHTML()}
                            </div>
                        </div>
                    </div>
                <div font-size: 24px; font-weight: bold; color: #F39C12; margin-bottom: 5px;" id="dueSoonCount">2</div>
                            <div style="font-size: 14px; color: #666;">å³å°†åˆ°æœŸ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #E67E22;">
                            <div style="font-size: 24px; font-weight: bold; color: #E67E22; margin-bottom: 5px;" id="needMaintenanceCount">1</div>
                            <div style="font-size: 14px; color: #666;">éœ€è¦ç»´æŠ¤</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #27AE60;">
                            <div style="font-size: 24px; font-weight: bold; color: #27AE60; margin-bottom: 5px;" id="normalCount">5</div>
                            <div style="font-size: 14px; color: #666;">çŠ¶æ€æ­£å¸¸</div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤ç®¡ç†æ“ä½œ -->
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px;">
                        <button style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="showMaintenanceScheduleList()">ğŸ“… ç»´æŠ¤è®¡åˆ’</button>
                        <button style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="showMaintenanceRecordsList()">ğŸ“‹ ç»´æŠ¤è®°å½•</button>
                        <button style="padding: 12px 20px; background: #E67E22; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="createMaintenancePlan()">â• åˆ›å»ºè®¡åˆ’</button>
                        <button style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="exportMaintenanceReport()">ğŸ“Š å¯¼å‡ºæŠ¥å‘Š</button>
                    </div>

                    <!-- ç»´æŠ¤è®¡åˆ’åˆ—è¡¨ -->
                    <div id="maintenanceScheduleSection" style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“…</span>è¿‘æœŸç»´æŠ¤è®¡åˆ’
                        </h4>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div id="maintenanceScheduleList">
                                ${generateMaintenanceScheduleList()}
                            </div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤è®°å½•åˆ—è¡¨ -->
                    <div id="maintenanceRecordsSection">
                        <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ“‹</span>æœ€è¿‘ç»´æŠ¤è®°å½•
                        </h4>
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                            <div id="maintenanceRecordsList">
                                ${generateMaintenanceRecordsList()}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½å®šæ—¶ä»»åŠ¡å†…å®¹
        function loadTasksContent(container) {
            container.innerHTML = `
                <!-- ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒ -->
                <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">âš™ï¸</span>ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒ
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                        <button style="padding: 15px 25px; background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;" onclick="startAllTasksWithSync()">
                            ğŸš€ å¯åŠ¨æ‰€æœ‰ä»»åŠ¡
                        </button>
                        <button style="padding: 15px 25px; background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;" onclick="stopAllTasksWithSync()">
                            ğŸ›‘ åœæ­¢æ‰€æœ‰ä»»åŠ¡
                        </button>
                        <button style="padding: 15px 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;" onclick="refreshTaskStatusWithSync()">
                            ğŸ”„ åˆ·æ–°çŠ¶æ€
                        </button>
                        <button style="padding: 15px 25px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;" onclick="triggerAllTasksWithSync()">
                            âš¡ æ‰‹åŠ¨è§¦å‘æ‰€æœ‰ä»»åŠ¡
                        </button>
                    </div>

                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div style="display: inline-flex; align-items: center; font-size: 1.1rem; font-weight: 500;">
                            <span id="statusDot" style="width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; background: #56ab2f; box-shadow: 0 0 10px rgba(86, 171, 47, 0.5); animation: pulse 2s infinite;"></span>
                            <span>ç³»ç»ŸçŠ¶æ€ï¼š<strong id="statusText">è¿è¡Œä¸­</strong></span>
                        </div>
                    </div>
                </div>

                <!-- å½“å‰ä»»åŠ¡åˆ—è¡¨ -->
                <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ“‹</span>å½“å‰ä»»åŠ¡åˆ—è¡¨
                    </h3>
                    <div style="background: rgba(248, 249, 250, 0.8); border-radius: 15px; overflow: hidden; border: 1px solid rgba(0, 0, 0, 0.1);">
                        <!-- è¡¨å¤´ -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1.5fr 1.5fr 1.5fr 1fr 1.5fr; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">ä»»åŠ¡åç§°</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">çŠ¶æ€</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">æ‰§è¡Œé¢‘ç‡</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">ä¸Šæ¬¡æ‰§è¡Œ</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">ä¸‹æ¬¡æ‰§è¡Œ</div>
                            <div style="padding: 15px 12px; text-align: center; border-right: 1px solid rgba(255, 255, 255, 0.2);">æ‰§è¡Œæ¬¡æ•°</div>
                            <div style="padding: 15px 12px; text-align: center;">æ“ä½œ</div>
                        </div>
                        <!-- ä»»åŠ¡åˆ—è¡¨ -->
                        <div id="taskListContainer" style="max-height: 400px; overflow-y: auto;">
                            ${generateTaskListHTML()}
                        </div>
                    </div>
                </div>
            `;

            // å¯åŠ¨æ—¶é—´æ›´æ–°å®šæ—¶å™¨
            startTaskTimeUpdater();
        }

        // ç”Ÿæˆä»»åŠ¡åˆ—è¡¨HTML
        function generateTaskListHTML() {
            return taskData.map(task => {
                const statusClass = task.status === 'running' ? 'status-running' :
                    task.status === 'paused' ? 'status-paused' : 'status-stopped';
                const statusText = task.status === 'running' ? 'è¿è¡Œä¸­' :
                    task.status === 'paused' ? 'å·²æš‚åœ' : 'å·²åœæ­¢';

                const actions = task.status === 'running' ?
                    `<button style="padding: 4px 8px; background: #F39C12; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="pauseTaskWithSync('${task.id}')">æš‚åœ</button>
                     <button style="padding: 4px 8px; background: #E74C3C; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="stopTaskWithSync('${task.id}')">åœæ­¢</button>
                     <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="triggerTaskWithSync('${task.id}')">è§¦å‘</button>` :
                    task.status === 'paused' ?
                        `<button style="padding: 4px 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="resumeTaskWithSync('${task.id}')">æ¢å¤</button>
                     <button style="padding: 4px 8px; background: #E74C3C; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="stopTaskWithSync('${task.id}')">åœæ­¢</button>
                     <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="triggerTaskWithSync('${task.id}')">è§¦å‘</button>` :
                        `<button style="padding: 4px 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 5px;" onclick="startTaskWithSync('${task.id}')">å¯åŠ¨</button>
                     <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="triggerTaskWithSync('${task.id}')">è§¦å‘</button>`;

                return `
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1.5fr 1.5fr 1.5fr 1fr 1.5fr; border-bottom: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; background: white;" 
                         onmouseover="this.style.background='rgba(102, 126, 234, 0.05)'; this.style.transform='translateX(2px)'" 
                         onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                        <div style="padding: 15px 12px; text-align: left; display: flex; align-items: center; font-size: 13px; font-weight: 600; color: #333;">
                            <span style="margin-right: 8px; font-size: 16px;">${task.icon}</span>
                            <div>
                                <div style="font-weight: 600;">${task.name}</div>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">${task.description}</div>
                            </div>
                        </div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 13px;">
                            <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; 
                                         background: ${task.status === 'running' ? 'rgba(39, 174, 96, 0.2)' : task.status === 'paused' ? 'rgba(243, 156, 18, 0.2)' : 'rgba(231, 76, 60, 0.2)'};
                                         color: ${task.status === 'running' ? '#27AE60' : task.status === 'paused' ? '#F39C12' : '#E74C3C'};
                                         border: 1px solid ${task.status === 'running' ? 'rgba(39, 174, 96, 0.3)' : task.status === 'paused' ? 'rgba(243, 156, 18, 0.3)' : 'rgba(231, 76, 60, 0.3)'};">
                                ${statusText}
                            </span>
                        </div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; font-family: 'Consolas', 'Monaco', monospace; color: #666;">${task.frequency}</div>
                        <div id="last-${task.id}" style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 11px; font-family: 'Consolas', 'Monaco', monospace; color: #666;">${formatTime(task.lastExecution)}</div>
                        <div id="next-${task.id}" style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 11px; font-family: 'Consolas', 'Monaco', monospace; color: #666;">${formatCountdown(task.nextExecution)}</div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; color: #3498DB;">${task.executionCount}</div>
                        <div style="padding: 15px 12px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 5px;">
                            ${actions}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(date) {
            const now = new Date();
            const diff = Math.abs(now - date);

            if (diff < 60000) { // å°äº1åˆ†é’Ÿ
                return Math.floor(diff / 1000) + 'ç§’å‰';
            } else if (diff < 3600000) { // å°äº1å°æ—¶
                return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            } else {
                return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }
        }

        // æ ¼å¼åŒ–å€’è®¡æ—¶
        function formatCountdown(date) {
            const now = new Date();
            const diff = date - now;

            if (diff <= 0) {
                return '2024-01-08 13:20:15';
            }

            if (diff < 60000) { // å°äº1åˆ†é’Ÿ
                return Math.floor(diff / 1000) + 'ç§’å';
            } else if (diff < 3600000) { // å°äº1å°æ—¶
                return Math.floor(diff / 60000) + 'åˆ†é’Ÿå';
            } else {
                return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            }
        }

        // è·å–é¢‘ç‡å¯¹åº”çš„æ¯«ç§’æ•°
        function getFrequencyMs(frequency) {
            const frequencyMap = {
                'æ¯30ç§’': 30000,
                'æ¯1åˆ†é’Ÿ': 60000,
                'æ¯2åˆ†é’Ÿ': 120000,
                'æ¯5åˆ†é’Ÿ': 300000,
                'æ¯å°æ—¶': 3600000
            };
            return frequencyMap[frequency] || 60000;
        }

        // æ›´æ–°ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º
        function updateTaskList() {
            const container = document.getElementById('taskListContainer');
            if (container) {
                container.innerHTML = generateTaskListHTML();
            }
        }

        // æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º
        function updateSystemStatus() {
            const runningTasks = taskData.filter(task => task.status === 'running').length;
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            if (runningTasks > 0) {
                statusDot.style.background = '#56ab2f';
                statusDot.style.boxShadow = '0 0 10px rgba(86, 171, 47, 0.5)';
                statusText.textContent = 'è¿è¡Œä¸­';
            } else {
                statusDot.style.background = '#ff416c';
                statusDot.style.boxShadow = '0 0 10px rgba(255, 65, 108, 0.5)';
                statusText.textContent = 'å·²åœæ­¢';
            }
        }

        // å¯åŠ¨æ—¶é—´æ›´æ–°å®šæ—¶å™¨
        function startTaskTimeUpdater() {
            setInterval(() => {
                taskData.forEach(task => {
                    const lastElement = document.getElementById(`last-${task.id}`);
                    const nextElement = document.getElementById(`next-${task.id}`);

                    if (lastElement) {
                        lastElement.textContent = formatTime(task.lastExecution);
                    }

                    if (nextElement) {
                        nextElement.textContent = formatCountdown(task.nextExecution);
                    }
                });
            }, 1000);
        }

        // å¸¦åŒæ­¥çš„ä»»åŠ¡æ§åˆ¶å‡½æ•°
        function startAllTasksWithSync() {
            let startedCount = 0;
            taskData.forEach(task => {
                if (task.status === 'stopped' || task.status === 'paused') {
                    task.status = 'running';
                    task.nextExecution = new Date(Date.now() + getFrequencyMs(task.frequency));
                    startedCount++;
                }
            });

            updateTaskList();
            updateSystemStatus();
            UserFriendlyAlert.showSuccess(`å·²å¯åŠ¨ ${startedCount} ä¸ªå®šæ—¶ä»»åŠ¡`);
        }

        function stopAllTasksWithSync() {
            let stoppedCount = 0;
            taskData.forEach(task => {
                if (task.status === 'running' || task.status === 'paused') {
                    task.status = 'stopped';
                    stoppedCount++;
                }
            });

            updateTaskList();
            updateSystemStatus();
            UserFriendlyAlert.showSuccess(`å·²åœæ­¢ ${stoppedCount} ä¸ªå®šæ—¶ä»»åŠ¡`);
        }

        function refreshTaskStatusWithSync() {
            updateTaskList();
            updateSystemStatus();
            UserFriendlyAlert.showSuccess('ä»»åŠ¡çŠ¶æ€å·²åˆ·æ–°');
        }

        function triggerAllTasksWithSync() {
            taskData.forEach(task => {
                task.executionCount++;
                task.lastExecution = new Date();
                task.nextExecution = new Date(Date.now() + getFrequencyMs(task.frequency));
            });

            updateTaskList();
            UserFriendlyAlert.showSuccess('æ‰€æœ‰ä»»åŠ¡æ‰‹åŠ¨è§¦å‘å®Œæˆ');
        }

        // å•ä¸ªä»»åŠ¡æ§åˆ¶å‡½æ•°
        function startTaskWithSync(taskId) {
            const task = taskData.find(t => t.id === taskId);
            if (task) {
                task.status = 'running';
                task.nextExecution = new Date(Date.now() + getFrequencyMs(task.frequency));
                updateTaskList();
                updateSystemStatus();
                UserFriendlyAlert.showSuccess(`${task.icon} ${task.name} å·²å¯åŠ¨`);
            }
        }

        function stopTaskWithSync(taskId) {
            const task = taskData.find(t => t.id === taskId);
            if (task) {
                task.status = 'stopped';
                updateTaskList();
                updateSystemStatus();
                UserFriendlyAlert.showInfo(`${task.icon} ${task.name} å·²åœæ­¢`);
            }
        }

        function pauseTaskWithSync(taskId) {
            const task = taskData.find(t => t.id === taskId);
            if (task) {
                task.status = 'paused';
                updateTaskList();
                updateSystemStatus();
                UserFriendlyAlert.showInfo(`${task.icon} ${task.name} å·²æš‚åœ`);
            }
        }

        function resumeTaskWithSync(taskId) {
            const task = taskData.find(t => t.id === taskId);
            if (task) {
                task.status = 'running';
                task.nextExecution = new Date(Date.now() + getFrequencyMs(task.frequency));
                updateTaskList();
                updateSystemStatus();
                UserFriendlyAlert.showSuccess(`${task.icon} ${task.name} å·²æ¢å¤è¿è¡Œ`);
            }
        }

        function triggerTaskWithSync(taskId) {
            const task = taskData.find(t => t.id === taskId);
            if (task) {
                task.executionCount++;
                task.lastExecution = new Date();
                task.nextExecution = new Date(Date.now() + getFrequencyMs(task.frequency));
                updateTaskList();
                UserFriendlyAlert.showSuccess(`${task.icon} ${task.name} æ‰‹åŠ¨æ‰§è¡Œå®Œæˆ`);
            }
        }

        // è®¾å¤‡æ§åˆ¶ç›¸å…³å‡½æ•°
        function startAllDevices() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_start_all'));
        }

        function stopAllDevices() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_stop_all'));
        }

        function refreshDevices() {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_refresh'));
        }

        function startDevice(deviceName) {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_start_single', deviceName));
        }

        function stopDevice(deviceName) {
            UserFriendlyAlert.showSuccess(MessageFormatter.formatSuccess('device_stop_single', deviceName));
        }

        // ç»´æŠ¤è®¡åˆ’æ•°æ®å­˜å‚¨
        let maintenancePlans = [
            { id: 1, deviceName: 'æ¸©åº¦æ§åˆ¶å™¨', deviceIcon: 'ğŸŒ¡ï¸', type: 'å®šæœŸæ£€æŸ¥', plannedDate: '2024-01-16', status: 'å¾…æ‰§è¡Œ', assignee: 'å¼ å·¥ç¨‹å¸ˆ', priority: 'normal', description: 'æ£€æŸ¥æ¸©åº¦ä¼ æ„Ÿå™¨ç²¾åº¦ï¼Œæ¸…æ´è®¾å¤‡å¤–å£³' },
            { id: 2, deviceName: 'çŒæº‰ç³»ç»Ÿ', deviceIcon: 'ğŸ’§', type: 'æ·±åº¦æ¸…æ´', plannedDate: '2024-01-15', status: 'å·²è¿‡æœŸ', assignee: 'ææŠ€å¸ˆ', priority: 'high', description: 'æ¸…ç†ç®¡é“å µå¡ï¼Œæ›´æ¢è€åŒ–å¯†å°åœˆ' },
            { id: 3, deviceName: 'è¡¥å…‰ç¯', deviceIcon: 'ğŸ’¡', type: 'ç¯æ³¡æ›´æ¢', plannedDate: '2024-01-18', status: 'å¾…æ‰§è¡Œ', assignee: 'ç‹å¸ˆå‚…', priority: 'normal', description: 'æ›´æ¢è€åŒ–LEDç¯æ³¡ï¼Œæ£€æŸ¥ç”µè·¯è¿æ¥' },
            { id: 4, deviceName: 'é€šé£ç³»ç»Ÿ', deviceIcon: 'ğŸŒªï¸', type: 'æ»¤ç½‘æ¸…æ´—', plannedDate: '2024-01-17', status: 'å¾…æ‰§è¡Œ', assignee: 'é™ˆæŠ€å¸ˆ', priority: 'normal', description: 'æ¸…æ´—è¿›é£å£æ»¤ç½‘ï¼Œæ£€æŸ¥é£æ‰‡è¿è½¬' },
            { id: 5, deviceName: 'åŠ çƒ­å™¨', deviceIcon: 'ğŸ”¥', type: 'å®‰å…¨æ£€æŸ¥', plannedDate: '2024-01-14', status: 'å·²è¿‡æœŸ', assignee: 'åˆ˜å·¥ç¨‹å¸ˆ', priority: 'high', description: 'æ£€æŸ¥åŠ çƒ­å…ƒä»¶å’Œæ¸©æ§ç³»ç»Ÿå®‰å…¨æ€§' },
            { id: 6, deviceName: 'æ¹¿åº¦ä¼ æ„Ÿå™¨', deviceIcon: 'ğŸ’¨', type: 'æ ¡å‡†æ£€æµ‹', plannedDate: '2024-01-19', status: 'å¾…æ‰§è¡Œ', assignee: 'èµµæŠ€å¸ˆ', priority: 'low', description: 'é‡æ–°æ ¡å‡†ä¼ æ„Ÿå™¨ï¼Œæå‡æ£€æµ‹ç²¾åº¦' }
        ];

        // ç»´æŠ¤ç®¡ç†ç›¸å…³å‡½æ•°
        function createMaintenancePlan() {
            console.log('createMaintenancePlan called');

            try {
                showMaintenancePlanModal();
            } catch (error) {
                console.error('Error in createMaintenancePlan:', error);
                alert('åˆ›å»ºç»´æŠ¤è®¡åˆ’æ—¶å‘ç”Ÿé”™è¯¯: ' + error.message);
            }
        }

        // æ˜¾ç¤ºç»´æŠ¤è®¡åˆ’åˆ›å»ºå¼¹çª—
        function showMaintenancePlanModal(planData = null) {
            const isEdit = planData !== null;
            const modalTitle = isEdit ? 'ç¼–è¾‘ç»´æŠ¤è®¡åˆ’' : 'åˆ›å»ºç»´æŠ¤è®¡åˆ’';

            // é‡ç½®å…¨å±€å˜é‡
            if (!isEdit) {
                maintenanceSteps = [];
                requiredTools = [];
                stepCounter = 0;
            }

            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

            // åˆ›å»ºå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 15px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: slideIn 0.3s ease;
            `;

            modal.innerHTML = `
                <div style="padding: 25px; border-bottom: 1px solid #eee;">
                    <h3 style="margin: 0; color: #333; font-size: 20px; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ“‹</span>${modalTitle}
                    </h3>
                </div>
                
                <form id="maintenancePlanForm" style="padding: 25px;">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="margin-bottom: 15px; color: #333; font-size: 16px;">åŸºæœ¬ä¿¡æ¯</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">è®¾å¤‡åç§° *</label>
                                <select name="deviceName" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                    <option value="">è¯·é€‰æ‹©è®¾å¤‡</option>
                                    <option value="æ¸©åº¦æ§åˆ¶å™¨">ğŸŒ¡ï¸ æ¸©åº¦æ§åˆ¶å™¨</option>
                                    <option value="æ¹¿åº¦æ§åˆ¶å™¨">ğŸ’¨ æ¹¿åº¦æ§åˆ¶å™¨</option>
                                    <option value="è¡¥å…‰ç¯ç³»ç»Ÿ">ğŸ’¡ è¡¥å…‰ç¯ç³»ç»Ÿ</option>
                                    <option value="é€šé£ç³»ç»Ÿ">ğŸŒªï¸ é€šé£ç³»ç»Ÿ</option>
                                    <option value="çŒæº‰ç³»ç»Ÿ">ğŸ’§ çŒæº‰ç³»ç»Ÿ</option>
                                    <option value="åŠ çƒ­å™¨">ğŸ”¥ åŠ çƒ­å™¨</option>
                                    <option value="å†·å´å™¨">â„ï¸ å†·å´å™¨</option>
                                    <option value="CO2å‘ç”Ÿå™¨">ğŸ’¨ CO2å‘ç”Ÿå™¨</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">ç»´æŠ¤ç±»å‹ *</label>
                                <select name="type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                    <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                                    <option value="å®šæœŸä¿å…»">å®šæœŸä¿å…»</option>
                                    <option value="æ•…éšœç»´ä¿®">æ•…éšœç»´ä¿®</option>
                                    <option value="é¢„é˜²æ€§ç»´æŠ¤">é¢„é˜²æ€§ç»´æŠ¤</option>
                                    <option value="ç´§æ€¥ç»´ä¿®">ç´§æ€¥ç»´ä¿®</option>
                                    <option value="è®¾å¤‡å‡çº§">è®¾å¤‡å‡çº§</option>
                                    <option value="å®‰å…¨æ£€æŸ¥">å®‰å…¨æ£€æŸ¥</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">è®¡åˆ’æ—¥æœŸ *</label>
                                <input type="date" name="plannedDate" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">ä¼˜å…ˆçº§</label>
                                <select name="priority" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                    <option value="low">ä½ä¼˜å…ˆçº§</option>
                                    <option value="normal" selected>æ™®é€šä¼˜å…ˆçº§</option>
                                    <option value="high">é«˜ä¼˜å…ˆçº§</option>
                                    <option value="urgent">ç´§æ€¥</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- äººå‘˜åˆ†é… -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="margin-bottom: 15px; color: #333; font-size: 16px;">äººå‘˜åˆ†é…</h4>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">è´Ÿè´£äºº *</label>
                            <select name="assignee" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <option value="">è¯·é€‰æ‹©è´Ÿè´£äºº</option>
                                <option value="å¼ å·¥ç¨‹å¸ˆ">å¼ å·¥ç¨‹å¸ˆ</option>
                                <option value="ææŠ€å¸ˆ">ææŠ€å¸ˆ</option>
                                <option value="ç‹å¸ˆå‚…">ç‹å¸ˆå‚…</option>
                                <option value="é™ˆæŠ€å¸ˆ">é™ˆæŠ€å¸ˆ</option>
                                <option value="åˆ˜å·¥ç¨‹å¸ˆ">åˆ˜å·¥ç¨‹å¸ˆ</option>
                                <option value="èµµæŠ€å¸ˆ">èµµæŠ€å¸ˆ</option>
                                <option value="å­™å¸ˆå‚…">å­™å¸ˆå‚…</option>
                                <option value="å‘¨æŠ€å¸ˆ">å‘¨æŠ€å¸ˆ</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ç»´æŠ¤å†…å®¹ -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="margin-bottom: 15px; color: #333; font-size: 16px;">ç»´æŠ¤å†…å®¹</h4>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">ç»´æŠ¤æè¿°</label>
                            <textarea name="description" rows="3" placeholder="è¯·ç®€è¦æè¿°ç»´æŠ¤ç›®æ ‡å’Œæ€»ä½“è¦æ±‚..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                        </div>
                        
                        <!-- ç»´æŠ¤æ­¥éª¤ç®¡ç† -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <label style="font-weight: 600; color: #555;">ç»´æŠ¤æ­¥éª¤</label>
                                <button type="button" onclick="addMaintenanceStep()" style="padding: 6px 12px; background: #3498DB; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                                    <span style="margin-right: 5px;">+</span>æ·»åŠ æ­¥éª¤
                                </button>
                            </div>
                            <div id="maintenanceStepsContainer" style="border: 1px solid #e0e0e0; border-radius: 6px; min-height: 60px; background: #fafafa;">
                                <div style="padding: 20px; text-align: center; color: #999; font-size: 14px;" id="noStepsMessage">
                                    æš‚æ— ç»´æŠ¤æ­¥éª¤ï¼Œç‚¹å‡»"æ·»åŠ æ­¥éª¤"å¼€å§‹åˆ›å»º
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ‰€éœ€å·¥å…· -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">æ‰€éœ€å·¥å…·</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="text" id="toolInput" placeholder="è¾“å…¥å·¥å…·åç§°..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <button type="button" onclick="addTool()" style="padding: 8px 15px; background: #27AE60; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">æ·»åŠ </button>
                            </div>
                            <div id="toolsList" style="display: flex; flex-wrap: wrap; gap: 8px; min-height: 30px;">
                                <!-- å·¥å…·æ ‡ç­¾å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>
                        
                        <!-- å®‰å…¨æ³¨æ„äº‹é¡¹ -->
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">å®‰å…¨æ³¨æ„äº‹é¡¹</label>
                            <textarea name="safetyNotes" rows="3" placeholder="è¯·åˆ—å‡ºé‡è¦çš„å®‰å…¨æ³¨æ„äº‹é¡¹å’Œé£é™©æé†’..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                        </div>
                    </div>
                </form>
                
                <div style="padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="closeMaintenancePlanModal()" style="padding: 10px 20px; background: #95A5A6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                    <button type="button" onclick="saveMaintenancePlan(${isEdit ? planData?.id : 'null'})" style="padding: 10px 20px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">${isEdit ? 'æ›´æ–°è®¡åˆ’' : 'åˆ›å»ºè®¡åˆ’'}</button>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œå¡«å……ç°æœ‰æ•°æ®
            if (isEdit && planData) {
                const form = modal.querySelector('#maintenancePlanForm');
                form.deviceName.value = planData.deviceName;
                form.type.value = planData.type;
                form.plannedDate.value = planData.plannedDate;
                form.priority.value = planData.priority;
                form.assignee.value = planData.assignee;
                form.description.value = planData.description || '';
                form.safetyNotes.value = planData.safetyNotes || '';

                // åŠ è½½ç»´æŠ¤æ­¥éª¤
                if (planData.maintenanceSteps && planData.maintenanceSteps.length > 0) {
                    // æ¸…ç©ºç°æœ‰æ­¥éª¤
                    const container = document.getElementById('maintenanceStepsContainer');
                    container.innerHTML = '';

                    // æ·»åŠ æ¯ä¸ªæ­¥éª¤
                    planData.maintenanceSteps.forEach((step, index) => {
                        stepCounter++;
                        const stepId = `step_${stepCounter}`;

                        const stepHtml = `
                            <div class="maintenance-step" data-step-id="${stepId}" style="border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; background: white;">
                                <div style="padding: 15px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <h5 style="margin: 0; color: #333; font-size: 14px; font-weight: 600;">æ­¥éª¤ ${step.stepNumber}</h5>
                                        <div style="display: flex; gap: 5px;">
                                            <button type="button" onclick="moveStepUp('${stepId}')" style="padding: 4px 8px; background: #95A5A6; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;" title="ä¸Šç§»">â†‘</button>
                                            <button type="button" onclick="moveStepDown('${stepId}')" style="padding: 4px 8px; background: #95A5A6; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;" title="ä¸‹ç§»">â†“</button>
                                            <button type="button" onclick="removeMaintenanceStep('${stepId}')" style="padding: 4px 8px; background: #E74C3C; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;" title="åˆ é™¤">Ã—</button>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-bottom: 10px;">
                                        <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">æ­¥éª¤æè¿° *</label>
                                        <textarea class="step-description" rows="2" placeholder="è¯¦ç»†æè¿°æ­¤æ­¥éª¤çš„æ“ä½œå†…å®¹..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; resize: vertical;" required>${step.description}</textarea>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                        <div>
                                            <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">é¢„è®¡æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                            <input type="number" class="step-time" min="1" placeholder="30" value="${step.estimatedTime || ''}" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                        </div>
                                        <div>
                                            <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">æ‰€éœ€å·¥å…·</label>
                                            <input type="text" class="step-tools" placeholder="èºä¸åˆ€, ä¸‡ç”¨è¡¨..." value="${step.requiredTools ? step.requiredTools.join(', ') : ''}" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">å®‰å…¨è­¦å‘Š</label>
                                        <input type="text" class="step-safety" placeholder="æ³¨æ„æ–­ç”µæ“ä½œã€ä½©æˆ´é˜²æŠ¤ç”¨å“ç­‰..." value="${step.safetyWarning || ''}" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                    </div>
                                </div>
                            </div>
                        `;

                        container.insertAdjacentHTML('beforeend', stepHtml);
                    });
                }

                // åŠ è½½æ‰€éœ€å·¥å…·
                if (planData.requiredTools && planData.requiredTools.length > 0) {
                    requiredTools = [...planData.requiredTools];
                    updateToolsList();
                }
            }

            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºæ˜å¤©
            if (!isEdit) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dateInput = modal.querySelector('input[name="plannedDate"]');
                dateInput.value = tomorrow.toISOString().split('T')[0];
            }

            // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    closeMaintenancePlanModal();
                }
            });

            // ä¿å­˜å¼¹çª—å¼•ç”¨
            window.currentMaintenancePlanModal = overlay;
        }

        // å…³é—­ç»´æŠ¤è®¡åˆ’å¼¹çª—
        function closeMaintenancePlanModal() {
            if (window.currentMaintenancePlanModal) {
                document.body.removeChild(window.currentMaintenancePlanModal);
                window.currentMaintenancePlanModal = null;
            }
        }

        // ç»´æŠ¤æ­¥éª¤ç®¡ç†ç›¸å…³å˜é‡
        let maintenanceSteps = [];
        let requiredTools = [];
        let stepCounter = 0;

        // æ·»åŠ ç»´æŠ¤æ­¥éª¤
        function addMaintenanceStep() {
            stepCounter++;
            const stepId = `step_${stepCounter}`;

            const stepHtml = `
                <div class="maintenance-step" data-step-id="${stepId}" style="border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; background: white;">
                    <div style="padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="margin: 0; color: #333; font-size: 14px; font-weight: 600;">æ­¥éª¤ ${stepCounter}</h5>
                            <div style="display: flex; gap: 5px;">
                                <button type="button" onclick="moveStepUp('${stepId}')" style="padding: 4px 8px; background: #95A5A6; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;" title="ä¸Šç§»">â†‘</button>
                                <button type="button" onclick="moveStepDown('${stepId}')" style="padding: 4px 8px; background: #95A5A6; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;" title="ä¸‹ç§»">â†“</button>
                                <button type="button" onclick="removeMaintenanceStep('${stepId}')" style="padding: 4px 8px; background: #E74C3C; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;" title="åˆ é™¤">Ã—</button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">æ­¥éª¤æè¿° *</label>
                            <textarea class="step-description" rows="2" placeholder="è¯¦ç»†æè¿°æ­¤æ­¥éª¤çš„æ“ä½œå†…å®¹..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; resize: vertical;" required></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">é¢„è®¡æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                <input type="number" class="step-time" min="1" placeholder="30" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">æ‰€éœ€å·¥å…·</label>
                                <input type="text" class="step-tools" placeholder="èºä¸åˆ€, ä¸‡ç”¨è¡¨..." style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 3px; font-size: 12px; color: #666; font-weight: 600;">å®‰å…¨è­¦å‘Š</label>
                            <input type="text" class="step-safety" placeholder="æ³¨æ„æ–­ç”µæ“ä½œã€ä½©æˆ´é˜²æŠ¤ç”¨å“ç­‰..." style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                        </div>
                    </div>
                </div>
            `;

            const container = document.getElementById('maintenanceStepsContainer');
            const noStepsMessage = document.getElementById('noStepsMessage');

            if (noStepsMessage) {
                noStepsMessage.remove();
            }

            container.insertAdjacentHTML('beforeend', stepHtml);

            // æ»šåŠ¨åˆ°æ–°æ·»åŠ çš„æ­¥éª¤
            const newStep = container.lastElementChild;
            newStep.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // åˆ é™¤ç»´æŠ¤æ­¥éª¤
        function removeMaintenanceStep(stepId) {
            const stepElement = document.querySelector(`[data-step-id="${stepId}"]`);
            if (stepElement) {
                stepElement.remove();

                // é‡æ–°ç¼–å·æ­¥éª¤
                renumberMaintenanceSteps();

                // å¦‚æœæ²¡æœ‰æ­¥éª¤äº†ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                const container = document.getElementById('maintenanceStepsContainer');
                if (container.children.length === 0) {
                    container.innerHTML = '<div style="padding: 20px; text-align: center; color: #999; font-size: 14px;" id="noStepsMessage">æš‚æ— ç»´æŠ¤æ­¥éª¤ï¼Œç‚¹å‡»"æ·»åŠ æ­¥éª¤"å¼€å§‹åˆ›å»º</div>';
                }
            }
        }

        // ä¸Šç§»æ­¥éª¤
        function moveStepUp(stepId) {
            const stepElement = document.querySelector(`[data-step-id="${stepId}"]`);
            const previousStep = stepElement.previousElementSibling;

            if (previousStep) {
                stepElement.parentNode.insertBefore(stepElement, previousStep);
                renumberMaintenanceSteps();
            }
        }

        // ä¸‹ç§»æ­¥éª¤
        function moveStepDown(stepId) {
            const stepElement = document.querySelector(`[data-step-id="${stepId}"]`);
            const nextStep = stepElement.nextElementSibling;

            if (nextStep) {
                stepElement.parentNode.insertBefore(nextStep, stepElement);
                renumberMaintenanceSteps();
            }
        }

        // é‡æ–°ç¼–å·ç»´æŠ¤æ­¥éª¤
        function renumberMaintenanceSteps() {
            const steps = document.querySelectorAll('.maintenance-step');
            steps.forEach((step, index) => {
                const stepNumber = index + 1;
                const stepTitle = step.querySelector('h5');
                stepTitle.textContent = `æ­¥éª¤ ${stepNumber}`;
            });
        }

        // æ·»åŠ å·¥å…·
        function addTool() {
            const toolInput = document.getElementById('toolInput');
            const toolName = toolInput.value.trim();

            if (toolName && !requiredTools.includes(toolName)) {
                requiredTools.push(toolName);
                updateToolsList();
                toolInput.value = '';
            }
        }

        // åˆ é™¤å·¥å…·
        function removeTool(toolName) {
            const index = requiredTools.indexOf(toolName);
            if (index > -1) {
                requiredTools.splice(index, 1);
                updateToolsList();
            }
        }

        // æ›´æ–°å·¥å…·åˆ—è¡¨æ˜¾ç¤º
        function updateToolsList() {
            const toolsList = document.getElementById('toolsList');
            toolsList.innerHTML = '';

            requiredTools.forEach(tool => {
                const toolTag = document.createElement('span');
                toolTag.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    padding: 4px 8px;
                    background: #3498DB;
                    color: white;
                    border-radius: 12px;
                    font-size: 12px;
                    font-weight: 500;
                `;
                toolTag.innerHTML = `
                    ${tool}
                    <button onclick="removeTool('${tool}')" style="margin-left: 5px; background: none; border: none; color: white; cursor: pointer; font-size: 14px; padding: 0; line-height: 1;">Ã—</button>
                `;
                toolsList.appendChild(toolTag);
            });
        }

        // è·å–ç»´æŠ¤æ­¥éª¤æ•°æ®
        function getMaintenanceStepsData() {
            const steps = [];
            const stepElements = document.querySelectorAll('.maintenance-step');

            stepElements.forEach((stepElement, index) => {
                const description = stepElement.querySelector('.step-description').value.trim();
                const time = stepElement.querySelector('.step-time').value;
                const tools = stepElement.querySelector('.step-tools').value.trim();
                const safety = stepElement.querySelector('.step-safety').value.trim();

                if (description) {
                    steps.push({
                        stepNumber: index + 1,
                        description: description,
                        estimatedTime: time ? parseInt(time) : null,
                        requiredTools: tools ? tools.split(',').map(t => t.trim()) : [],
                        safetyWarning: safety
                    });
                }
            });

            return steps;
        }

        // å·¥å…·è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function () {
            // ä¸ºåŠ¨æ€æ·»åŠ çš„å·¥å…·è¾“å…¥æ¡†ç»‘å®šå›è½¦äº‹ä»¶
            document.addEventListener('keypress', function (e) {
                if (e.target.id === 'toolInput' && e.key === 'Enter') {
                    e.preventDefault();
                    addTool();
                }
            });
        });

        // ä¿å­˜ç»´æŠ¤è®¡åˆ’
        function saveMaintenancePlan(editId = null) {
            const form = document.getElementById('maintenancePlanForm');
            const formData = new FormData(form);

            // éªŒè¯å¿…å¡«å­—æ®µ
            const requiredFields = ['deviceName', 'type', 'plannedDate', 'assignee'];
            for (let field of requiredFields) {
                if (!formData.get(field)) {
                    UserFriendlyAlert.showError(`è¯·å¡«å†™${getFieldLabel(field)}`);
                    return;
                }
            }

            // è·å–è®¾å¤‡å›¾æ ‡
            const deviceIcons = {
                'æ¸©åº¦æ§åˆ¶å™¨': 'ğŸŒ¡ï¸',
                'æ¹¿åº¦æ§åˆ¶å™¨': 'ğŸ’¨',
                'è¡¥å…‰ç¯ç³»ç»Ÿ': 'ğŸ’¡',
                'é€šé£ç³»ç»Ÿ': 'ğŸŒªï¸',
                'çŒæº‰ç³»ç»Ÿ': 'ğŸ’§',
                'åŠ çƒ­å™¨': 'ğŸ”¥',
                'å†·å´å™¨': 'â„ï¸',
                'CO2å‘ç”Ÿå™¨': 'ğŸ’¨'
            };

            // è·å–ç»´æŠ¤æ­¥éª¤æ•°æ®
            const maintenanceStepsData = getMaintenanceStepsData();

            // éªŒè¯è‡³å°‘æœ‰ä¸€ä¸ªç»´æŠ¤æ­¥éª¤
            if (maintenanceStepsData.length === 0) {
                UserFriendlyAlert.showError('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªç»´æŠ¤æ­¥éª¤');
                return;
            }

            const planData = {
                deviceName: formData.get('deviceName'),
                deviceIcon: deviceIcons[formData.get('deviceName')] || 'âš™ï¸',
                type: formData.get('type'),
                plannedDate: formData.get('plannedDate'),
                priority: formData.get('priority'),
                assignee: formData.get('assignee'),
                description: formData.get('description') || '',
                maintenanceSteps: maintenanceStepsData,
                requiredTools: [...requiredTools],
                safetyNotes: formData.get('safetyNotes') || '',
                status: 'å¾…æ‰§è¡Œ',
                createdAt: new Date().toISOString()
            };

            if (editId) {
                // ç¼–è¾‘ç°æœ‰è®¡åˆ’
                const index = maintenancePlans.findIndex(p => p.id == editId);
                if (index !== -1) {
                    maintenancePlans[index] = { ...maintenancePlans[index], ...planData };
                    UserFriendlyAlert.showSuccess('ç»´æŠ¤è®¡åˆ’æ›´æ–°æˆåŠŸ');
                }
            } else {
                // åˆ›å»ºæ–°è®¡åˆ’
                planData.id = Date.now(); // ç®€å•çš„IDç”Ÿæˆ
                maintenancePlans.unshift(planData);
                UserFriendlyAlert.showSuccess('ç»´æŠ¤è®¡åˆ’åˆ›å»ºæˆåŠŸ');
            }

            // å…³é—­å¼¹çª—
            closeMaintenancePlanModal();

            // åˆ·æ–°åˆ—è¡¨
            refreshMaintenanceData();
        }

        // è·å–å­—æ®µæ ‡ç­¾
        function getFieldLabel(field) {
            const labels = {
                'deviceName': 'è®¾å¤‡åç§°',
                'type': 'ç»´æŠ¤ç±»å‹',
                'plannedDate': 'è®¡åˆ’æ—¥æœŸ',
                'assignee': 'è´Ÿè´£äºº'
            };
            return labels[field] || field;
        }

        // æŸ¥çœ‹ç»´æŠ¤è®¡åˆ’è¯¦æƒ…
        function viewMaintenancePlan(planId) {
            const plan = maintenancePlans.find(p => p.id == planId);
            if (!plan) {
                UserFriendlyAlert.showError('æœªæ‰¾åˆ°ç»´æŠ¤è®¡åˆ’');
                return;
            }

            showMaintenancePlanDetail(plan);
        }

        // æ˜¾ç¤ºç»´æŠ¤è®¡åˆ’è¯¦æƒ…
        function showMaintenancePlanDetail(plan) {
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

            // åˆ›å»ºè¯¦æƒ…å¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 15px;
                width: 90%;
                max-width: 500px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: slideIn 0.3s ease;
            `;

            const priorityColors = {
                'low': '#27AE60',
                'normal': '#3498DB',
                'high': '#F39C12',
                'urgent': '#E74C3C'
            };

            const priorityLabels = {
                'low': 'ä½ä¼˜å…ˆçº§',
                'normal': 'æ™®é€šä¼˜å…ˆçº§',
                'high': 'é«˜ä¼˜å…ˆçº§',
                'urgent': 'ç´§æ€¥'
            };

            const statusColors = {
                'å¾…æ‰§è¡Œ': '#3498DB',
                'æ‰§è¡Œä¸­': '#F39C12',
                'å·²å®Œæˆ': '#27AE60',
                'å·²è¿‡æœŸ': '#E74C3C',
                'å·²å–æ¶ˆ': '#95A5A6'
            };

            modal.innerHTML = `
                <div style="padding: 25px; border-bottom: 1px solid #eee;">
                    <h3 style="margin: 0; color: #333; font-size: 20px; display: flex; align-items: center; justify-content: space-between;">
                        <span style="display: flex; align-items: center;">
                            <span style="margin-right: 10px;">${plan.deviceIcon}</span>ç»´æŠ¤è®¡åˆ’è¯¦æƒ…
                        </span>
                        <button onclick="closeMaintenancePlanDetail()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">Ã—</button>
                    </h3>
                </div>
                
                <div style="padding: 25px;">
                    <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">åŸºæœ¬ä¿¡æ¯</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">è®¾å¤‡åç§°</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">${plan.deviceIcon} ${plan.deviceName}</div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">ç»´æŠ¤ç±»å‹</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">${plan.type}</div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">ä¼˜å…ˆçº§</label>
                                <div style="margin-top: 5px;">
                                    <span style="background: ${priorityColors[plan.priority]}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                        ${priorityLabels[plan.priority]}
                                    </span>
                                </div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">çŠ¶æ€</label>
                                <div style="margin-top: 5px;">
                                    <span style="background: ${statusColors[plan.status]}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                        ${plan.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ—¶é—´å’Œäººå‘˜ä¿¡æ¯ -->
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">æ—¶é—´å’Œäººå‘˜</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">è®¡åˆ’æ—¥æœŸ</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">${plan.plannedDate}</div>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; font-weight: 600;">è´Ÿè´£äºº</label>
                                <div style="font-size: 14px; color: #333; margin-top: 2px;">${plan.assignee}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç»´æŠ¤å†…å®¹ -->
                    ${plan.description ? `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">ç»´æŠ¤æè¿°</h4>
                        <div style="font-size: 14px; color: #333; line-height: 1.6;">${plan.description}</div>
                    </div>
                    ` : ''}
                    
                    <!-- ç»´æŠ¤æ­¥éª¤ -->
                    ${plan.maintenanceSteps && plan.maintenanceSteps.length > 0 ? `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">ç»´æŠ¤æ­¥éª¤</h4>
                        <div style="space-y: 10px;">
                            ${plan.maintenanceSteps.map(step => `
                                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px; border-left: 4px solid #3498DB;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                        <h5 style="margin: 0; color: #333; font-size: 14px; font-weight: 600;">æ­¥éª¤ ${step.stepNumber}</h5>
                                        ${step.estimatedTime ? `<span style="background: #e9ecef; color: #495057; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">${step.estimatedTime}åˆ†é’Ÿ</span>` : ''}
                                    </div>
                                    <div style="font-size: 13px; color: #333; line-height: 1.5; margin-bottom: 8px;">${step.description}</div>
                                    ${step.requiredTools && step.requiredTools.length > 0 ? `
                                        <div style="margin-bottom: 8px;">
                                            <span style="font-size: 11px; color: #666; font-weight: 600;">æ‰€éœ€å·¥å…·ï¼š</span>
                                            <span style="font-size: 12px; color: #495057;">${step.requiredTools.join(', ')}</span>
                                        </div>
                                    ` : ''}
                                    ${step.safetyWarning ? `
                                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 6px 10px; margin-top: 8px;">
                                            <span style="font-size: 11px; color: #856404; font-weight: 600;">âš ï¸ å®‰å…¨æé†’ï¼š</span>
                                            <span style="font-size: 11px; color: #856404;">${step.safetyWarning}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- æ‰€éœ€å·¥å…· -->
                    ${plan.requiredTools && plan.requiredTools.length > 0 ? `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #333;">æ‰€éœ€å·¥å…·</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${plan.requiredTools.map(tool => `
                                <span style="background: #3498DB; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500;">${tool}</span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- å®‰å…¨æ³¨æ„äº‹é¡¹ -->
                    ${plan.safetyNotes ? `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #856404; display: flex; align-items: center;">
                            <span style="margin-right: 8px;">âš ï¸</span>å®‰å…¨æ³¨æ„äº‹é¡¹
                        </h4>
                        <div style="font-size: 14px; color: #856404; line-height: 1.6;">${plan.safetyNotes}</div>
                    </div>
                    ` : ''}
                </div>
                
                <div style="padding: 20px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" onclick="editMaintenancePlan(${plan.id})" style="padding: 10px 20px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ç¼–è¾‘</button>
                    <button type="button" onclick="closeMaintenancePlanDetail()" style="padding: 10px 20px; background: #95A5A6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">å…³é—­</button>
                </div>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    closeMaintenancePlanDetail();
                }
            });

            // ä¿å­˜å¼¹çª—å¼•ç”¨
            window.currentMaintenancePlanDetailModal = overlay;
        }

        // å…³é—­ç»´æŠ¤è®¡åˆ’è¯¦æƒ…å¼¹çª—
        function closeMaintenancePlanDetail() {
            if (window.currentMaintenancePlanDetailModal) {
                document.body.removeChild(window.currentMaintenancePlanDetailModal);
                window.currentMaintenancePlanDetailModal = null;
            }
        }

        // ç¼–è¾‘ç»´æŠ¤è®¡åˆ’
        function editMaintenancePlan(planId) {
            const plan = maintenancePlans.find(p => p.id == planId);
            if (!plan) {
                UserFriendlyAlert.showError('æœªæ‰¾åˆ°ç»´æŠ¤è®¡åˆ’');
                return;
            }

            // å…³é—­è¯¦æƒ…å¼¹çª—
            closeMaintenancePlanDetail();

            // æ‰“å¼€ç¼–è¾‘å¼¹çª—
            showMaintenancePlanModal(plan);
        }

        function refreshMaintenanceData() {
            // åˆ·æ–°ç»´æŠ¤è®¡åˆ’åˆ—è¡¨
            const maintenancePlansContainer = document.getElementById('maintenancePlansContainer');
            if (maintenancePlansContainer) {
                maintenancePlansContainer.innerHTML = generateMaintenancePlansHTML();
            }

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateMaintenanceStats();

            UserFriendlyAlert.showSuccess('ç»´æŠ¤æ•°æ®å·²åˆ·æ–°');
        }

        // æ›´æ–°ç»´æŠ¤ç»Ÿè®¡æ•°æ®
        function updateMaintenanceStats() {
            const overdueCount = maintenancePlans.filter(p => {
                const planDate = new Date(p.plannedDate);
                const today = new Date();
                return planDate < today && p.status === 'å¾…æ‰§è¡Œ';
            }).length;

            const upcomingCount = maintenancePlans.filter(p => {
                const planDate = new Date(p.plannedDate);
                const today = new Date();
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                return planDate >= today && planDate <= nextWeek && p.status === 'å¾…æ‰§è¡Œ';
            }).length;

            const completedCount = maintenancePlans.filter(p => p.status === 'å·²å®Œæˆ').length;
            const totalCount = maintenancePlans.length;

            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            const overdueElement = document.getElementById('overdueCount');
            const upcomingElement = document.getElementById('upcomingCount');
            const completedElement = document.getElementById('completedCount');
            const totalElement = document.getElementById('totalPlansCount');

            if (overdueElement) overdueElement.textContent = overdueCount;
            if (upcomingElement) upcomingElement.textContent = upcomingCount;
            if (completedElement) completedElement.textContent = completedCount;
            if (totalElement) totalElement.textContent = totalCount;
        }

        function executeMaintenance(planId) {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦æ‰§è¡Œæ­¤ç»´æŠ¤è®¡åˆ’å—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showSuccess(`ç»´æŠ¤è®¡åˆ’ #${planId} æ‰§è¡Œå®Œæˆ`);
                    refreshMaintenanceData();
                }
            );
        }

        function postponeMaintenance(planId) {
            UserFriendlyAlert.showInfo(`ç»´æŠ¤è®¡åˆ’ #${planId} å·²å»¶æœŸ`);
        }

        function cancelMaintenance(planId) {
            UserFriendlyAlert.showConfirm('ç¡®å®šè¦å–æ¶ˆæ­¤ç»´æŠ¤è®¡åˆ’å—ï¼Ÿ',
                function () {
                    UserFriendlyAlert.showInfo(`ç»´æŠ¤è®¡åˆ’ #${planId} å·²å–æ¶ˆ`);
                    refreshMaintenanceData();
                }
            );
        }

        // ç”Ÿæˆç»´æŠ¤è®¡åˆ’HTML
        function generateMaintenancePlansHTML() {
            return maintenancePlans.map(plan => {
                const statusColor = plan.status === 'å·²è¿‡æœŸ' ? '#E74C3C' : plan.status === 'æ‰§è¡Œä¸­' ? '#F39C12' : plan.status === 'å·²å®Œæˆ' ? '#27AE60' : '#3498DB';
                const priorityColor = plan.priority === 'high' || plan.priority === 'urgent' ? '#E74C3C' : plan.priority === 'low' ? '#95A5A6' : '#3498DB';

                const priorityLabel = {
                    'low': 'ä½',
                    'normal': 'ä¸­',
                    'high': 'é«˜',
                    'urgent': 'ç´§æ€¥'
                }[plan.priority] || 'ä¸­';

                return `
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1.5fr; border-bottom: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; background: white;" 
                     onmouseover="this.style.background='rgba(52, 73, 94, 0.05)'; this.style.transform='translateX(2px)'" 
                     onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <div style="padding: 15px; display: flex; align-items: center; font-size: 13px; font-weight: 600; color: #333;">
                        <span style="margin-right: 8px; font-size: 16px;">${plan.deviceIcon}</span>
                        <div>
                            <div style="font-weight: 600;">${plan.deviceName}</div>
                            <div style="font-size: 11px; color: ${priorityColor}; margin-top: 2px;">ä¼˜å…ˆçº§: ${priorityLabel}</div>
                        </div>
                    </div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${plan.type}</div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${plan.plannedDate}</div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 13px;">
                        <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; background: ${statusColor === '#E74C3C' ? 'rgba(231, 76, 60, 0.2)' : statusColor === '#F39C12' ? 'rgba(243, 156, 18, 0.2)' : statusColor === '#27AE60' ? 'rgba(39, 174, 96, 0.2)' : 'rgba(52, 152, 219, 0.2)'}; color: ${statusColor}; border: 1px solid ${statusColor === '#E74C3C' ? 'rgba(231, 76, 60, 0.3)' : statusColor === '#F39C12' ? 'rgba(243, 156, 18, 0.3)' : statusColor === '#27AE60' ? 'rgba(39, 174, 96, 0.3)' : 'rgba(52, 152, 219, 0.3)'};">
                            ${plan.status}
                        </span>
                    </div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${plan.assignee}</div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 5px;">
                        <button style="padding: 4px 8px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="viewMaintenancePlan(${plan.id})" title="æŸ¥çœ‹è¯¦æƒ…">æŸ¥çœ‹</button>
                        <button style="padding: 4px 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="executeMaintenance(${plan.id})" title="æ‰§è¡Œç»´æŠ¤">æ‰§è¡Œ</button>
                        <button style="padding: 4px 8px; background: #F39C12; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="postponeMaintenance(${plan.id})" title="å»¶æœŸ">å»¶æœŸ</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        // ç”Ÿæˆç»´æŠ¤è®°å½•HTML
        function generateMaintenanceRecordsHTML() {
            const maintenanceRecords = [
                { id: 1, deviceName: 'æ¸©åº¦æ§åˆ¶å™¨', deviceIcon: 'ğŸŒ¡ï¸', type: 'å®šæœŸæ£€æŸ¥', completedDate: '2024-01-10', duration: '2å°æ—¶', executor: 'å¼ å·¥ç¨‹å¸ˆ', notes: 'è®¾å¤‡è¿è¡Œæ­£å¸¸ï¼Œå·²æ›´æ–°æ ¡å‡†å‚æ•°' },
                { id: 2, deviceName: 'çŒæº‰ç³»ç»Ÿ', deviceIcon: 'ğŸ’§', type: 'ç®¡é“æ¸…æ´—', completedDate: '2024-01-08', duration: '3å°æ—¶', executor: 'ææŠ€å¸ˆ', notes: 'æ¸…ç†äº†å µå¡çš„å–·å¤´ï¼Œæ›´æ¢äº†è€åŒ–çš„å¯†å°åœˆ' },
                { id: 3, deviceName: 'è¡¥å…‰ç¯', deviceIcon: 'ğŸ’¡', type: 'ç¯æ³¡æ›´æ¢', completedDate: '2024-01-05', duration: '1å°æ—¶', executor: 'ç‹å¸ˆå‚…', notes: 'æ›´æ¢äº†3ä¸ªè€åŒ–çš„LEDç¯æ³¡ï¼Œäº®åº¦æ¢å¤æ­£å¸¸' },
                { id: 4, deviceName: 'é€šé£ç³»ç»Ÿ', deviceIcon: 'ğŸŒªï¸', type: 'æ»¤ç½‘æ¸…æ´—', completedDate: '2024-01-03', duration: '1.5å°æ—¶', executor: 'é™ˆæŠ€å¸ˆ', notes: 'æ¸…æ´—äº†è¿›é£å£æ»¤ç½‘ï¼Œé£é‡æ˜æ˜¾æ”¹å–„' },
                { id: 5, deviceName: 'åŠ çƒ­å™¨', deviceIcon: 'ğŸ”¥', type: 'å®‰å…¨æ£€æŸ¥', completedDate: '2024-01-01', duration: '2.5å°æ—¶', executor: 'åˆ˜å·¥ç¨‹å¸ˆ', notes: 'æ£€æŸ¥äº†åŠ çƒ­å…ƒä»¶å’Œæ¸©æ§ç³»ç»Ÿï¼Œä¸€åˆ‡æ­£å¸¸' },
                { id: 6, deviceName: 'æ¹¿åº¦ä¼ æ„Ÿå™¨', deviceIcon: 'ğŸ’¨', type: 'æ ¡å‡†æ£€æµ‹', completedDate: '2023-12-28', duration: '1å°æ—¶', executor: 'èµµæŠ€å¸ˆ', notes: 'é‡æ–°æ ¡å‡†äº†ä¼ æ„Ÿå™¨ï¼Œç²¾åº¦æå‡åˆ°Â±2%' },
                { id: 7, deviceName: 'æ°´æ³µ', deviceIcon: 'âš¡', type: 'æ¶¦æ»‘ä¿å…»', completedDate: '2023-12-25', duration: '2å°æ—¶', executor: 'å­™å¸ˆå‚…', notes: 'æ›´æ¢äº†æ¶¦æ»‘æ²¹ï¼Œæ£€æŸ¥äº†è½´æ‰¿ç£¨æŸæƒ…å†µ' },
                { id: 8, deviceName: 'CO2ä¼ æ„Ÿå™¨', deviceIcon: 'ğŸŒ¿', type: 'ç²¾åº¦æ ¡éªŒ', completedDate: '2023-12-22', duration: '1.5å°æ—¶', executor: 'å‘¨æŠ€å¸ˆ', notes: 'ä½¿ç”¨æ ‡å‡†æ°”ä½“æ ¡éªŒï¼Œç²¾åº¦ç¬¦åˆè¦æ±‚' }
            ];

            return maintenanceRecords.map(record => `
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 2fr; border-bottom: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; background: white;" 
                     onmouseover="this.style.background='rgba(52, 73, 94, 0.05)'; this.style.transform='translateX(2px)'" 
                     onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <div style="padding: 15px; display: flex; align-items: center; font-size: 13px; font-weight: 600; color: #333;">
                        <span style="margin-right: 8px; font-size: 16px;">${record.deviceIcon}</span>
                        <div style="font-weight: 600;">${record.deviceName}</div>
                    </div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${record.type}</div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${record.completedDate}</div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${record.duration}</div>
                    <div style="padding: 15px; text-align: center; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">${record.executor}</div>
                    <div style="padding: 15px; font-size: 11px; color: #666; line-height: 1.4;">${record.notes}</div>
                </div>
            `).join('');
        }



        // åŠ è½½è®¾å¤‡æ§åˆ¶å†…å®¹
        function loadDevicesContent(container) {
            container.innerHTML = `
                <!-- æ¸©å®¤é€‰æ‹©å™¨ -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">ğŸ </span>æ¸©å®¤é€‰æ‹©
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="device-greenhouse-btn active" onclick="selectDeviceGreenhouse(1)" style="padding: 12px 20px; background: #2C3E50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">1å·æ¸©å®¤ (è”¬èœåŒº)</button>
                        <button class="device-greenhouse-btn" onclick="selectDeviceGreenhouse(2)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">2å·æ¸©å®¤ (èŠ±å‰åŒº)</button>
                        <button class="device-greenhouse-btn" onclick="selectDeviceGreenhouse(3)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">3å·æ¸©å®¤ (è‚²è‹—åŒº)</button>
                        <button class="device-greenhouse-btn" onclick="selectDeviceGreenhouse(4)" style="padding: 12px 20px; background: #95A5A6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">4å·æ¸©å®¤ (å®éªŒåŒº)</button>
                    </div>
                </div>

                <!-- è®¾å¤‡æ§åˆ¶æ“ä½œæ  -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ› ï¸</span>è®¾å¤‡æ“ä½œ
                        </h3>
                        <div style="display: flex; gap: 10px;">
                            <span style="padding: 8px 12px; background: #27AE60; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">è¿è¡Œä¸­: 8</span>
                            <span style="padding: 8px 12px; background: #F39C12; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">å¾…æœº: 3</span>
                            <span style="padding: 8px 12px; background: #95A5A6; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">å…³é—­: 1</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                        <button style="padding: 12px 20px; background: #27AE60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="startAllDevices()">ğŸš€ å¯åŠ¨æ‰€æœ‰è®¾å¤‡</button>
                        <button style="padding: 12px 20px; background: #E74C3C; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="stopAllDevices()">ğŸ›‘ åœæ­¢æ‰€æœ‰è®¾å¤‡</button>
                        <button style="padding: 12px 20px; background: #3498DB; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="refreshDevices()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
                        <button style="padding: 12px 20px; background: #8E44AD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="exportDeviceStatus()">ğŸ“¤ å¯¼å‡ºçŠ¶æ€</button>
                    </div>
                </div>

                <!-- è®¾å¤‡ç½‘æ ¼ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">âš™ï¸</span>è®¾å¤‡åˆ—è¡¨
                        <span style="margin-left: auto; font-size: 14px; color: #666; font-weight: normal;">ç‚¹å‡»è®¾å¤‡å¡ç‰‡æŸ¥çœ‹è¯¦ç»†æ§åˆ¶</span>
                    </h3>
                    <div id="devicesGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${generateDeviceCards(currentDeviceGreenhouse)}
                    </div>
                </div>

                <!-- ç»´æŠ¤ç®¡ç†æ¦‚è§ˆ -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">ğŸ”§</span>ç»´æŠ¤ç®¡ç†ä¸­å¿ƒ
                        </h3>
                        <div style="display: flex; gap: 10px;">
                            <button style="padding: 8px 16px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="createMaintenancePlan()">+ åˆ›å»ºç»´æŠ¤è®¡åˆ’</button>
                            <button style="padding: 8px 16px; background: #3498DB; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="refreshMaintenanceData()">ğŸ”„ åˆ·æ–°</button>
                        </div>
                    </div>
                    
                    <!-- ç»´æŠ¤çŠ¶æ€ç»Ÿè®¡ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #E74C3C;">
                            <div style="font-size: 24px; font-weight: bold; color: #E74C3C; margin-bottom: 5px;" id="overdueCount">2</div>
                            <div style="font-size: 14px; color: #666;">å·²è¿‡æœŸ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #F39C12;">
                            <div style="font-size: 24px; font-weight: bold; color: #F39C12; margin-bottom: 5px;" id="upcomingCount">5</div>
                            <div style="font-size: 14px; color: #666;">å³å°†åˆ°æœŸ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #27AE60;">
                            <div style="font-size: 24px; font-weight: bold; color: #27AE60; margin-bottom: 5px;" id="completedCount">12</div>
                            <div style="font-size: 14px; color: #666;">å·²å®Œæˆ</div>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; border-left: 4px solid #3498DB;">
                            <div style="font-size: 24px; font-weight: bold; color: #3498DB; margin-bottom: 5px;" id="totalPlansCount">19</div>
                            <div style="font-size: 14px; color: #666;">æ€»è®¡åˆ’æ•°</div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤è®¡åˆ’åˆ—è¡¨ -->
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 8px;">ğŸ“‹</span>ç»´æŠ¤è®¡åˆ’
                        </h4>
                        <div style="background: #f8f9fa; border-radius: 8px; overflow: hidden;">
                            <!-- è¡¨å¤´ -->
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1.5fr; background: #34495E; color: white; font-weight: 600; font-size: 13px;">
                                <div style="padding: 12px 15px;">è®¾å¤‡åç§°</div>
                                <div style="padding: 12px 15px; text-align: center;">ç»´æŠ¤ç±»å‹</div>
                                <div style="padding: 12px 15px; text-align: center;">è®¡åˆ’æ—¥æœŸ</div>
                                <div style="padding: 12px 15px; text-align: center;">çŠ¶æ€</div>
                                <div style="padding: 12px 15px; text-align: center;">è´Ÿè´£äºº</div>
                                <div style="padding: 12px 15px; text-align: center;">æ“ä½œ</div>
                            </div>
                            <!-- ç»´æŠ¤è®¡åˆ’æ•°æ® -->
                            <div id="maintenancePlansContainer">
                                ${generateMaintenancePlansHTML()}
                            </div>
                        </div>
                    </div>

                    <!-- ç»´æŠ¤è®°å½•åˆ—è¡¨ -->
                    <div>
                        <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                            <span style="margin-right: 8px;">ğŸ“</span>ç»´æŠ¤è®°å½•
                        </h4>
                        <div style="background: #f8f9fa; border-radius: 8px; overflow: hidden;">
                            <!-- è¡¨å¤´ -->
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 2fr; background: #2C3E50; color: white; font-weight: 600; font-size: 13px;">
                                <div style="padding: 12px 15px;">è®¾å¤‡åç§°</div>
                                <div style="padding: 12px 15px; text-align: center;">ç»´æŠ¤ç±»å‹</div>
                                <div style="padding: 12px 15px; text-align: center;">å®Œæˆæ—¥æœŸ</div>
                                <div style="padding: 12px 15px; text-align: center;">è€—æ—¶</div>
                                <div style="padding: 12px 15px; text-align: center;">æ‰§è¡Œäºº</div>
                                <div style="padding: 12px 15px;">å¤‡æ³¨</div>
                            </div>
                            <!-- ç»´æŠ¤è®°å½•æ•°æ® -->
                            <div id="maintenanceRecordsContainer">
                                ${generateMaintenanceRecordsHTML()}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆè®¾å¤‡å¡ç‰‡
        function generateDeviceCards(greenhouseId) {
            const devices = [
                { name: 'æ¸©åº¦æ§åˆ¶å™¨', icon: 'ğŸŒ¡ï¸', status: 'è¿è¡Œä¸­', color: '#27AE60' },
                { name: 'æ¹¿åº¦æ§åˆ¶å™¨', icon: 'ğŸ’¨', status: 'è¿è¡Œä¸­', color: '#3498DB' },
                { name: 'è¡¥å…‰ç¯ç³»ç»Ÿ', icon: 'ğŸ’¡', status: 'å¾…æœº', color: '#F39C12' },
                { name: 'é€šé£ç³»ç»Ÿ', icon: 'ğŸŒªï¸', status: 'è¿è¡Œä¸­', color: '#27AE60' },
                { name: 'çŒæº‰ç³»ç»Ÿ', icon: 'ğŸ’§', status: 'è¿è¡Œä¸­', color: '#3498DB' },
                { name: 'åŠ çƒ­å™¨', icon: 'ğŸ”¥', status: 'å…³é—­', color: '#95A5A6' }
            ];

            return devices.map(device => `
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer;" 
                     onmouseover="this.style.boxShadow='0 6px 20px rgba(0,0,0,0.15)'; this.style.transform='translateY(-2px)'" 
                     onmouseout="this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 32px; margin-right: 15px;">${device.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 18px; font-weight: bold; color: #333;">${device.name}</div>
                            <div style="color: ${device.color}; font-size: 14px; font-weight: 600;">${device.status}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button style="flex: 1; padding: 8px; background: #27AE60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="event.stopPropagation(); startDevice('${device.name}')">å¯åŠ¨</button>
                        <button style="flex: 1; padding: 8px; background: #E74C3C; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;" onclick="event.stopPropagation(); stopDevice('${device.name}')">åœæ­¢</button>
                    </div>
                </div>
            `).join('');
        }

        // æ¸©å®¤é€‰æ‹©å‡½æ•°
        function selectDeviceGreenhouse(greenhouseId) {
            currentDeviceGreenhouse = greenhouseId;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.device-greenhouse-btn').forEach(btn => {
                btn.style.background = '#95A5A6';
            });
            event.target.style.background = '#2C3E50';

            // é‡æ–°ç”Ÿæˆè®¾å¤‡ç½‘æ ¼
            const devicesGrid = document.getElementById('devicesGrid');
            if (devicesGrid) {
                devicesGrid.innerHTML = generateDeviceCards(greenhouseId);
            }

            UserFriendlyAlert.showInfo(`å·²åˆ‡æ¢åˆ°${greenhouseId}å·æ¸©å®¤`);
        }

        function exportDeviceStatus() {
            UserFriendlyAlert.showSuccess('è®¾å¤‡çŠ¶æ€å¯¼å‡ºæˆåŠŸ');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // åˆå§‹åŒ–åŠ è½½è®¾å¤‡æ§åˆ¶é¡µé¢å†…å®¹
            if (currentPage === 'devices') {
                loadPageContent('devices');
            }

            // æ¨¡æ‹Ÿç³»ç»ŸçŠ¶æ€æ›´æ–°
            setInterval(function () {
                const deviceCount = Math.floor(Math.random() * 3) + 10;
                const alertCount = Math.floor(Math.random() * 5) + 1;

                document.getElementById('deviceCount').textContent = deviceCount;
                document.getElementById('alertCount').textContent = alertCount;
            }, 60000);
        });
    </script>
</body>

</html>